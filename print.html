<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>A guide to Telegram.Bot .NET library</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-B8JVQVCBTX"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag() { dataLayer.push(arguments); }
            gtag('js', new Date());
        
            gtag('config', 'G-B8JVQVCBTX');
        </script>
        <!--  -->
        <meta property="og:site_name" content="Telegram Bots Book" />
        <meta property="og:image" content="https://telegrambots.github.io/book/1/docs/logo-chat.jpg" />

        <meta name="description" content="Comprehensive documentation to using the Telegram.Bot library and Bot API for building .NET bots for Telegram">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="shortcut icon" href="favicon-ec4bdd00.png">
        <link rel="stylesheet" href="css/variables-8adf115d.css">
        <link rel="stylesheet" href="css/general-2459343d.css">
        <link rel="stylesheet" href="css/chrome-ae938929.css">
        <link rel="stylesheet" href="css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="theme/custom-78e74a83.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex-f133a3f9.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc-50ccb01f.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>‚Üê</kbd> or <kbd>‚Üí</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">A guide to Telegram.Bot .NET library</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>
                        <a href="https://github.com/TelegramBots/book" title="Git repository" aria-label="Git repository">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h1 id="telegram-bots-book"><a class="header" href="#telegram-bots-book">Telegram Bots Book</a></h1>
<p><a href="https://www.nuget.org/packages/Telegram.Bot#versions-body-tab"><img src="https://img.shields.io/nuget/dt/Telegram.Bot.svg?style=flat-square" alt="NuGet"></a>
<a href="https://github.com/TelegramBots/Telegram.Bot"><img src="https://img.shields.io/github/stars/TelegramBots/Telegram.Bot.svg?style=social&amp;label=Stars" alt="Repository"></a></p>
<p><strong><a href="https://github.com/TelegramBots/Telegram.Bot">Telegram.Bot</a></strong> is the most popular .NET client for <a href="https://core.telegram.org/bots/api">Telegram Bot API</a>, allowing <a href="https://core.telegram.org/bots">developers to build bots</a> for <a href="https://www.telegram.org">Telegram</a> messaging app.</p>
<p>This book covers all you need to know to create a chatbot in .NET, with many concrete examples written in C#.<br>Begin with our <a href="#quickstart"><em>Quickstart</em></a>, or choose from the Table Of Content (left/top), and don‚Äôt miss our useful <a href="#frequently-asked-questions">Frequently Asked Questions</a>.</p>
<h2 id="-installation"><a class="header" href="#-installation">üß© Installation</a></h2>
<p><a href="https://www.nuget.org/packages/Telegram.Bot">Install the package ‚ÄúTelegram.Bot‚Äù from Nuget</a> using Nuget package manager <em>(in your IDE or command line)</em>.</p>
<p>Make sure to follow the <a href="#migration-guide-for-version-22x">Migration Guide for v22.*</a> if you have existing bot code.</p>
<h2 id="-more-examples"><a class="header" href="#-more-examples">ü™Ñ More examples</a></h2>
<p>This book is filled with ready-to-use snippets of code, but you can also find full project examples at our <a href="https://github.com/TelegramBots/Telegram.Bot.Examples">Telegram.Bot.Examples</a> Github repository, featuring:</p>
<ul>
<li>Simple Console apps (long polling)</li>
<li>Webhook ASP.NET example (with Controllers or Minimal APIs)</li>
<li>Full-featured advanced solution</li>
<li>Serverless Functions implementations</li>
</ul>
<h2 id="-more-useful-links"><a class="header" href="#-more-useful-links">üîó More useful links</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Visit our</th><th>URL</th></tr>
</thead>
<tbody>
<tr><td>Nuget feed</td><td><a href="https://www.nuget.org/packages/Telegram.Bot">https://www.nuget.org/packages/Telegram.Bot</a></td></tr>
<tr><td>Github repo</td><td><a href="https://github.com/TelegramBots/Telegram.Bot">https://github.com/TelegramBots/Telegram.Bot</a></td></tr>
<tr><td>Examples repo</td><td><a href="https://github.com/TelegramBots/Telegram.Bot.Examples">https://github.com/TelegramBots/Telegram.Bot.Examples</a></td></tr>
<tr><td>Telegram news channel</td><td><a href="https://t.me/tgbots_dotnet">https://t.me/tgbots_dotnet</a></td></tr>
<tr><td>Telegram support group</td><td><a href="https://t.me/joinchat/B35YY0QbLfd034CFnvCtCA">https://t.me/joinchat/B35YY0QbLfd034CFnvCtCA</a></td></tr>
<tr><td>Team page</td><td><a href="https://github.com/orgs/TelegramBots/people">https://github.com/orgs/TelegramBots/people</a></td></tr>
<tr><td>Recover the list of all past<br />users messaging your bot</td><td><a href="https://telegramservices.azurewebsites.net/">https://telegramservices.azurewebsites.net/</a></td></tr>
</tbody>
</table>
</div>
<h2 id="-continue-reading"><a class="header" href="#-continue-reading">üìñ Continue reading</a></h2>
<p>Click on the right arrow (or keyboard arrow key) to go to the next page and read our <a href="#quickstart">quickstart guide</a>.</p>
<p>You can also click on the Table of content menu (left/top) to access a specific chapter.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="quickstart"><a class="header" href="#quickstart">Quickstart</a></h1>
<h2 id="bot-father"><a class="header" href="#bot-father">Bot Father</a></h2>
<p>Before you start, you need to talk to <a href="https://t.me/botfather">@BotFather</a> on Telegram.
<a href="https://core.telegram.org/bots/tutorial#obtain-your-bot-token">Create a new bot</a>, acquire the bot token and get back here.</p>
<p><a href="https://t.me/botfather"><img src="1/docs/logo-bot-father.jpg" alt="Bot Father"></a></p>
<p>Bot token is a key that required to authorize the bot and send requests to the Bot API. Keep your token secure and store it safely, it can be used to control your bot. It should look like this:</p>
<pre><code class="language-text">1234567:4TT8bAc8GHUspu3ERYn-KGcvsvGB9u_n4ddy
</code></pre>
<h2 id="hello-world"><a class="header" href="#hello-world">Hello World</a></h2>
<p>Now that you have a bot, it‚Äôs time to bring it to life!</p>
<blockquote class="blockquote-tag blockquote-tag-note">
<p class="blockquote-tag-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p>
<p>We recommend a recent .NET version like .NET 8, but we also support older .NET Framework (4.6.1+), .NET Core (2.0+) or .NET (5.0+)</p>
</blockquote>
<p>Create a new console project for your bot and add a reference to <code>Telegram.Bot</code> package:</p>
<pre><code class="language-bash">dotnet new console
dotnet add package Telegram.Bot
</code></pre>
<p>The code below fetches Bot information based on its bot token by calling the Bot API <a href="https://core.telegram.org/bots/api#getme"><code>getMe</code></a> method. Open <code>Program.cs</code> and use the following content:</p>
<blockquote>
<p>‚ö†Ô∏è Replace <code>YOUR_BOT_TOKEN</code> with your bot token obtained from <a href="https://t.me/botfather">@BotFather</a>.</p>
</blockquote>
<pre><code class="language-c#">using Telegram.Bot;

var bot = new TelegramBotClient("YOUR_BOT_TOKEN");
var me = await bot.GetMe();
Console.WriteLine($"Hello, World! I am user {me.Id} and my name is {me.FirstName}.");
</code></pre>
<p>Running the program gives you the following output:</p>
<pre><code class="language-bash">dotnet run

Hello, World! I am user 1234567 and my name is Awesome Bot.
</code></pre>
<p>Great! This bot is self-aware. To make the bot react to user messages, head to the <a href="#your-first-chat-bot">next page</a>.</p>
<!-- -->
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="your-first-chat-bot"><a class="header" href="#your-first-chat-bot">Your First Chat Bot</a></h1>
<p>On the <a href="#quickstart">previous page</a> we got a bot token and used the <a href="https://core.telegram.org/bots/api#getme"><code>getMe</code></a> method to check our setup.
Now, it is time to make an <em>interactive</em> bot that gets users‚Äô messages and replies to them like in this screenshot:</p>
<p><img src="1/docs/shot-example_bot.jpg" alt="Example Image"></p>
<p>Copy the following code to <code>Program.cs</code>.</p>
<blockquote>
<p>‚ö†Ô∏è Replace <code>YOUR_BOT_TOKEN</code> with the bot token obtained from <a href="https://t.me/botfather">@BotFather</a>.</p>
</blockquote>
<pre><code class="language-c#">using Telegram.Bot;
using Telegram.Bot.Types;
using Telegram.Bot.Types.Enums;

using var cts = new CancellationTokenSource();
var bot = new TelegramBotClient("YOUR_BOT_TOKEN", cancellationToken: cts.Token);
var me = await bot.GetMe();
bot.OnMessage += OnMessage;

Console.WriteLine($"@{me.Username} is running... Press Enter to terminate");
Console.ReadLine();
cts.Cancel(); // stop the bot

// method that handle messages received by the bot:
async Task OnMessage(Message msg, UpdateType type)
{
    if (msg.Text is null) return;	// we only handle Text messages here
    Console.WriteLine($"Received {type} '{msg.Text}' in {msg.Chat}");
    // let's echo back received text in the chat
    await bot.SendMessage(msg.Chat, $"{msg.From} said: {msg.Text}");
}
</code></pre>
<p>Run the program:</p>
<pre><code class="language-bash">dotnet run
</code></pre>
<p>It runs waiting for text messages unless forcefully stopped by pressing Enter. Open a private chat with your bot in
Telegram and send a text message to it. Bot should reply immediately.</p>
<p>By setting <code>bot.OnMessage</code>, the bot client starts polling Telegram servers for messages received by the bot.
This is done automatically in the background, so your program continue to execute and we use <code>Console.ReadLine()</code> to keep it running until you press Enter.</p>
<p>When user sends a message, the <code>OnMessage(...)</code> method gets invoked with the <code>Message</code> object passed as an argument (and the type of update).</p>
<p>We check <code>Message.Type</code> and skip the rest if it is not a text message.
Finally, we send a text message back to the same chat we got the message from.</p>
<p>If you take a look at the console, the program outputs the <code>chatId</code> numeric value.<br>In a private chat with you, it would be your <code>userId</code>, so remember it as it‚Äôs useful to send yourself messages.</p>
<pre><code class="language-text">Received Message 'test' in Private chat with @You (123456789).
</code></pre>
<!-- -->
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="full-example"><a class="header" href="#full-example">Full Example</a></h1>
<p>On the <a href="#your-first-chat-bot">previous page</a> we got a basic bot reacting to messages via <code>bot.OnMessage</code>.</p>
<p>Now, we are going to set also <code>bot.OnUpdate</code> and <code>bot.OnError</code> to make a more complete bot</p>
<p>Modify your <code>Program.cs</code> to the following:</p>
<pre><code class="language-c#">using Telegram.Bot;
using Telegram.Bot.Polling;
using Telegram.Bot.Types;
using Telegram.Bot.Types.Enums;
using Telegram.Bot.Types.ReplyMarkups;

using var cts = new CancellationTokenSource();
var bot = new TelegramBotClient("YOUR_BOT_TOKEN", cancellationToken: cts.Token);
var me = await bot.GetMe();
bot.OnError += OnError;
bot.OnMessage += OnMessage;
bot.OnUpdate += OnUpdate;

Console.WriteLine($"@{me.Username} is running... Press Enter to terminate");
Console.ReadLine();
cts.Cancel(); // stop the bot

// method to handle errors in polling or in your OnMessage/OnUpdate code
async Task OnError(Exception exception, HandleErrorSource source)
{
    Console.WriteLine(exception); // just dump the exception to the console
}

// method that handle messages received by the bot:
async Task OnMessage(Message msg, UpdateType type)
{
    if (msg.Text == "/start")
    {
        await bot.SendMessage(msg.Chat, "Welcome! Pick one direction",
            replyMarkup: new InlineKeyboardButton[] { "Left", "Right" });
    }
}

// method that handle other types of updates received by the bot:
async Task OnUpdate(Update update)
{
    if (update is { CallbackQuery: { } query }) // non-null CallbackQuery
    {
        await bot.AnswerCallbackQuery(query.Id, $"You picked {query.Data}");
        await bot.SendMessage(query.Message!.Chat, $"User {query.From} clicked on {query.Data}");
    }
}
</code></pre>
<p>Run the program and send <code>/start</code> to the bot.</p>
<blockquote class="blockquote-tag blockquote-tag-note">
<p class="blockquote-tag-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p>
<p><code>/start</code> is the first message your bot receives automatically when a user interacts in private with the bot for the first time</p>
</blockquote>
<p>The bot will reply with its welcome message and 2 inline buttons for you to choose.</p>
<p>When you click on a button, your bot receives an Update of type <strong>CallbackQuery</strong> that is not a simple message.<br>Therefore it will be handled by <code>OnUpdate</code> instead.</p>
<p>We handle this by replying the callback data <em>(which could be different from the button text)</em>,
and which user clicked on it <em>(which could be any user if the message was in a group)</em></p>
<p>The <code>OnError</code> method handles errors, and you would typically log it to trace problems in your bot.</p>
<p>Look at <a href="https://github.com/TelegramBots/Telegram.Bot.Examples/tree/master/Console">the Console example</a> in our <a href="https://github.com/TelegramBots/Telegram.Bot.Examples">Examples repository</a> for an even more complete bot code.</p>
<!-- -->
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="beginner"><a class="header" href="#beginner">Beginner</a></h1>
<ul>
<li><a href="2/send-msg">Sending Messages</a>
<ul>
<li><a href="#media-messages">Sending Media</a></li>
<li><a href="#native-poll-messages">Native Polls</a></li>
<li><a href="#other-messages">Other Messages</a></li>
</ul>
</li>
<li><a href="#dealing-with-chats">Dealing with chats</a></li>
<li><a href="#reply-markup">Reply Markup</a></li>
<li><a href="#forward-copy-or-delete-messages">Forward, Copy or Delete</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="sending-messages"><a class="header" href="#sending-messages">Sending Messages</a></h1>
<p><a href="https://core.telegram.org/bots/api#sendmessage"><img src="https://img.shields.io/badge/Bot_API_method-sendMessage-blue.svg?style=flat-square" alt="send message method"></a>
<a href="https://github.com/TelegramBots/Telegram.Bot/blob/master/test/Telegram.Bot.Tests.Integ/Sending%20Messages/TextMessageTests.cs"><img src="https://img.shields.io/badge/Examples-Text_Messages-green.svg?style=flat-square" alt="tests"></a></p>
<p>There are many different types of message that a bot can send, but let‚Äôs start with text messages.</p>
<h2 id="basic-text-message"><a class="header" href="#basic-text-message">Basic text message</a></h2>
<pre><code class="language-csharp">await bot.SendMessage(chatId, "Hello, World!");
</code></pre>
<p><img src="2/docs/shot-text_msg.jpg" alt="text message screenshot"></p>
<p>The <code>chatId</code> parameter would typically be the ID of a chat or a user that you obtained on a <a href="3/updates">received message</a>,
or it can be the @username of a public group/channel.</p>
<h2 id="advanced-text-message"><a class="header" href="#advanced-text-message">Advanced text message</a></h2>
<p>You can send messages with more characteristics:</p>
<ul>
<li>text effects <em>(using HTML, Markdown, or text entities)</em></li>
<li>attached inline buttons</li>
<li>as a reply to a message</li>
<li>and more‚Ä¶</li>
</ul>
<blockquote class="blockquote-tag blockquote-tag-important">
<p class="blockquote-tag-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v9.5A1.75 1.75 0 0 1 14.25 13H8.06l-2.573 2.573A1.458 1.458 0 0 1 3 14.543V13H1.75A1.75 1.75 0 0 1 0 11.25Zm1.75-.25a.25.25 0 0 0-.25.25v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25Zm7 2.25v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>Important</p>
<p>We highly recommend you use HTML instead of Markdown because Markdown has lots of annoying aspects</p>
</blockquote>
<p>The code snippet below sends a message using various parameters:</p>
<pre><code class="language-csharp">var message = await bot.SendMessage(chatId, "Trying &lt;b&gt;all the parameters&lt;/b&gt; of &lt;code&gt;sendMessage&lt;/code&gt; method",
    ParseMode.Html,
    protectContent: true,
    replyParameters: update.Message.Id,
    replyMarkup: new InlineKeyboardButton("Check sendMessage method", "https://core.telegram.org/bots/api#sendmessage"));
</code></pre>
<p><img src="2/docs/shot-text_msg2.jpg" alt="text message screenshot"></p>
<p>Here <code>text</code> is written in <a href="https://core.telegram.org/bots/api#html-style">HTML format</a> and <code>parseMode</code> indicates that.</p>
<p>By passing <code>protectContent</code> we prevent the message (and eventual media) to be copiable/forwardable elsewhere.</p>
<p>It‚Äôs a good idea to make it clear to a user the reason why the bot is sending this message and that‚Äôs why we pass the user‚Äôs
message id for <code>replyParameters</code>.</p>
<p>You have the option of specifying a <code>replyMarkup</code> when sending messages.
Reply markups are explained in details later in this book.
Here we used an <em>Inline Keyboard Markup</em> with a button that attaches to the message itself.
Clicking that opens <a href="https://core.telegram.org/bots/api#sendmessage"><code>sendMessage</code></a> method documentation in the browser.</p>
<h2 id="observing-the-message-that-just-got-sent"><a class="header" href="#observing-the-message-that-just-got-sent">Observing the Message that just got sent</a></h2>
<p>Almost all of the Send* methods return the message you just sent. Let‚Äôs have a look at this object. Add this statement after the previous code.</p>
<pre><code class="language-csharp">Console.WriteLine(
    $"{message.From.FirstName} sent message {message.Id} " +
    $"to chat {message.Chat.Id} at {message.Date}. " +
    $"It is a reply to message {message.ReplyToMessage.Id} " +
    $"and has {message.Entities.Length} message entities.");
</code></pre>
<p>Output should look similar to this:</p>
<pre><code class="language-text">Awesome bot sent message 123 to chat 123456789 at 8/21/18 11:25:09 AM. It is a reply to message 122 and has 2 message entities.
</code></pre>
<p>Try putting a breakpoint in the code to examine all the properties on a message objects you get.</p>
<p>There are a few things to note:</p>
<ul>
<li><code>message.Date</code> is a timestamp in <a href="https://en.wikipedia.org/wiki/Coordinated_Universal_Time">UTC format</a> (use <code>message.Date.ToLocalTime()</code> to convert to your local timezone).</li>
<li><code>message.Text</code>: plain text without effects</li>
<li><code>message.Entities</code>: list of <a href="https://core.telegram.org/bots/api#messageentity">text effects</a> to be applied to the plain text</li>
<li><code>message.EntityValues</code>: text parts covered by these entities</li>
</ul>
<p>You can use our extension methods <code>message.ToHtml()</code> or <code>message.ToMarkdown()</code> to convert the text &amp; entities of a <code>Message</code> back into HTML <strong>(recommended)</strong> or Markdown.</p>
<h2 id="more-message-types"><a class="header" href="#more-message-types">More message types</a></h2>
<p>Discover more message types in the <a href="#media-messages">next pages</a>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="media-messages"><a class="header" href="#media-messages">Media Messages</a></h1>
<p>There are different types of media messages that a bot can send (photos, videos, documents‚Ä¶).
Fortunately, methods for sending such messages are similar (see sections below for examples)</p>
<p>But let‚Äôs first see what they have in common.</p>
<h2 id="providing-the-source-file"><a class="header" href="#providing-the-source-file">Providing the source file</a></h2>
<p>You can provide the file data in 3 ways:</p>
<ul>
<li>Using the Internet URL to the file (must point to the actual file, not an HTML webpage)</li>
<li>Uploading the file data as a stream</li>
<li>Using the <code>FileId</code> of a file that was already sent over Telegram (ex: <code>msg.Video.FileId</code>, <code>msg.Photo[^1].FileId</code>‚Ä¶)</li>
</ul>
<p>Examples in this section show all three.
You will learn more about them later on when we discuss file <a href="3/files/upload.html">upload</a> and <a href="3/files/download.html">download</a>.</p>
<h2 id="providing-the-caption"><a class="header" href="#providing-the-caption">Providing the caption</a></h2>
<p>Media messages can <em>optionally</em> have a text attached to them (called ‚ÄúCaption‚Äù).</p>
<p><a href="2/send-msg">Similar to text message</a>, the caption can have text effects (specifying <code>ParseMode.HTML</code> or <code>Markdown</code>, or manual captionEntities)</p>
<p>The Message object returned by the Send* method will have:</p>
<ul>
<li><code>message.Caption</code>: caption in plain text without effects</li>
<li><code>message.CaptionEntities</code>: list of <a href="https://core.telegram.org/bots/api#messageentity">text effects</a> to be applied to the plain text</li>
<li><code>message.CaptionEntityValues</code>: caption text parts covered by these entities</li>
</ul>
<p>You can use our extension methods <code>message.ToHtml()</code> or <code>message.ToMarkdown()</code> to convert the caption &amp; entities of a <code>Message</code> back into HTML <strong>(recommended)</strong> or Markdown.</p>
<h2 id="photo"><a class="header" href="#photo">Photo</a></h2>
<p><a href="https://core.telegram.org/bots/api#sendphoto"><img src="https://img.shields.io/badge/Bot_API_method-sendPhoto-blue.svg?style=flat-square" alt="send photo method"></a>
<a href="https://github.com/TelegramBots/Telegram.Bot/blob/master/test/Telegram.Bot.Tests.Integ/Sending%20Messages/SendingPhotoMessageTests.cs"><img src="https://img.shields.io/badge/Examples-Photo_Messages-green.svg?style=flat-square" alt="photo tests"></a></p>
<p>Sending a photo is simple. Here is an example:</p>
<pre><code class="language-csharp">var message = await bot.SendPhoto(chatId, "https://telegrambots.github.io/book/docs/photo-ara.jpg",
    "&lt;b&gt;Ara bird&lt;/b&gt;. &lt;i&gt;Source&lt;/i&gt;: &lt;a href=\"https://pixabay.com\"&gt;Pixabay&lt;/a&gt;", ParseMode.Html);
</code></pre>
<p><img src="2/docs/shot-photo_msg.jpg" alt="photo message"></p>
<p>Here we sent a caption in HTML format. The user can click on <u><a href="https://pixabay.com">Pixabay</a></u> in the caption to open its URL in the browser.</p>
<p>The <code>Message</code> returned by the SendPhoto method represents a <em>photo message</em> because <code>message.Photo</code> has a value.
Its value is an array with each  <a href="https://core.telegram.org/bots/api#photosize">PhotoSize</a> representing the same photo in different resolutions, with the largest dimensions last.</p>
<h2 id="sticker"><a class="header" href="#sticker">Sticker</a></h2>
<p><a href="https://core.telegram.org/bots/api#sendsticker"><img src="https://img.shields.io/badge/Bot_API_method-sendSticker-blue.svg?style=flat-square" alt="send sticker method"></a>
<a href="https://github.com/TelegramBots/Telegram.Bot/blob/master/test/Telegram.Bot.Tests.Integ/Stickers/StickersTests.cs"><img src="https://img.shields.io/badge/Examples-Sticker_Messages-green.svg?style=flat-square" alt="sticker tests"></a></p>
<p>Telegram stickers are fun. They can be static (PNG or <a href="https://developers.google.com/speed/webp/">WebP</a> format), <a href="https://core.telegram.org/stickers">animated or video</a> stickers</p>
<p>This code sends the same sticker twice. First by passing an URL to a WebP sticker file
and second by reusing <code>FileId</code> of the same sticker on Telegram servers.</p>
<pre><code class="language-csharp">var message1 = await bot.SendSticker(chatId, "https://telegrambots.github.io/book/docs/sticker-fred.webp");
var message2 = await bot.SendSticker(chatId, message1.Sticker!.FileId);
</code></pre>
<p><img src="2/docs/shot-sticker_msgs.jpg" alt="sticker messages"></p>
<h2 id="video"><a class="header" href="#video">Video</a></h2>
<p><a href="https://core.telegram.org/bots/api#sendvideo"><img src="https://img.shields.io/badge/Bot_API_method-sendVideo-blue.svg?style=flat-square" alt="method sendVideo"></a>
<a href="https://github.com/TelegramBots/Telegram.Bot/blob/master/test/Telegram.Bot.Tests.Integ/Sending%20Messages/VideoMessageTests.cs"><img src="https://img.shields.io/badge/Examples-Video_Messages-green.svg?style=flat-square" alt="tests"></a></p>
<p>You can send video via MP4 files (other formats may not be supported natively by Telegram clients and can be sent as Document)</p>
<p>Let‚Äôs send it differently this time by uploading the file from disk.
To run this example, download the <a href="https://telegrambots.github.io/book/docs/video-hawk.mp4">Hawk video</a> to your disk.</p>
<pre><code class="language-csharp">await using Stream stream = File.OpenRead("./video-hawk.mp4");
await bot.SendVideo(chatId, stream);
</code></pre>
<p><img src="2/docs/shot-video.jpg" alt="video message screenshot"></p>
<p>Videos, like other multimedia messages, can have caption, reply, reply markup, and etc.
You can optionally specify the duration and resolution of the video.</p>
<p>In the example below, we send a video of a 10 minute countdown
and expect the Telegram clients to stream that long video instead of downloading it completely.
We also set a thumbnail image for our video.</p>
<pre><code class="language-csharp">await bot.SendVideo(chatId, "https://telegrambots.github.io/book/docs/video-countdown.mp4",
    thumbnail: "https://telegrambots.github.io/book/2/docs/thumb-clock.jpg", supportsStreaming: true);
</code></pre>
<p><img src="2/docs/shot-video_thumb1.jpg" alt="video screenshot 1"></p>
<p>User should be able to seek through the video without the video being downloaded completely.</p>
<h2 id="audio"><a class="header" href="#audio">Audio</a></h2>
<p><a href="https://core.telegram.org/bots/api#sendaudio"><img src="https://img.shields.io/badge/Bot_API_method-sendAudio-blue.svg?style=flat-square" alt="send audio method"></a>
<a href="https://github.com/TelegramBots/Telegram.Bot/blob/master/test/Telegram.Bot.Tests.Integ/Sending%20Messages/AudioMessageTests.cs"><img src="https://img.shields.io/badge/Examples-Audio_Messages-green.svg?style=flat-square" alt="audio tests"></a></p>
<p>Here is the code to send an MP3 soundtrack.</p>
<pre><code class="language-csharp">var msg = await bot.SendAudio(chatId, "https://telegrambots.github.io/book/docs/audio-guitar.mp3"
    //  , performer: "Joel Thomas Hunger", title: "Fun Guitar and Ukulele", duration: 91    // optional
    );
</code></pre>
<p>You might be wondering why some parameters are commented out?
That‚Äôs because this MP3 file has metadata on it and Telegram does a good job at reading it.</p>
<p><img src="2/docs/shot-audio_msg.jpg" alt="audio message"></p>
<p>The method returns an audio Message with the metadata associated with the audio (ex: <code>msg.Audio.Performer</code>, <code>msg.Audio.Duration</code>‚Ä¶)</p>
<h2 id="voice"><a class="header" href="#voice">Voice</a></h2>
<p><a href="https://core.telegram.org/bots/api#sendvoice"><img src="https://img.shields.io/badge/Bot_API_method-sendVoice-blue.svg?style=flat-square" alt="send voice method"></a></p>
<p>A voice message is similar to audio but has OGG format and is not shown in music player.</p>
<p>Here we pass a value for <code>duration</code> because Telegram can‚Äôt figure that out from a file‚Äôs metadata.</p>
<pre><code class="language-csharp">var msg = await bot.SendVoice(chatId, "https://telegrambots.github.io/book/docs/voice-nfl_commentary.ogg", duration: 36);
</code></pre>
<p><img src="2/docs/shot-voice_msg.jpg" alt="voice message"></p>
<p>A voice message is returned from the method. Inspect the <code>msg.Voice</code> properties to learn more.</p>
<h2 id="video-note"><a class="header" href="#video-note">Video Note</a></h2>
<p><a href="https://core.telegram.org/bots/api#sendvideonote"><img src="https://img.shields.io/badge/Bot_API_method-sendVideoNote-blue.svg?style=flat-square" alt="method sendVideoNote"></a></p>
<p>Sending video notes is similar to video, but they are shown in circles to the user, usually short (1 minute or less) with identical width and height.</p>
<p>Note: Sending video note via an URL is not supported currently.</p>
<p>Download the <a href="https://telegrambots.github.io/book/docs/video-waves.mp4">Sea Waves video</a> to your disk for this example.</p>
<pre><code class="language-csharp">await using Stream stream = File.OpenRead("path/to/video-waves.mp4");
await bot.SendVideoNote(chatId, stream, duration: 47, length: 360); // length = width = height
</code></pre>
<p><img src="2/docs/shot-video_note.jpg" alt="video note screenshot"></p>
<h2 id="document-files"><a class="header" href="#document-files">Document (files)</a></h2>
<p><a href="https://core.telegram.org/bots/api#senddocument"><img src="https://img.shields.io/badge/Bot_API_method-sendDocument-blue.svg?style=flat-square" alt="sendDocument method"></a>
<a href="https://github.com/TelegramBots/Telegram.Bot/blob/master/test/Telegram.Bot.Tests.Integ/Sending%20Messages/DocumentMessageTests.cs"><img src="https://img.shields.io/badge/Examples-Document_Message-green.svg?style=flat-square" alt="tests"></a></p>
<p>Use <a href="https://core.telegram.org/bots/api#senddocument"><code>SendDocument</code></a> method to send general files.</p>
<pre><code class="language-csharp">await bot.SendDocument(chatId, "https://telegrambots.github.io/book/docs/photo-ara.jpg",
    "&lt;b&gt;Ara bird&lt;/b&gt;. &lt;i&gt;Source&lt;/i&gt;: &lt;a href=\"https://pixabay.com\"&gt;Pixabay&lt;/a&gt;", ParseMode.Html);
</code></pre>
<p>Using <code>SendDocument</code> to send a photo or video ensure that the file data is unchanged (not recompressed and metadata are preserved)</p>
<h2 id="animation-gif-or-gifv"><a class="header" href="#animation-gif-or-gifv">Animation (GIF or gifv)</a></h2>
<p><a href="https://core.telegram.org/bots/api#sendanimation"><img src="https://img.shields.io/badge/Bot_API_method-sendAnimation-blue.svg?style=flat-square" alt="sendAnimation method"></a>
<a href="https://github.com/TelegramBots/Telegram.Bot/blob/master/test/Telegram.Bot.Tests.Integ/Sending%20Messages/AnimationMessageTests.cs"><img src="https://img.shields.io/badge/Examples-Animation_Message-green.svg?style=flat-square" alt="tests"></a></p>
<p>Use <a href="https://core.telegram.org/bots/api#sendanimation"><code>SendAnimation</code></a> method to send animation files (GIF or H.264/MPEG-4 AVC video without sound).</p>
<pre><code class="language-csharp">await bot.SendAnimation(chatId, "https://telegrambots.github.io/book/docs/video-waves.mp4", "Waves");
</code></pre>
<h2 id="media-group-album-of-multiple-media"><a class="header" href="#media-group-album-of-multiple-media">Media group (album of multiple media)</a></h2>
<p><a href="https://core.telegram.org/bots/api#sendmediagroup"><img src="https://img.shields.io/badge/Bot_API_method-sendMediaGroup-blue.svg?style=flat-square" alt="send media group method"></a>
<a href="https://github.com/TelegramBots/Telegram.Bot/blob/master/test/Telegram.Bot.Tests.Integ/Sending%20Messages/AlbumMessageTests.cs"><img src="https://img.shields.io/badge/Examples-Album_Messages-green.svg?style=flat-square" alt="tests"></a></p>
<p>Using <a href="https://core.telegram.org/bots/api#sendmediagroup"><code>SendMediaGroup</code></a> method you can send a group of photos, videos, documents or audios as an album. Documents and audio files can be only grouped in an album with messages of the same type.</p>
<pre><code class="language-csharp">var messages = await bot.SendMediaGroup(chatId, new IAlbumInputMedia[]
    {
        new InputMediaPhoto("https://cdn.pixabay.com/photo/2017/06/20/19/22/fuchs-2424369_640.jpg"),
        new InputMediaPhoto("https://cdn.pixabay.com/photo/2017/04/11/21/34/giraffe-2222908_640.jpg"),
    });
</code></pre>
<p>Note that media groups can‚Äôt have reply markup. The caption must be set on one of the media (usually the first)</p>
<h3 id="receiving-a-media-group-album"><a class="header" href="#receiving-a-media-group-album">Receiving a media group (album)</a></h3>
<p>When your bot <a href="3/updates/README.html">receives updates</a> for a media group, it will appear as separate messages <em>(one per media, usually consecutive)</em> having the same <code>MediaGroupId</code> property.</p>
<p>You should collect them progressively as you receive those messages.<br>There is no way to know how many medias are in the album, so here are some techniques:</p>
<ul>
<li>look for consecutive messages in that chat with same <code>MediaGroupId</code> and stop when it‚Äôs not the same</li>
<li>stop after 10 medias in the group (maximum)</li>
<li>use a timeout of a few seconds not receiving new messages in that chat to determine the end</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="sendhtml-helper-method"><a class="header" href="#sendhtml-helper-method">SendHtml helper method</a></h1>
<p>SendHtml is an all-in-one helper method to send various type of messages in a very simple way.<br>It‚Äôs using <a href="https://core.telegram.org/bots/api#html-style">HTML-formatted text</a>, with extra tags to support the sending of medias and <a href="#sending-keyboards">attached keyboard</a>.</p>
<p><em>Note: method is only available for .NET 6+</em></p>
<p>Look at the examples below to see how easy it is to use:</p>
<h3 id="sending-a-simple-html-text-message"><a class="header" href="#sending-a-simple-html-text-message">Sending a simple HTML text message</a></h3>
<pre><code class="language-csharp">var msg = await bot.SendHtml(chatId, """
    Try the new &lt;code&gt;SendHtml&lt;/code&gt; method...
    It is &lt;tg-spoiler&gt;awesome!!&lt;/tg-spoiler&gt;
    """);
</code></pre>
<h3 id="sending-a-photo-with-caption"><a class="header" href="#sending-a-photo-with-caption">Sending a photo with caption</a></h3>
<pre><code class="language-csharp">var msg = await bot.SendHtml(chatId, """
    &lt;img src="https://telegrambots.github.io/book/docs/photo-ara.jpg"&gt;
    &lt;b&gt;Ara bird&lt;/b&gt;. &lt;i&gt;Source&lt;/i&gt;: &lt;a href="https://pixabay.com"&gt;Pixabay&lt;/a&gt;
    """);
</code></pre>
<h3 id="sending-a-photo-with-spoiler"><a class="header" href="#sending-a-photo-with-spoiler">Sending a photo with spoiler</a></h3>
<pre><code class="language-csharp">var msg = await bot.SendHtml(chatId, """
    &lt;img src="https://telegrambots.github.io/book/docs/photo-ara.jpg" spoiler&gt;
    &lt;b&gt;Ara bird&lt;/b&gt;. &lt;i&gt;Source&lt;/i&gt;: &lt;a href="https://pixabay.com"&gt;Pixabay&lt;/a&gt;
    """);
</code></pre>
<h3 id="sending-with-caption-above-the-photo"><a class="header" href="#sending-with-caption-above-the-photo">Sending with caption above the photo</a></h3>
<pre><code class="language-csharp">var msg = await bot.SendHtml(chatId, """
    &lt;b&gt;Ara bird&lt;/b&gt;. &lt;i&gt;Source&lt;/i&gt;: &lt;a href="https://pixabay.com"&gt;Pixabay&lt;/a&gt;
    &lt;img src="https://telegrambots.github.io/book/docs/photo-ara.jpg"&gt;
    """);
</code></pre>
<p>The position of text before or after <code>&lt;img&gt;</code> and <code>&lt;video&gt;</code> determines if the caption should appear above or below the medias.</p>
<h3 id="sending-a-video"><a class="header" href="#sending-a-video">Sending a video</a></h3>
<pre><code class="language-csharp">var msg = await bot.SendHtml(chatId, """
    &lt;video src="https://telegrambots.github.io/book/docs/video-countdown.mp4"&gt;
    """);
</code></pre>
<h3 id="sending-a-video-with-fileid-instead-of-url-and-spoiler"><a class="header" href="#sending-a-video-with-fileid-instead-of-url-and-spoiler">Sending a video with FileID instead of URL <em>(and spoiler)</em></a></h3>
<pre><code class="language-csharp">var msg = await bot.SendHtml(chatId, $"""
    &lt;video src="{previousMsg.Video.FileId}" spoiler&gt;
    We use a FileID as the video src
    """);
</code></pre>
<h3 id="sending-an-album-with-2-photos"><a class="header" href="#sending-an-album-with-2-photos">Sending an album with 2 photos</a></h3>
<pre><code class="language-csharp">var msg = await bot.SendHtml(chatId, """
    &lt;img src="https://cdn.pixabay.com/photo/2017/06/20/19/22/fuchs-2424369_640.jpg"&gt;
    &lt;img src="https://cdn.pixabay.com/photo/2017/04/11/21/34/giraffe-2222908_640.jpg"&gt;
    Album caption (attached to the last photo)
    """);
</code></pre>
<h3 id="sending-an-album-with-caption-attached-to-first-media"><a class="header" href="#sending-an-album-with-caption-attached-to-first-media">Sending an album with caption attached to first media</a></h3>
<pre><code class="language-csharp">var msg = await bot.SendHtml(chatId, """
    &lt;img src="https://cdn.pixabay.com/photo/2017/06/20/19/22/fuchs-2424369_640.jpg"&gt;
    Album caption (attached to the first photo)
    &lt;img src="https://cdn.pixabay.com/photo/2017/04/11/21/34/giraffe-2222908_640.jpg"&gt;
    """);
</code></pre>
<h3 id="sending-an-album-with-caption-above-the-medias"><a class="header" href="#sending-an-album-with-caption-above-the-medias">Sending an album with caption above the medias</a></h3>
<pre><code class="language-csharp">var msg = await bot.SendHtml(chatId, """
    Album caption above the photos
    &lt;img src="https://cdn.pixabay.com/photo/2017/06/20/19/22/fuchs-2424369_640.jpg"&gt;
    &lt;img src="https://cdn.pixabay.com/photo/2017/04/11/21/34/giraffe-2222908_640.jpg"&gt;
    """);
</code></pre>
<h3 id="sending-an-album-of-files-with-caption-on-each-file"><a class="header" href="#sending-an-album-of-files-with-caption-on-each-file">Sending an album of files with caption on each file</a></h3>
<pre><code class="language-csharp">var msg = await bot.SendHtml(chatId, """
    &lt;file src="https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf"&gt;
    Caption of 1st file
    &lt;file src="https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf"&gt;
    Caption of 2nd file
    """);
</code></pre>
<h3 id="sending-an-album-of-audio-files"><a class="header" href="#sending-an-album-of-audio-files">Sending an album of audio files</a></h3>
<pre><code class="language-csharp">var msg = await bot.SendHtml(chatId, """
    &lt;file src="https://upload.wikimedia.org/wikipedia/commons/transcoded/b/bb/Test_ogg_mp3_48kbps.wav/Test_ogg_mp3_48kbps.wav.mp3"&gt;
    &lt;file src="https://upload.wikimedia.org/wikipedia/commons/transcoded/b/bb/Test_ogg_mp3_48kbps.wav/Test_ogg_mp3_48kbps.wav.mp3"&gt;
    Listen to these audio files
    """);
</code></pre>
<h3 id="sending-an-album-with-uploaded-streams"><a class="header" href="#sending-an-album-with-uploaded-streams">Sending an album with uploaded streams</a></h3>
<pre><code class="language-csharp">await using var stream0 = File.OpenRead(@"C:\Pictures\banner.png");
await using var stream1 = File.OpenRead(@"C:\Pictures\image.jpg");
var msg = await bot.SendHtml(chatId, """
    &lt;img src="image.jpg"&gt;
    &lt;img src="stream://0"&gt;
    """, streams: [stream0, stream1]);
</code></pre>
<p>Pass a stream list in method argument <code>streams:</code>, then reference them in html <code>src="..."</code> as <code>stream://N</code> or <code>stream:N</code> or just <code>N</code></p>
<p>N being the indice in the streams list (starting with 0), or the filename for <code>FileStream</code>s</p>
<h2 id="customizing-the-preview-for-text-messages"><a class="header" href="#customizing-the-preview-for-text-messages">Customizing the preview for text messages</a></h2>
<pre><code class="language-csharp">var msg = await bot.SendHtml(chatId, """
    no preview: https://github.com/TelegramBots/Telegram.Bot.Examples
    &lt;preview disabled&gt;
    """);

var msg2 = await bot.SendHtml(chatId, """
    Preview URL is not even in message text
    &lt;preview url="https://github.com/TelegramBots/Telegram.Bot.Examples" small above&gt;
    """);
</code></pre>
<p>Tag <code>&lt;preview&gt;</code> supports the following optional attributes <em>(in this order)</em>:</p>
<ul>
<li><code>disable</code> or <code>disabled</code> <em>(no preview even if text contains links)</em></li>
<li><code>url="..."</code> <em>(force preview for this URL, even if not present in the message text)</em></li>
<li><code>small</code> or <code>large</code> <em>(size of the preview image)</em></li>
<li><code>above</code></li>
</ul>
<p>Note: the <code>&lt;preview&gt;</code> tag must appear after the text of the message, and only if no media is specified</p>
<h2 id="sending-keyboards"><a class="header" href="#sending-keyboards">Sending keyboards</a></h2>
<p>Note: the <code>&lt;keyboard&gt;..&lt;/keyboard&gt;</code> section must be at the end of the message</p>
<h3 id="text-message-with-one-inline-button"><a class="header" href="#text-message-with-one-inline-button">Text message with one Inline button</a></h3>
<pre><code class="language-csharp">var msg = await bot.SendHtml(chatId, """
    Simple message &lt;u&gt;with a button&lt;/u&gt;
    &lt;keyboard&gt;
    &lt;button text="URL button" url="example.com"&gt;
    &lt;/keyboard&gt;
    """);
</code></pre>
<h3 id="photo-with-two-callback-buttons"><a class="header" href="#photo-with-two-callback-buttons">Photo with two callback buttons</a></h3>
<pre><code class="language-csharp">var msg = await bot.SendHtml(chatId, """
    &lt;img src="https://telegrambots.github.io/book/docs/photo-ara.jpg"&gt;
    Do you like this photo?
    &lt;keyboard&gt;
    &lt;button text="Yes" callback="ara-yes"&gt;
    &lt;button text="No" callback="ara-no"&gt;
    &lt;/keyboard&gt;
    """);
</code></pre>
<h3 id="multi-row-keyboard-and-various-types-of-inline-buttons"><a class="header" href="#multi-row-keyboard-and-various-types-of-inline-buttons">Multi-row keyboard and various types of inline buttons</a></h3>
<pre><code class="language-csharp">var msg = await bot.SendHtml(chatId, """
    Inline keyboard example
    &lt;keyboard&gt;
    &lt;button text="URL button" url="https://github.com/TelegramBots/Telegram.Bot"&gt;
    &lt;button text="Callback btn" callback="data"&gt;
    &lt;row&gt;
    &lt;button text="Copy btn" copy="Some Text"&gt;
    &lt;button text="Switch inline" switch_inline="query" target="user,bot"&gt;
    &lt;/row&gt;
    &lt;/keyboard&gt;
    """);
</code></pre>
<p>Notes:</p>
<ul>
<li>Button type <code>switch_inline</code> supports this set of <code>target=</code> values: <code>user</code>, <code>bot</code>, <code>group</code>, <code>channel</code><br>Omitting the <code>target=</code> directly types the inline query in the current chat<br>Invalid values like <code>target=""</code>, <code>target="*"</code>, <code>target="any"</code> will target all kinds of chat</li>
<li>Button type <code>app="&lt;AppURL&gt;"</code> works only in private chats</li>
</ul>
<h3 id="using-reply-buttons"><a class="header" href="#using-reply-buttons">Using Reply buttons</a></h3>
<pre><code class="language-csharp">var msg = await bot.SendHtml(chatId, """
    Reply keyboard example
    &lt;keyboard reply&gt;
    &lt;button text="Yes"&gt;
    &lt;button text="No"&gt;
    &lt;button text="Maybe"&gt;
    &lt;row&gt;
    &lt;button text="Send my contact" request_contact&gt;
    &lt;button text="Send my location" request_location&gt;
    &lt;button text="Send a poll" request_poll="any"&gt;
    &lt;/keyboard&gt;
    """);
</code></pre>
<p>Notes:</p>
<ul>
<li>Closing tag <code>&lt;/row&gt;</code> is optional.</li>
<li>Button type <code>request_poll_=".."</code> supports values: <code>any</code>, <code>quiz</code>, <code>regular</code></li>
<li>Button type <code>app="&lt;AppURL&gt;"</code> works only in private chats</li>
</ul>
<h3 id="force-the-user-to-reply-to-this-message"><a class="header" href="#force-the-user-to-reply-to-this-message">Force the user to reply to this message</a></h3>
<pre><code class="language-csharp">var msg = await bot.SendHtml(chatId, """
    Please give your name in reply to this message
    &lt;keyboard reply_force="Type your name here"&gt;&lt;/keyboard&gt;
    """);
</code></pre>
<h3 id="removing-the-reply-keyboard"><a class="header" href="#removing-the-reply-keyboard">Removing the Reply keyboard</a></h3>
<pre><code class="language-csharp">var msg = await bot.SendHtml(chatId, """
    Thank you
    &lt;keyboard reply_remove&gt;&lt;/keyboard&gt;
    """);
</code></pre>
<p>Note: The <code>&lt;keyboard&gt;</code> tag <u>must</u> be closed with <code>&lt;/keyboard&gt;</code> as the last closing tag (not with a simple <code>¬†/&gt;</code>)</p>
<h1 id="edithtml--edithtmlinline-helper-methods"><a class="header" href="#edithtml--edithtmlinline-helper-methods">EditHtml / EditHtmlInline helper methods</a></h1>
<p>Similarly to <code>SendHtml</code>, the <code>EditHtml</code> (or <code>EditHtmlInline</code>) method allows to modify existing message and media groups <em>(multiple messages)</em> using the same system of HTML-formatted string.</p>
<pre><code class="language-csharp">var msg = await bot.EditHtml(chatId, msg.Id, """
    &lt;img src="https://cdn.pixabay.com/photo/2018/08/21/08/38/parrot-3620776_1280.jpg"&gt;
    Changed the image for Ara with both wings. &lt;i&gt;Source&lt;/i&gt;: &lt;a href="https://pixabay.com"&gt;Pixabay&lt;/a&gt;
    """);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="native-poll-messages"><a class="header" href="#native-poll-messages">Native Poll Messages</a></h1>
<p><a href="https://github.com/TelegramBots/Telegram.Bot/blob/master/test/Telegram.Bot.Tests.Integ/Polls/AnonymousPollTests.cs"><img src="https://img.shields.io/badge/Examples-Native_Polls-green.svg?style=flat-square" alt="native poll tests"></a></p>
<p>Native poll are a special kind of message with question &amp; answers where users can vote. Options can be set to allow multiple answers, vote anonymously, or be a quizz with a correct choice and explanation.</p>
<h2 id="send-a-poll"><a class="header" href="#send-a-poll">Send a poll</a></h2>
<p><a href="https://core.telegram.org/bots/api#sendpoll"><img src="https://img.shields.io/badge/Bot_API_method-sendPoll-blue.svg?style=flat-square" alt="sendPoll method"></a></p>
<p>This is the code to send a poll to a chat.</p>
<pre><code class="language-c#">var pollMessage = await bot.SendPoll("@channel_name",
    "Did you ever hear the tragedy of Darth Plagueis The Wise?",
    [
        "Yes for the hundredth time!",
        "No, who`s that?"
    ]);
</code></pre>
<p><img src="2/docs/shot-native_poll_msg.jpeg" alt="native poll"></p>
<p>You can optionally send a keyboard with a poll, both an inline or a regular one.</p>
<p>You‚Äôll get the message with <a href="https://github.com/TelegramBots/Telegram.Bot/blob/master/src/Telegram.Bot/Types/Poll.cs"><code>Poll</code></a> object inside it.</p>
<h2 id="stop-a-poll"><a class="header" href="#stop-a-poll">Stop a poll</a></h2>
<p><a href="https://core.telegram.org/bots/api#stoppoll"><img src="https://img.shields.io/badge/Bot_API_method-stopPoll-blue.svg?style=flat-square" alt="stopPoll method"></a></p>
<p>To close a poll you need to know original chat and message ids of the poll that you got from calling <code>SendPoll</code> method.</p>
<p>Let‚Äôs close the poll that we sent in the previous example:</p>
<pre><code class="language-c#">Poll poll = await bot.StopPoll(pollMessage.Chat, pollMessage.Id);
</code></pre>
<p><img src="2/docs/shot-native_poll_closed.jpeg" alt="closed native poll"></p>
<p>You can add an inline keyboard when you close a poll.</p>
<p>As a result of the request you‚Äôll get the the final poll state with property <code>Poll.IsClosed</code> set to true.</p>
<p>If you‚Äôll try to close a forwarded poll using message and chat ids from the received message even if your bot is the author of the poll you‚Äôll get an <code>ApiRequestException</code> with message <code>Bad Request: poll can't be stopped</code>. Polls originated from channels is an exception since forwarded messages originated from channels contain original chat and message ids inside properties <code>Message.ForwardFromChat.Id</code> and <code>Message.ForwardFromMessageId</code>.</p>
<p>Also if you‚Äôll try to close an already closed poll you‚Äôll get <code>ApiRequestException</code> with message <code>Bad Request: poll has already been closed</code>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="other-messages"><a class="header" href="#other-messages">Other Messages</a></h1>
<p>There are other kind of message types which are supported by the client. In the following paragraphs we will look how to send contacts, venues or locations.</p>
<h2 id="contact"><a class="header" href="#contact">Contact</a></h2>
<p><a href="https://core.telegram.org/bots/api#sendcontact"><img src="https://img.shields.io/badge/Bot_API_method-sendContact-blue.svg?style=flat-square" alt="send contact method"></a>
<a href="https://github.com/TelegramBots/Telegram.Bot/blob/master/test/Telegram.Bot.Tests.Integ/Sending%20Messages/SendingContactMessageTests.cs"><img src="https://img.shields.io/badge/Examples-Contact-green.svg?style=flat-square" alt="send contacts tests"></a></p>
<p>This is the code to send a contact. Mandatory are the parameters <code>chatId</code>, <code>phoneNumber</code> and <code>firstName</code>.</p>
<pre><code class="language-c#">await bot.SendContact(chatId, "+1234567890", "Han", "Solo");
</code></pre>
<p><img src="2/docs/shot-contact.jpg" alt="send contact"></p>
<p>If you want to send a contact as vCard you can achieve  this by adding a valid vCard <code>string</code> as value for the optional parameter <code>vCard</code> as seen in the given example below.</p>
<pre><code class="language-c#">await bot.SendContact(chatId, "+1234567890", "Han", vcard: """
    BEGIN:VCARD
    VERSION:3.0
    N:Solo;Han
    ORG:Scruffy-looking nerf herder
    TEL;TYPE=voice,work,pref:+1234567890
    EMAIL:hansolo@mfalcon.com
    END:VCARD
    """);
</code></pre>
<p><img src="2/docs/shot-contact_vcard.jpg" alt="send vcard"></p>
<h2 id="venue"><a class="header" href="#venue">Venue</a></h2>
<p><a href="https://core.telegram.org/bots/api#sendvenue"><img src="https://img.shields.io/badge/Bot_API_method-sendVenue-blue.svg?style=flat-square" alt="send venue method"></a>
<a href="https://github.com/TelegramBots/Telegram.Bot/blob/master/test/Telegram.Bot.Tests.Integ/Sending%20Messages/SendingVenueMessageTests.cs"><img src="https://img.shields.io/badge/Examples-Venue-green.svg?style=flat-square" alt="send venue tests"></a></p>
<p>The code snippet below sends a venue with a title and a address as given parameters:</p>
<pre><code class="language-c#">await bot.SendVenue(chatId, latitude: 50.0840172f, longitude: 14.418288f,
    title: "Man Hanging out", address: "Husova, 110 00 Star√© Mƒõsto, Czechia");
</code></pre>
<p><img src="2/docs/shot-venue.jpg" alt="send contact"></p>
<h2 id="location"><a class="header" href="#location">Location</a></h2>
<p><a href="https://core.telegram.org/bots/api#sendlocation"><img src="https://img.shields.io/badge/Bot_API_method-sendLocation-blue.svg?style=flat-square" alt="send location method"></a>
<a href="https://github.com/TelegramBots/Telegram.Bot/blob/master/test/Telegram.Bot.Tests.Integ/Sending%20Messages/SendingVenueMessageTests.cs"><img src="https://img.shields.io/badge/Examples-Location-green.svg?style=flat-square" alt="send location tests"></a></p>
<p>The difference between sending a location and a venue is, that the venue requires a title and address. A location can be any given point as latitude and longitude.</p>
<p>The following snippet shows how to send a location with the mandatory parameters:</p>
<pre><code class="language-c#">await bot.SendLocation(chatId, latitude: 33.747252f, longitude: -112.633853f);
</code></pre>
<p><img src="2/docs/shot-location.jpg" alt="send contact"></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="dealing-with-chats"><a class="header" href="#dealing-with-chats">Dealing with chats</a></h1>
<p>All messages in Telegram are sent/received on a specific chat.<br>The <code>chat.Type</code> can be one of 4 types:</p>
<ul>
<li><code>ChatType.Private</code>:<br>A private discussion with a user. The <code>chat.Id</code> is the same as the <code>user.Id</code> (positive number)</li>
<li><code>ChatType.Group</code>:<br>A private chat group with less than 200 users</li>
<li><code>ChatType.Supergroup</code>:<br>An advanced chat group, capable of being public, supporting more than 200 users, with specific user/admin rights</li>
<li><code>ChatType.Channel</code>:<br>A broadcast type of publishing feed (only admins can write to it)</li>
</ul>
<p>Additional notes:</p>
<ul>
<li>For groups/channels, the <code>chat.Id</code> is a negative number, and the <code>chat.Title</code> will be filled.</li>
<li>For <u>public</u> groups/channels, the <code>chat.Username</code> will be filled.</li>
<li>For private chat with a user, the <code>chat.FirstName</code> will be filled, and optionally, the <code>chat.LastName</code> and <code>chat.Username</code> if the user has one.</li>
</ul>
<h2 id="calling-chat-methods"><a class="header" href="#calling-chat-methods">Calling chat methods</a></h2>
<p>All methods for dealing with chats <em>(like sending messages, etc..)</em> take a <code>ChatId</code> parameter.</p>
<p>For this parameter, you can pass directly a	<code>long</code> <em>(the chat or user ID)</em>,
or when sending to a public group/channel, you can pass a <code>"@chatname"</code> string</p>
<h3 id="getting-full-info-about-a-chat-getchat"><a class="header" href="#getting-full-info-about-a-chat-getchat">Getting full info about a chat (<code>GetChat</code>)</a></h3>
<p>Once a bot has joined a group/channel or has started receiving messages from a user, it can use method <code>GetChat</code> to get detailed info about that chat/user.</p>
<p>There are lots of information returned depending on the type of chat, and most are optional and may be unavailable.<br>Here are a few interesting ones:</p>
<ul>
<li>For private chat with a User:
<ul>
<li>Birthdate</li>
<li>Personal channel</li>
<li><a href="#business-bot-features">Business</a> information</li>
<li>Bio</li>
</ul>
</li>
<li>For groups/channels:
<ul>
<li>Description</li>
<li>default Permissions <em>(non-administrator access rights)</em></li>
<li>Linked ChatId <em>(the associated channel/discussion group for this chat)</em></li>
<li>IsForum <em>(This chat group has <a href="#forum--topics">topics</a>)</em></li>
</ul>
</li>
<li>Common information for all chats:
<ul>
<li>Photo <em>(use <code>GetInfoAndDownloadFile</code> and the <code>photo.BigFileId</code> to download it)</em></li>
<li>Active Usernames <em>(premium user &amp; public chats can have multiple usernames)</em></li>
<li>Available reactions in this chat</li>
<li>Pinned Message <em>(the most recent one)</em></li>
</ul>
</li>
</ul>
<h2 id="receiving-chat-messages"><a class="header" href="#receiving-chat-messages">Receiving chat messages</a></h2>
<p>See chapter <a href="3/updates">Getting Updates</a> for how to receive updates &amp; messages.</p>
<p>For groups or private chats, you would receive an update of type <code>UpdateType.Message</code> (which means only the field <code>update.Message</code> will be set)</p>
<p>For channel messages, you would receive an update with field <code>update.ChannelPost</code>.</p>
<p>For <a href="4/business">business</a> messages, you would receive an update with field <code>update.BusinessMessage</code>.</p>
<p>If someone modifies an existing message, you would receive an update with one of the fields <code>update.Edited*</code></p>
<p>Note: if you use the <code>bot.OnMessage</code> event, this is simplified and you can just check the UpdateType argument.</p>
<blockquote class="blockquote-tag blockquote-tag-important">
<p class="blockquote-tag-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v9.5A1.75 1.75 0 0 1 14.25 13H8.06l-2.573 2.573A1.458 1.458 0 0 1 3 14.543V13H1.75A1.75 1.75 0 0 1 0 11.25Zm1.75-.25a.25.25 0 0 0-.25.25v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25Zm7 2.25v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>Important</p>
<p>By default, for privacy reasons, bots in groups receive only messages that are targeted at them (reply to their messages, inline messages, or targeted <code>/commands@botname</code> with the bot username suffix)<br>If you want your bot to receive ALL messages in the group, you can either make it admin, or <u>disable</u> the <strong>Bot Settings</strong> : <a href="https://core.telegram.org/bots/features#privacy-mode"><strong>Group Privacy</strong> mode</a> in <a href="https://t.me/botfather">@BotFather</a></p>
</blockquote>
<h2 id="migration-to-supergroup"><a class="header" href="#migration-to-supergroup">Migration to Supergroup</a></h2>
<p>When you create a private chat group in Telegram, it is usually a <code>ChatType.Group</code>.</p>
<p>If members count reach 200, or if you change some settings <em>(like making it public, enabling newcomers history, or custom admin rights)</em>,
the group may be migrated into a <strong>supergroup</strong>.</p>
<p>In such case, the Supergroup is like a separate chat with a different ID.
The old Group will have a service message <code>MigrateToChatId</code> with the new supergroup ID.
The new Supergroup will have a service message <code>MigrateFromChatId</code> with the old group ID.</p>
<h2 id="managing-new-members-in-a-group"><a class="header" href="#managing-new-members-in-a-group">Managing new members in a group</a></h2>
<p>Bots can‚Äôt directly add members into a group/channel.<br>To invite users to join a group/channel, you can send to the users the public link <code>https://t.me/chatusername</code> (if chat has a username), or invite links:</p>
<h3 id="invite-links"><a class="header" href="#invite-links">Invite links</a></h3>
<p>Invite links are typically of the form <code>https://t.me/+AAS0mE-tH1nG</code> and allow users clicking on them to join the chat.</p>
<p>You can send those links as a text message or as an <code>InlineKeyboardButton.WithUrl(...)</code>.</p>
<p>If your bot is administrator on a private (or public) group/channel, it can:</p>
<ul>
<li>read the (fixed) primary link of the chat:</li>
</ul>
<pre><code class="language-csharp">var chatFullInfo = await bot.GetChat(chatId); // you should call this only once
Console.WriteLine(chatFullInfo.InviteLink);
</code></pre>
<ul>
<li>create new invite links on demand</li>
</ul>
<pre><code class="language-csharp">var link = await bot.CreateChatInviteLink(chatId, "name/reason", ...);
Console.WriteLine(link.InviteLink);
</code></pre>
<p>See also <a href="https://core.telegram.org/bots/api#exportchatinvitelink">some other methods for managing invite links</a>.</p>
<h3 id="detecting-new-group-members-and-changed-member-status"><a class="header" href="#detecting-new-group-members-and-changed-member-status">Detecting new group members and changed member status</a></h3>
<p>The simpler approach to detecting new members joining a group is to handle service messages of type <code>MessageType.NewChatMembers</code>: the field <code>message.NewChatMembers</code> will contain an array of the new User details.<br>Same for a user leaving the chat, with the <code>message.LeftChatMember</code> service message.</p>
<p>However, under various circumstances (bigger groups, hidden member lists, etc..), these service messages may not be sent out.</p>
<p>The more complex (and more reliable) approach is instead to handle updates of type <code>UpdateType.ChatMember</code>:</p>
<ul>
<li>First you need to enable this specific update type among the <code>allowedUpdates</code> parameter when calling <code>GetUpdates</code>, <code>SetWebhook</code> or <code>StartReceiving</code>+<code>ReceiverOptions</code>.</li>
<li>Typically, you would pass <code>Update.AllTypes</code> as the allowedUpdates parameter.</li>
<li>After that, you will receive an <code>update.ChatMember</code> structure for each user changing status with their old &amp; their new status</li>
<li>The <code>OldChatMember</code>/<code>NewChatMember</code> status fields can be one of the derived <code>ChatMember*</code> class: <code>Owner</code>/<code>Creator</code>, <code>Administrator</code>, <code>Member</code>, <code>Restricted</code>, <code>Left</code>, <code>Banned</code>/<code>Kicked</code>)</li>
</ul>
<h3 id="forum--topics"><a class="header" href="#forum--topics">Forum &amp; Topics</a></h3>
<p>Group owners can enable the <strong>Forum</strong> feature on their chat, which allows them to create <strong><a href="https://telegram.org/blog/topics-in-groups-collectible-usernames#topics-in-groups">topics</a></strong> for specialized discussions.</p>
<p>Messages in topics are indicated with the <code>MessageThreadId</code> property (or the <code>messageThreadId:</code> argument when sending). This value is equal to 1 for the <strong>General</strong> topic, or to the Message ID of the first message in topic.</p>
<p>Bots can <a href="https://core.telegram.org/bots/api#createforumtopic">create/edit/close/reopen/delete</a> specific topics or the General topic.</p>
<p><strong>Important:</strong> Bots can‚Äôt fetch the current list of all topics in the chat.<br>However, your bot can keep track of active topics by listening to these service messages (with <code>MessageThreadId</code> set):</p>
<ul>
<li><code>MessageType.ForumTopicCreated</code> and the <code>message.ForumTopicCreated</code> structure</li>
<li><code>MessageType.ForumTopicEdited</code> and the <code>message.ForumTopicEdited</code> structure</li>
<li><code>MessageType.ForumTopicClosed</code></li>
<li><code>MessageType.ForumTopicReopened</code></li>
<li>‚Ä¶</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="reply-markup"><a class="header" href="#reply-markup">Reply Markup</a></h1>
<p><a href="https://github.com/TelegramBots/Telegram.Bot/blob/master/test/Telegram.Bot.Tests.Integ/ReplyMarkup/ReplyMarkupTests.cs"><img src="https://img.shields.io/badge/Examples-Reply_Markup-green.svg?style=flat-square" alt="reply markup tests"></a></p>
<p>Telegram provides two types of reply markup: <a href="#custom-reply-keyboards">Custom reply keyboards</a> and <a href="#inline-keyboards">Inline keyboards</a>.</p>
<p>Since Bot API 9.4, keyboard buttons can have <a href="#button-styles">colors and custom emoji</a>.</p>
<h2 id="custom-reply-keyboards"><a class="header" href="#custom-reply-keyboards">Custom reply keyboards</a></h2>
<blockquote>
<p>These are buttons visible below the textbox. Pressing such button will make the user send a message in the chat</p>
</blockquote>
<p>Whenever your bot sends a message, it can pass along a <a href="https://core.telegram.org/bots/features#keyboards">special keyboard</a> with predefined reply options.
Regular keyboards are represented by <a href="https://core.telegram.org/bots/api/#keyboardbutton"><code>KeyboardButton</code></a> and <a href="https://core.telegram.org/bots/api/#replykeyboardmarkup"><code>ReplyKeyboardMarkup</code></a> objects.
When the user click such buttons, it will make him send a message to the chat.
It can be a simple predefined text, a contact or location information, or even a poll.</p>
<p>Keyboard is an array of button rows, each represented by an array of <a href="https://core.telegram.org/bots/api/#keyboardbutton"><code>KeyboardButton</code></a> objects. <a href="https://core.telegram.org/bots/api/#keyboardbutton"><code>KeyboardButton</code></a> supports text and emoji.</p>
<p>By default, reply keyboards are displayed until a new keyboard is sent by a bot.</p>
<h3 id="single-row-keyboard-markup"><a class="header" href="#single-row-keyboard-markup">Single-row keyboard markup</a></h3>
<p>A reply keyboard with two buttons in a single row:</p>
<pre><code class="language-c#">// using Telegram.Bot.Types.ReplyMarkups;

var sent = await bot.SendMessage(chatId, "Choose a response",
                                 replyMarkup: new[] { "Help me", "Call me ‚òéÔ∏è" });
</code></pre>
<p>Simple text buttons can be passed directly as strings</p>
<blockquote>
<p>If using <code>ReplyKeyboardMarkup</code>, we would have to specify <code>true</code> on the constructor to resize the keyboard vertically for optimal fit (e.g., make the keyboard smaller if there are just two rows of buttons).</p>
</blockquote>
<h3 id="multi-row-keyboard-markup"><a class="header" href="#multi-row-keyboard-markup">Multi-row keyboard markup</a></h3>
<p>For a reply keyboard with two rows of buttons, we use an array of arrays:</p>
<pre><code class="language-c#">// using Telegram.Bot.Types.ReplyMarkups;

var sent = await bot.SendMessage(chatId, "Choose a response", replyMarkup: new string[][]
{
    ["Help me"],
    ["Call me ‚òéÔ∏è", "Write me ‚úâÔ∏è"]
});
</code></pre>
<h3 id="requesting-information-to-be-sent-to-the-bot"><a class="header" href="#requesting-information-to-be-sent-to-the-bot">Requesting information to be sent to the bot</a></h3>
<p>Some special keyboard button types can be used to request information from the user and send them to the bot.</p>
<p>Below are some simple examples of what you can do. More options are available in associated class properties.</p>
<ul>
<li><code>KeyboardButton.WithRequestLocation("Share your location")</code><br>User‚Äôs position will be transmitted in a <code>message.Location</code></li>
<li><code>KeyboardButton.WithRequestContact("Share your info")</code><br>User‚Äôs phone number will be transmitted in a <code>message.Contact</code></li>
<li><code>KeyboardButton.WithRequestPoll("Create a poll", PollType.Regular)</code><br>User must create a poll which gets transmitted in a <code>message.Poll</code></li>
<li><code>KeyboardButton.WithRequestChat("Select a chat", 1234, false)</code><br>User must pick a group (false) or channel (true) which gets transmitted in a <code>message.ChatShared</code></li>
<li><code>KeyboardButton.WithRequestUsers("Select user(s)", 5678, 1)</code><br>User must pick 1-10 user(s) which get transmitted in a <code>message.UsersShared</code></li>
<li><code>KeyboardButton.WithWebApp("Launch WebApp", "https://www.example.com/game")</code><br>Launch a <a href="#telegram-mini-apps">Mini-App</a></li>
</ul>
<pre><code class="language-c#">// using Telegram.Bot.Types.ReplyMarkups;

var sent = await bot.SendMessage(chatId, "Who or Where are you?", replyMarkup: new KeyboardButton[]
{
    KeyboardButton.WithRequestLocation("Share Location"),
    KeyboardButton.WithRequestContact("Share Contact")
});
</code></pre>
<h3 id="remove-keyboard"><a class="header" href="#remove-keyboard">Remove keyboard</a></h3>
<p>To remove the keyboard you have to send an instance of <a href="https://core.telegram.org/bots/api#replykeyboardremove"><code>ReplyKeyboardRemove</code></a> in a new message:</p>
<pre><code class="language-c#">// using Telegram.Bot.Types.ReplyMarkups;

await bot.SendMessage(chatId, "Removing keyboard", replyMarkup: new ReplyKeyboardRemove());
</code></pre>
<h2 id="inline-keyboards"><a class="header" href="#inline-keyboards">Inline keyboards</a></h2>
<blockquote>
<p>These are buttons visible below a bot message. Pressing such button will NOT make the user send a message</p>
</blockquote>
<p>There are times when you‚Äôd prefer to do things without sending any messages to the chat. For example, when your user is changing settings or flipping through search results. In such cases you can use <a href="https://core.telegram.org/bots/features#inline-keyboards">Inline Keyboards</a> that are integrated directly into the messages they belong to.</p>
<p>Unlike custom reply keyboards, pressing buttons on inline keyboards doesn‚Äôt result in messages sent to the chat. Instead, inline keyboards support buttons that work behind the scenes: <a href="#callback-buttons">callback buttons</a>, <a href="#url-buttons">URL buttons</a> and <a href="#switch-to-inline-buttons">switch to inline buttons</a>.</p>
<p>You can have several rows and columns of inline buttons of mixed types.</p>
<h3 id="callback-buttons"><a class="header" href="#callback-buttons">Callback buttons</a></h3>
<p>When a user presses a <a href="https://core.telegram.org/bots/2-0-intro#callback-buttons">callback button</a>, no messages are sent to the chat, and your bot simply receives an <code>update.CallbackQuery</code> instead <em>(containing many information)</em>.<br>Upon receiving this, your bot should answer to that query within 10 seconds, using <code>AnswerCallbackQuery</code> <em>(or else the button gets momentarily disabled)</em></p>
<p>In this example, the arrays of <code>InlineKeyboardButton</code> are constructed from tuples <code>(title, callbackData)</code>:</p>
<pre><code class="language-c#">// using Telegram.Bot.Types.ReplyMarkups;

var sent = await bot.SendMessage(chatId, "A message with an inline keyboard markup",
    replyMarkup: new InlineKeyboardButton[][]
    {
        [("1.1", "11"), ("1.2", "12")], // two buttons on first row
        [("2.1", "21"), ("2.2", "22")]  // two buttons on second row
    });
</code></pre>
<blockquote>
<p>Callback data string can be up to 64 bytes. You can construct them explicitly via <code>InlineKeyboardButton.WithCallbackData</code></p>
</blockquote>
<h3 id="url-buttons"><a class="header" href="#url-buttons">URL buttons</a></h3>
<p>Buttons of this type have a small arrow icon to help the user understand that tapping on a <a href="https://core.telegram.org/bots/2-0-intro#url-buttons">URL button</a> will open an external link.
In this example we pass a single <code>InlineKeyboardButton</code>, and the constructor understand the second argument is an URL rather than callbackData.</p>
<pre><code class="language-c#">// using Telegram.Bot.Types.ReplyMarkups;

var sent = await bot.SendMessage(chatId, "A message with an inline keyboard markup",
        replyMarkup: new InlineKeyboardButton("Repository Link", "https://github.com/TelegramBots/Telegram.Bot"));
</code></pre>
<blockquote>
<p>You can also construct URL buttons via <code>InlineKeyboardButton.WithUrl</code></p>
</blockquote>
<h3 id="switch-to-inline-buttons"><a class="header" href="#switch-to-inline-buttons">Switch to Inline buttons</a></h3>
<p>Pressing a <a href="https://core.telegram.org/bots/2-0-intro#switch-to-inline-buttons">switch to inline button</a> prompts the user to select a chat, opens it and inserts the bot‚Äôs username into the input field. You can also pass a query that will be inserted along with the username ‚Äì this way your users will immediately get some inline results they can share. In this example we use <code>InlineKeyboardButton.WithSwitchInlineQuery</code> and <code>InlineKeyboardButton.WithSwitchInlineQueryCurrentChat</code> helper methods to create buttons which will insert the bot‚Äôs username in the chat‚Äôs input field.</p>
<pre><code class="language-c#">// using Telegram.Bot.Types.ReplyMarkups;

var sent = await bot.SendMessage(chatId, "A message with an inline keyboard markup",
    replyMarkup: new InlineKeyboardButton[]
    {
        InlineKeyboardButton.WithSwitchInlineQuery("switch_inline_query"),
        InlineKeyboardButton.WithSwitchInlineQueryCurrentChat("switch_inline_query_current_chat")
    });
</code></pre>
<h3 id="other-inline-button-types"><a class="header" href="#other-inline-button-types">Other inline button types</a></h3>
<p>Some more special inline button types can be used.</p>
<p>Below are some simple examples of what you can do. More options are available in associated class properties.</p>
<ul>
<li><code>InlineKeyboardButton.WithCopyText("Copy info", "Text to copy"))</code><br>Store a text in the user clipboard</li>
<li><code>InlineKeyboardButton.WithWebApp("Launch WebApp", "https://www.example.com/game"))</code><br>Launch a <a href="#telegram-mini-apps">Mini-App</a></li>
<li><code>InlineKeyboardButton.WithLoginUrl("Login", new() { Url = "https://www.example.com/telegramAuth" }))</code><br>Authenticate the Telegram user via a website <em>(Domain must be configured in <a href="https://t.me/botfather">@BotFather</a>)</em></li>
<li><code>InlineKeyboardButton.WithCallbackGame("Launch game"))</code><br>Launch an HTML game <em>(Game must be configured in <a href="https://t.me/botfather">@BotFather</a>)</em></li>
<li><code>InlineKeyboardButton.WithPay("Pay 200 XTR"))</code><br>Customize the Pay button caption <em>(only during a <a href="#bot-payments-api--telegram-stars">SendInvoice call</a>)</em></li>
</ul>
<h2 id="button-styles"><a class="header" href="#button-styles">Button styles</a></h2>
<p>Since Bot API 9.4, you can set a color and a custom emoji icon for your buttons.<br>This applies to both custom reply keyboards and inline keyboards.</p>
<ul>
<li>Color can be set via the KeyboardButton <code>Style</code> property, among 3 available options:<br><code>Danger</code> (<span style="background-color: firebrick">red</span>), <code>Success</code> (<span style="background-color: green">green</span>), <code>Primary</code> (<span style="background-color: steelblue">blue</span>)</li>
<li>Custom emoji can be set via the <code>IconCustomEmojiId</code> property, but is subject to <a href="#22-how-to-send-a-custom-emoji">some requirements</a>.</li>
</ul>
<pre><code class="language-c#">var sent = await bot.SendMessage(chatId, "A button with style and custom emoji",
            replyMarkup: new InlineKeyboardButton("Styled button", "CallbackData or Url")
                { Style = KeyboardButtonStyle.Primary, IconCustomEmojiId = "5373141891321699086" });
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="forward-copy-or-delete-messages"><a class="header" href="#forward-copy-or-delete-messages">Forward, Copy or Delete messages</a></h1>
<p>You can forward, copy, or delete a single message, or even a bunch of messages in one go.</p>
<p>You will need to provide the source messageId(s), the source chatId and eventually the target chatId.</p>
<p><em>Note: When you use the plural form of the copy/forward methods, it will keep Media Groups (albums) as such.</em></p>
<h2 id="forward-messages"><a class="header" href="#forward-messages">Forward message(s)</a></h2>
<p><a href="https://core.telegram.org/bots/api#forwardmessage"><img src="https://img.shields.io/badge/Bot_API_method-forwardMessage-blue.svg?style=flat-square" alt="forward message method"></a>
<a href="https://core.telegram.org/bots/api#forwardmessages"><img src="https://img.shields.io/badge/Bot_API_method-forwardMessages-blue.svg?style=flat-square" alt="forward messages method"></a></p>
<p>You can <strong>forward</strong> message(s) from a source chat to a target chat <em>(it can be the same chat)</em>.
They will appear with a ‚ÄúForwarded from‚Äù header.</p>
<pre><code class="language-csharp">// Forward a single message
await bot.ForwardMessage(targetChatId, sourceChatId, messageId);

// Forward an incoming message (from the update) onto a target ChatId
await bot.ForwardMessage(chatId, update.Message.Chat, update.Message.Id);

// Forward a bunch of messages from a source ChatId to a target ChatId, using a list of their message ids
await bot.ForwardMessages(targetChatId, sourceChatId, new int[] { 123, 124, 125 });
</code></pre>
<h2 id="copy-messages"><a class="header" href="#copy-messages">Copy message(s)</a></h2>
<p><a href="https://core.telegram.org/bots/api#copymessage"><img src="https://img.shields.io/badge/Bot_API_method-copyMessage-blue.svg?style=flat-square" alt="copy message method"></a>
<a href="https://core.telegram.org/bots/api#copymessages"><img src="https://img.shields.io/badge/Bot_API_method-copyMessages-blue.svg?style=flat-square" alt="copy messages method"></a></p>
<p>If you don‚Äôt want the ‚ÄúForwarded from‚Äù header, you can instead <strong>copy</strong> the message(s).</p>
<p>This will make them look like new messages.</p>
<pre><code class="language-csharp">// Copy a single message
await bot.CopyMessage(targetChatId, sourceChatId, messageId);

// Copy an incoming message (from the update) onto a target ChatId
await bot.CopyMessage(targetChatId, update.Message.Chat, update.Message.Id);

// Copy a media message and change its caption at the same time
await bot.CopyMessage(targetChatId, update.Message.Chat, update.Message.Id,
    caption: "New &lt;b&gt;caption&lt;/b&gt; for this media", parseMode: ParseMode.Html);

// Copy a bunch of messages from a source ChatId to a target ChatId, using a list of their message ids
await bot.CopyMessages(targetChatId, sourceChatId, new int[] { 123, 124, 125 });
</code></pre>
<h2 id="delete-messages"><a class="header" href="#delete-messages">Delete message(s)</a></h2>
<p><a href="https://core.telegram.org/bots/api#deletemessage"><img src="https://img.shields.io/badge/Bot_API_method-deleteMessage-blue.svg?style=flat-square" alt="delete message method"></a>
<a href="https://core.telegram.org/bots/api#deletemessages"><img src="https://img.shields.io/badge/Bot_API_method-deleteMessages-blue.svg?style=flat-square" alt="delete messages method"></a></p>
<p>Finally you can <strong>delete</strong> message(s).</p>
<p>This is particularly useful for cleaning unwanted messages in groups.</p>
<pre><code class="language-csharp">// Delete a single message
await bot.DeleteMessage(chatId, messageId);

// Delete an incoming message (from the update)
await bot.DeleteMessage(update.Message.Chat, update.Message.Id);

// Delete a bunch of messages, using a list of their message ids
await bot.DeleteMessages(chatId, new int[] { 123, 124, 125 });
</code></pre>
<h2 id="check-if-a-message-is-a-forward"><a class="header" href="#check-if-a-message-is-a-forward">Check if a message is a forward</a></h2>
<p>When receiving an update about a message, you can check if that message is ‚ÄúForwarded from‚Äù somewhere,
by checking if <code>Message.ForwardOrigin</code> is set:</p>
<pre><code class="language-csharp">Console.WriteLine(update.Message.ForwardOrigin switch
{
    MessageOriginChannel moc     =&gt; $"Forwarded from channel {moc.Chat.Title}",
    MessageOriginUser mou        =&gt; $"Forwarded from user {mou.SenderUser}",
    MessageOriginHiddenUser mohu =&gt; $"Forwarded from hidden user {mohu.SenderUserName}",
    MessageOriginChat moch       =&gt; $"Forwarded on behalf of {moch.SenderChat}",
    _                            =&gt; "Not forwarded"
});
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="intermediate"><a class="header" href="#intermediate">Intermediate</a></h1>
<ul>
<li><a href="3/updates">Working with Updates &amp; Messages</a>
<ul>
<li><a href="#long-polling-1">Long Polling</a></li>
<li><a href="#webhooks">Webhooks</a></li>
</ul>
</li>
<li><a href="#downloading-files">Download/Upload Files</a></li>
<li><a href="#inline-mode">Inline Mode</a></li>
<li><a href="#list-of-helpers-in-the-library">Library helpers</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="working-with-updates--messages"><a class="header" href="#working-with-updates--messages">Working with Updates &amp; Messages</a></h1>
<h2 id="getting-updates"><a class="header" href="#getting-updates">Getting Updates</a></h2>
<p>There are two mutually exclusive ways of receiving updates for your bot ‚Äî the long polling using <a href="https://core.telegram.org/bots/api#getupdates"><code>getUpdates</code></a> method on one hand and Webhooks on the other. Telegram is queueing updates until the bot receives them either way, but they will not be kept longer than 24 hours.</p>
<ul>
<li><a href="#long-polling-1">With long polling</a>, the client is actively requesting updates from the server in a blocking way. The call returns if new updates become available or a timeout has expired.</li>
<li><a href="#webhooks">Setting a webhook</a> means you supplying Telegram with a location in the form of an URL, on which your bot listens for updates. Telegram need to be able to connect and post updates to that URL.</li>
</ul>
<h2 id="update-types"><a class="header" href="#update-types">Update types</a></h2>
<p><a href="https://core.telegram.org/bots/api#update"><img src="https://img.shields.io/badge/Bot_API_type-Update-blue.svg?style=flat-square" alt="Update type"></a></p>
<p>Each user interaction with your bot results in an Update object.
It could be about a Message, some changed status, bot-specific queries, etc‚Ä¶<br>You can use <code>update.Type</code> to check which kind of update you are dealing with.</p>
<p>However this property is slow and just indicates which field of <code>update</code> is set, and the other fields are all null.
So it is recommended to instead directly test the fields of Update you want if they are non-null, like this:</p>
<pre><code class="language-csharp">switch (update)
{
    case { Message: { } msg }: await HandleMessage(msg); break;
    case { EditedMessage: { } editedMsg }: await HandleEditedMessage(editedMsg); break;
    case { ChannelPost: { } channelMsg }: await HandleChannelMessage(channelMsg); break;
    case { CallbackQuery: { } cbQuery }: await HandleCallbackQuery(cbQuery); break;
    //...
}
</code></pre>
<h2 id="message-types"><a class="header" href="#message-types">Message types</a></h2>
<p><a href="https://core.telegram.org/bots/api#message"><img src="https://img.shields.io/badge/Bot_API_type-Message-blue.svg?style=flat-square" alt="Message type"></a></p>
<p>If the Update is one of the 6 types of update containing a message <em>(new or edited? channel? business?)</em>, the contained <code>Message</code> object itself can be of various types.</p>
<p>Like above, you can use <code>message.Type</code> to determine the type but it is recommended to directly test the non-null fields of <code>Message</code> using <code>if</code> or <code>switch</code>.</p>
<p>There are a few dozens of message types, grouped in two main categories: <strong>Content</strong> and <strong>Service</strong> messages</p>
<h3 id="content-messages"><a class="header" href="#content-messages">Content messages</a></h3>
<p>These messages represent actual content that someone posted.</p>
<p>Depending on which field is set, it can be:</p>
<ul>
<li><code>Text</code>: a basic text message <em>(with its <code>Entities</code> for font effects, and <code>LinkPreviewOptions</code> for preview info)</em></li>
<li><code>Photo</code>, <code>Video</code>, <code>Animation</code> (GIF), <code>Document</code> (file), <code>Audio</code>, <code>Voice</code>, <code>PaidMedia</code>: those are media contents which can come with a <code>Caption</code> subtext <em>(and its <code>CaptionEntities</code>)</em></li>
<li><code>VideoNote</code>, <code>Sticker</code>, <code>Dice</code>, <code>Game</code>, <code>Poll</code>, <code>Venue</code>, <code>Location</code>, <code>Story</code>: other kind of messages without a caption</li>
</ul>
<p>You can use methods <code>message.ToHtml()</code> or <code>message.ToMarkdown()</code> to convert the text/caption &amp; entities into HTML <strong>(recommended)</strong> or Markdown.</p>
<h3 id="service-messages"><a class="header" href="#service-messages">Service messages</a></h3>
<p>All other message types represent some action/status that happened in the chat instead of actual content.</p>
<p>We are not listing all types here, but it could be for example:</p>
<ul>
<li><a href="#detecting-new-group-members-and-changed-member-status">members joined/left</a></li>
<li>pinned message</li>
<li>chat info/status/topic changed</li>
<li><a href="#bot-payments-api--telegram-stars">payment</a>/<a href="4/passport">passport</a>/giveaway process update</li>
<li>etc‚Ä¶</li>
</ul>
<h3 id="common-properties"><a class="header" href="#common-properties">Common properties</a></h3>
<p>There are additional properties that gives you information about the context of the message.</p>
<p>Here are a few important properties:</p>
<ul>
<li><code>Id</code>: the ID that you will use if you need to reply or call a method acting on this message</li>
<li><code>Chat</code>: in which chat the message arrived</li>
<li><code>From</code>: which user posted it</li>
<li><code>Date</code>: timestamp of the message (in UTC)</li>
<li><code>ReplyToMessage</code>: which message this is a reply to</li>
<li><a href="#check-if-a-message-is-a-forward"><code>ForwardOrigin</code></a>: if it is a Forwarded message</li>
<li><code>MediaGroupId</code>: albums (group of media) are <a href="#receiving-a-media-group-album">separate consecutive messages</a> having the same MediaGroupId</li>
<li><code>MessageThreadId</code>: the topic ID for Forum/Topic type chats</li>
</ul>
<h2 id="sequential-vs-parallel-updates"><a class="header" href="#sequential-vs-parallel-updates">Sequential vs parallel updates</a></h2>
<p>Whether polling in a loop or with <a href="#updates-are-posted-sequentially-to-your-webapp">webhook</a>,
you will usually receive updates in sequential order of increasing <code>update.Id</code>, one after the other.</p>
<p>If you want to parallelize the handling of updates for improved performance, it is up to your async code.<br>There are multiple possible approaches:</p>
<ul>
<li>write the received update into a <a href="https://learn.microsoft.com/en-us/dotnet/core/extensions/channels">Threading Channel</a><br>You will need separate consumer Task(s) to process these updates <em>(see <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/host/hosted-services">Background Service</a>)</em></li>
<li>do the same but with a <code>ConcurrentQueue</code> or a <code>Queue</code> (with <code>lock</code>)</li>
<li>spawn a new sub-Task for each update, using <code>Task.Run</code> for example<br>(if your bot is heavily used, make sure you don‚Äôt overload your server with concurrent tasks)</li>
<li>or something as simple as: <code>bot.OnUpdate += async update =&gt; OnUpdate(update);</code></li>
</ul>
<p>However if you‚Äôre gonna process the updates in parallel, you might want to ensure your code:</p>
<ul>
<li>is thread-safe or async-safe when accessing common resources</li>
<li>has no state-consistency issue processing updates in unsequential order</li>
</ul>
<h2 id="example-projects"><a class="header" href="#example-projects">Example projects</a></h2>
<h3 id="long-polling"><a class="header" href="#long-polling">Long polling</a></h3>
<ul>
<li><a href="https://github.com/TelegramBots/Telegram.Bot.Examples/tree/master/Console">Console application</a>. Demonstrates a basic bot with some commands.</li>
<li><a href="https://github.com/TelegramBots/Telegram.Bot.Examples/tree/master/Console.Advanced">Advanced console application</a>. Demonstrates the use of many advanced programming features.</li>
</ul>
<h3 id="webhook"><a class="header" href="#webhook">Webhook</a></h3>
<ul>
<li><a href="https://github.com/TelegramBots/Telegram.Bot.Examples/tree/master/Webhook.MinimalAPIs">ASP.NET Core</a> web application with Minimal APIs</li>
<li><a href="https://github.com/TelegramBots/Telegram.Bot.Examples/tree/master/Webhook.Controllers">ASP.NET Core</a> web application with Controllers</li>
<li><a href="https://github.com/TelegramBots/Telegram.Bot.Examples/tree/master/Serverless/AzureFunctions.Webhook">Azure Functions</a></li>
<li><a href="https://github.com/TelegramBots/Telegram.Bot.Examples/tree/master/Serverless/AwsLambda.Webhook">AWS Lambda</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="long-polling-1"><a class="header" href="#long-polling-1">Long Polling</a></h1>
<p>Long Polling is done by calling <a href="https://core.telegram.org/bots/api#getupdates">getUpdates</a> actively.</p>
<p>With our library, this can be done in one of three ways:</p>
<h2 id="by-setting-botonupdate-andor-botonmessage"><a class="header" href="#by-setting-botonupdate-andor-botonmessage">By setting <code>bot.OnUpdate</code> (and/or <code>bot.OnMessage</code>)</a></h2>
<p><a href="https://github.com/TelegramBots/Telegram.Bot.Examples/tree/master/Console"><img src="https://img.shields.io/badge/Examples-Console-green?style=flat-square" alt="Console application"></a></p>
<p>Setting those events will automatically start a background polling system which will call your events accordingly:</p>
<ul>
<li><code>OnMessage</code> for updates about messages (new or edited Message, Channel Post or Business Messages)</li>
<li><code>OnUpdate</code> for all other type of updates (callback, inline-mode, chat members, polls, etc..)</li>
</ul>
<blockquote class="blockquote-tag blockquote-tag-note">
<p class="blockquote-tag-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p>
<p>If you don‚Äôt set OnMessage, the OnUpdate event will be triggered for all updates, including messages.</p>
</blockquote>
<h2 id="by-using-the-startreceiving-method-or-receiveasync"><a class="header" href="#by-using-the-startreceiving-method-or-receiveasync">By using the <code>StartReceiving</code> method (or <code>ReceiveAsync</code>)</a></h2>
<p><a href="https://github.com/TelegramBots/Telegram.Bot.Examples/tree/master/Console.Advanced"><img src="https://img.shields.io/badge/Examples-Console.Advanced-green?style=flat-square" alt="Advanced console application"></a></p>
<p>Those methods start a polling system which will call your method on incoming updates.</p>
<p>As arguments, you can pass either lambdas, methods or a class derived from <code>IUpdateHandler</code> that implements the handling of Update and Error.</p>
<h2 id="by-calling-getupdates-manually-in-a-loop"><a class="header" href="#by-calling-getupdates-manually-in-a-loop">By calling <code>GetUpdates</code> manually in a loop</a></h2>
<p>You can specify a timeout so that the call blocks for <strong>up to</strong> X seconds, waiting for an incoming update</p>
<p>Here is an example implementation:</p>
<pre><code class="language-csharp">int? offset = null;
while (!cts.IsCancellationRequested)
{
    var updates = await bot.GetUpdates(offset, timeout: 2);
    foreach (var update in updates)
    {
        offset = update.Id + 1;
        try
        {
            // put your code to handle one Update here.
        }
        catch (Exception ex)
        {
            // log exception and continue
        }
        if (cts.IsCancellationRequested) break;
    }
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="webhooks"><a class="header" href="#webhooks">Webhooks</a></h1>
<p><a href="https://core.telegram.org/bots/webhooks"><img src="https://img.shields.io/badge/Bot_API-Webhook%20guide-blue.svg?style=flat-square" alt="Webhook guide"></a></p>
<p>With Webhook, your web application gets notified
<a href="#updates-are-posted-one-by-one-to-your-webapp">one by one</a>,
automatically by Telegram when new updates arrive for your bot.</p>
<p>Your application will receive HTTP POST requests with an Update structure in the JSON body.</p>
<blockquote>
<p>Since version 22.5 of the library, you no longer need to configure the JSON serialization settings for your WebApp in most cases.
But if necessary, refer to section <strong><a href="#configure-json-serialization-settings">Configure JSON serialization settings</a></strong> below.</p>
</blockquote>
<p>Here are example codes for handling updates, depending on the types of ASP.NET projects:</p>
<ul>
<li><strong>ASP.NET Core with Controllers (MVC)</strong> <a href="https://github.com/TelegramBots/Telegram.Bot.Examples/tree/master/Webhook.Controllers"><img src="https://img.shields.io/badge/Examples-Webhook.Controllers-green?style=flat-square" alt="ASP.NET example with Controllers"></a>
<pre><code class="language-csharp">// Add this action in a controller class (like BotController.cs):
[HttpPost]
public async Task HandleUpdate([FromBody] Update update)
{
    // put your code to handle one Update here.
}
</code></pre>
</li>
<li><strong>ASP.NET Core with Minimal APIs</strong> <a href="https://github.com/TelegramBots/Telegram.Bot.Examples/tree/master/Webhook.MinimalAPIs"><img src="https://img.shields.io/badge/Examples-Webhook.MinimalAPIs-green?style=flat-square" alt="ASP.NET example with Minimal APIs"></a>
<pre><code class="language-csharp">app.MapPost("/bot", (Update update) =&gt; HandleUpdate(update));
...

async Task HandleUpdate(Update update)
{
    // put your code to handle one Update here.
}
</code></pre>
</li>
<li><strong>Old ASP.NET 4.x support</strong>
<pre><code class="language-csharp">public async Task&lt;IHttpActionResult&gt; Post()
{
    Update update;
    using (var body = await Request.Content.ReadAsStreamAsync())
        update = System.Text.Json.JsonSerializer.Deserialize&lt;Update&gt;(body, JsonBotAPI.Options);
    await HandleUpdate(update);
    return Ok();
}
</code></pre>
</li>
</ul>
<p>Now that your update handler code is ready, you need to instruct Telegram to start sending updates to your URL, by running:</p>
<pre><code class="language-csharp">var bot = new TelegramBotClient("YOUR_BOT_TOKEN");
await bot.SetWebhook("https://your.public.host:port/bot", allowedUpdates: []);
</code></pre>
<p>Great! You can now deploy your app to your webapp host machine.</p>
<p><em>Note: If you decide to switch back to <a href="#long-polling-1">Long Polling</a>, remember to call <code>bot.DeleteWebhook()</code></em></p>
<h2 id="common-issues"><a class="header" href="#common-issues">Common issues</a></h2>
<ul>
<li>You need a <a href="https://core.telegram.org/bots/faq#i-39m-having-problems-with-webhooks">supported certificate</a><br>If your host doesn‚Äôt provide one, or you want to develop on your own machine, consider using <a href="https://ngrok.com/">ngrok</a>:<br>See this useful <a href="https://medium.com/@oktaykopcak/81c8c4a9a853">step-by-step guide</a></li>
<li>You must use HTTPS (TLS 1.2+), IPv4, and ports 443, 80, 88, or 8443</li>
<li>The <a href="https://core.telegram.org/bots/webhooks">Official webhook guide</a> gives a lot of details</li>
<li>Most web hostings will recycle your app after some HTTP inactivity (= stop your app and restart it on the next HTTP request)<br>To prevent issues with this:
<ul>
<li>Search for an Always-On option with your host <em>(usually not free)</em></li>
<li>Make sure your web app can be safely stopped (saved state) and restarted later (reloading state)</li>
<li>Make sure you don‚Äôt have critical background code that needs to keep running at all time</li>
<li>Have a service like <a href="https://cron-job.org/">cron-job.org</a> ping your webapp every 5 minutes to keep it active.
<em>(host will likely still recycle your app after a few days)</em></li>
<li>Host your app on a VPS machine rather than a webapp host.</li>
</ul>
</li>
</ul>
<h2 id="updates-are-posted-one-by-one-to-your-webapp"><a class="header" href="#updates-are-posted-one-by-one-to-your-webapp">Updates are posted one by one to your webapp</a></h2>
<p>If there are new pending updates, Telegram servers will send a POST request to your Webhook URL with the <u>next</u> update you didn‚Äôt acknowledge yet.
<em>(based on incremental <code>update.Id</code> values)</em></p>
<blockquote class="blockquote-tag blockquote-tag-note">
<p class="blockquote-tag-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p>
<p>For high-load/busy webhook bots, Bot API may send multiple updates in parallel to your endpoint,
in which case you may need a more advanced system to collect &amp; reorder them by ID to ensure correct processing order.</p>
</blockquote>
<p>As long as your webapp doesn‚Äôt acknowledge the update with a 200 OK <strong>within a few seconds</strong>, Telegram will keep resending the <strong>same update</strong> to your endpoint.<br>In particular, this will happen if your code is throwing an unhandled exception or taking too long to process an update.</p>
<p>A simple way to prevent handling the same update.Id twice is:</p>
<pre><code class="language-csharp">if (update.Id &lt;= LastUpdateId) return;
LastUpdateId = update.Id;
// your code to handle the Update here.
</code></pre>
<p>Initially Telegram will resend the failed update quickly, then with increasing intervals up to a few minutes. So if your webapp wasn‚Äôt working for some time, you may have to wait a bit to receive a POST request with the next update.</p>
<p>If you need to process the incoming updates faster, in parallel, you will want to delegate their handling separately and acknowledge the POST request by returning from the controller immediately.<br>For more details, refer to <a href="3/updates#sequential-vs-parallel-updates">this section of our documentation</a>.</p>
<h2 id="configure-json-serialization-settings"><a class="header" href="#configure-json-serialization-settings">Configure JSON serialization settings</a></h2>
<p>Telegram updates &amp; requests are sent using JSON payloads with <code>snake_case</code> property names.
Such serialization is normally achieved thanks to <code>Telegram.Bot.JsonBotAPI.Options</code> serialization settings.</p>
<p>Since version 22.5, the library should already be compatible with Telegram Webhook without needing extra configuration for your WebApp.</p>
<p>In some rare cases <em>(like <a href="https://learn.microsoft.com/en-us/dotnet/core/deploying/native-aot">Native AOT</a> / <a href="https://learn.microsoft.com/en-us/aspnet/core/blazor/webassembly-build-tools-and-aot">Blazor</a> / <a href="https://learn.microsoft.com/en-us/dotnet/core/deploying/trimming/trim-self-contained">Trimming</a>)</em>, this might still be necessary and here is how to configure your project:</p>
<ul>
<li><strong>ASP.NET Core with Minimal APIs</strong><br>Locate the line <code>builder.Build();</code> <em>(in Program.cs)</em> and insert this line <u>above</u>:
<pre><code class="language-csharp">builder.Services.ConfigureTelegramBot&lt;Microsoft.AspNetCore.Http.Json.JsonOptions&gt;(opt =&gt; opt.SerializerOptions);
</code></pre>
</li>
<li><strong>ASP.NET Core with Controllers</strong> <em>(recommended method for .NET 6.0+)</em><br>Add the <a href="https://www.nuget.org/packages/Telegram.Bot.AspNetCore">nuget package</a> <code>Telegram.Bot.AspNetCore</code> to your project.<br>Locate the line <code>services.AddControllers();</code> <em>(in Program.cs or Startup.cs)</em> and add this line below:
<pre><code class="language-csharp">services.ConfigureTelegramBotMvc();
</code></pre>
</li>
<li><strong>ASP.NET Core with Controllers</strong> <em>(any .NET version)</em><br>Locate the line <code>services.AddControllers();</code> <em>(in Program.cs or Startup.cs)</em> and add this line below:
<pre><code class="language-csharp">services.ConfigureTelegramBot&lt;Microsoft.AspNetCore.Mvc.JsonOptions&gt;(opt =&gt; opt.JsonSerializerOptions);
</code></pre>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="downloading-files"><a class="header" href="#downloading-files">Downloading files</a></h1>
<p>To download a file, you have to know its file identifier: <code>FileId</code>.<br>You find this property in the <a href="https://core.telegram.org/bots/api#animation"><code>Animation</code></a>, <a href="https://core.telegram.org/bots/api#audio"><code>Audio</code></a>, <a href="https://core.telegram.org/bots/api#document"><code>Document</code></a>, <a href="https://core.telegram.org/bots/api#video"><code>Video</code></a>, <a href="https://core.telegram.org/bots/api#videonote"><code>VideoNote</code></a>, <a href="https://core.telegram.org/bots/api#voice"><code>Voice</code></a>, <a href="https://core.telegram.org/bots/api#sticker"><code>Sticker</code></a> objects from a message.</p>
<p>For a <code>Photo</code>, you get an array <code>PhotoSize[]</code> with <code>FileId</code> for each resolution variants.
The last entry contains the best quality: <code>message.Photo[^1].FileId</code><br>For <code>ChatPhoto</code>, there is a <code>BigFileId</code> for best quality, and <code>SmallFileId</code> for low resolution.</p>
<h2 id="methods-for-downloading-a-file"><a class="header" href="#methods-for-downloading-a-file">Methods for downloading a file</a></h2>
<p>Downloading a file from Telegram is done in two steps:</p>
<ol>
<li>Get file information with <a href="https://core.telegram.org/bots/api#getfile"><code>GetFile</code></a> method.</li>
<li>Download the file with the <code>DownloadFile</code> method</li>
</ol>
<pre><code class="language-csharp">var fileId = update.Message.Video.FileId;
var tgFile = await bot.GetFile(fileId);

await using var stream = File.Create("../downloaded.mp4");
await bot.DownloadFile(tgFile, stream);
</code></pre>
<p>For your convenience, the library provides a helper function that does both steps: <code>GetInfoAndDownloadFile</code></p>
<pre><code class="language-csharp">await using var ms = new MemoryStream();
var tgFile = await bot.GetInfoAndDownloadFile(fileId, ms);
</code></pre>
<p>Notes:</p>
<ul>
<li>‚ö†Ô∏è Bot API can download files up to 20 MB only. For bigger files, consider using <a href="https://www.nuget.org/packages/WTelegramBot#readme-body-tab">library WTelegramBot</a></li>
<li>When downloading into a <code>MemoryStream</code>, remember to reset its <code>Position</code> before processing the content.</li>
<li>The <code>tgFile.FilePath</code> returned by <code>GetFile</code> can be used to build the web URL accessing the file: <code>https://api.telegram.org/file/bot&lt;token&gt;/&lt;FilePath&gt;</code>.</li>
</ul>
<h1 id="uploading-files"><a class="header" href="#uploading-files">Uploading files</a></h1>
<p>We recommend you first read the official <a href="https://core.telegram.org/bots/api#sending-files">documentation on sending files</a>, it contains important information.</p>
<h2 id="upload-local-file"><a class="header" href="#upload-local-file">Upload local file</a></h2>
<p>To upload a file from your machine, open the stream and call one of the sending methods:</p>
<pre><code class="language-csharp">await using var stream = File.OpenRead("../hamlet.pdf");
var message = await bot.SendDocument(chatId, stream, "The Tragedy of Hamlet,\nPrince of Denmark");
</code></pre>
<p>You can also specify the public filename manually, or use a MemoryStream:</p>
<pre><code class="language-csharp">var buffer = File.ReadAllBytes("../hamlet.pdf");
await using var ms = new MemoryStream(buffer);
var message = await bot.SendDocument(chatId, InputFile.FromStream(ms, "Tragedy.pdf"),
                                     "The Tragedy of Hamlet,\nPrince of Denmark");
</code></pre>
<p>Be aware of limitation for this method - 10 MB max size for photos, 50 MB for other files. For bigger files, consider using <a href="https://www.nuget.org/packages/WTelegramBot#readme-body-tab">library WTelegramBot</a></p>
<h2 id="upload-by-file-identifier"><a class="header" href="#upload-by-file-identifier">Upload by file identifier</a></h2>
<p>If the file is already stored somewhere on the Telegram servers, you don‚Äôt need to reupload it: each file object has a <code>FileId</code> property. Simply pass this <code>FileId</code> as a parameter instead of uploading. There are no size limits for files sent this way.</p>
<pre><code class="language-csharp">var fileId = update.Message.Photo[^1].FileId;
var message = await bot.SendPhoto(chatId, fileId);
</code></pre>
<h2 id="upload-by-url"><a class="header" href="#upload-by-url">Upload by URL</a></h2>
<p>Provide Telegram with an HTTP URL for the file to be sent. Telegram will download and send the file. 5 MB max size for photos and 20 MB max for other types of content.</p>
<pre><code class="language-csharp">var message = await bot.SendPhoto(chatId, "https://picsum.photos/640/480.jpg");
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="inline-mode"><a class="header" href="#inline-mode">Inline Mode</a></h1>
<p><a href="https://core.telegram.org/bots/api#inline-mode"><img src="https://img.shields.io/badge/Bot_API_Doc-Inline%20Mode-blue.svg?style=flat-square" alt="inline mode bot API"></a>
<a href="https://github.com/TelegramBots/Telegram.Bot.Examples/blob/master/InlineQueries/Program.cs"><img src="https://img.shields.io/badge/Examples-Inline%20Queries-green?style=flat-square" alt="inline queries example"></a></p>
<p>Telegram bots can be queried directly in the chat or via inline queries.</p>
<p>To use inline queries in your bot, you need to set up inline mode by command:</p>
<p><img src="3/docs/shot-setinline_command.png" alt="/setinline command in BotFather"></p>
<p>Import <code>Telegram.Bot.Types.InlineQueryResults</code> namespace for inline query types.</p>
<p>There are two types that allow you to work with inline queries - <code>InlineQuery</code> and <code>ChosenInlineResult</code>:</p>
<pre><code class="language-c#">switch (update.Type)
{
    case UpdateType.InlineQuery:
        await OnInlineQueryReceived(bot, update.InlineQuery!);
        break;
    case UpdateType.ChosenInlineResult:
        await OnChosenInlineResultReceived(bot, update.ChosenInlineResult!);
        break;
};
</code></pre>
<h2 id="inlinequery"><a class="header" href="#inlinequery"><code>InlineQuery</code></a></h2>
<p><a href="https://core.telegram.org/bots/api#inlinequeryresult"><img src="https://img.shields.io/badge/Bot_API_Object-InlineQueryResult-blue.svg?style=flat-square" alt="inline query result bot API"></a></p>
<p>Suppose we have two arrays:</p>
<pre><code class="language-c#">private readonly string[] sites = { "Google", "Github", "Telegram", "Wikipedia" };
private readonly string[] siteDescriptions =
{
    "Google is a search engine",
    "Github is a git repository hosting",
    "Telegram is a messenger",
    "Wikipedia is an open wiki"
};
</code></pre>
<p>So we can handle inline queries this way:</p>
<pre><code class="language-c#">async Task OnInlineQueryReceived(ITelegramBotClient bot, InlineQuery inlineQuery)
{
    var results = new List&lt;InlineQueryResult&gt;();

    var counter = 0;
    foreach (var site in sites)
    {
        results.Add(new InlineQueryResultArticle(
            $"{counter}", // we use the counter as an id for inline query results
            site, // inline query result title
            new InputTextMessageContent(siteDescriptions[counter])) // content that is submitted when the inline query result title is clicked
        );
        counter++;
    }

    await bot.AnswerInlineQuery(inlineQuery.Id, results); // answer by sending the inline query result list
}
</code></pre>
<p><code>InlineQueryResult</code> is an abstract type used to create a response for inline queries. You can use these result types for inline queries: <code>InlineQueryResultArticle</code> for articles, <code>InlineQueryResultPhoto</code> for photos, etc.</p>
<h2 id="choseninlineresult"><a class="header" href="#choseninlineresult"><code>ChosenInlineResult</code></a></h2>
<p><a href="https://core.telegram.org/bots/api#choseninlineresult"><img src="https://img.shields.io/badge/Bot_API_Object-ChosenInlineResult-blue.svg?style=flat-square" alt="chosen inline result bot API"></a></p>
<p>This type helps to handle chosen inline result. For example, you may want to know which result users chose:</p>
<pre><code class="language-csharp">Task OnChosenInlineResultReceived(ITelegramBotClient bot, ChosenInlineResult chosenInlineResult)
{
    if (uint.TryParse(chosenInlineResult.ResultId, out var resultId) // check if a result id is parsable and introduce variable
        &amp;&amp; resultId &lt; sites.Length)
    {
        Console.WriteLine($"User {chosenInlineResult.From} has selected site: {sites[resultId]}");
    }

    return Task.CompletedTask;
}
</code></pre>
<p>To use the feature you need to enable ‚Äúinline feedback‚Äù in BotFather by <code>/setinlinefeedback</code> command:</p>
<p><img src="3/docs/shot-setinlinefeedback_command.png" alt="set inline feedback command"></p>
<p>Final result:</p>
<p><img src="3/docs/shot-inline_bot_showcase.png" alt="result"></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="list-of-helpers-in-the-library"><a class="header" href="#list-of-helpers-in-the-library">List of helpers in the library</a></h1>
<p>Our library is mainly a bridge between your application and Telegram Bot API.<br>However, to simplify your life, we also provide a set of additional helpers methods and services, listed below.</p>
<blockquote>
<p>For more advanced features, you can look at <a href="https://github.com/TelegramBots/Telegram.Bot/wiki">high-level bot frameworks</a> constructed around our library</p>
</blockquote>
<h2 id="message-and-format-helpers"><a class="header" href="#message-and-format-helpers">Message and format helpers</a></h2>
<ul>
<li><code>message.MessageLink()</code>: Returns the <a href="3/t.me">t.me/‚Ä¶</a> link to this message, or <code>null</code> if the message was not in a Supergroup or Channel</li>
<li><code>message.IsServiceMessage</code>: Detect service messages vs content messages</li>
<li><code>message.ToHtml()</code> to convert the message to HTML format <em>(Recommended)</em></li>
<li><code>message.ToMarkdown()</code> to convert the message to Markdown format <em>(Not recommended)</em></li>
<li><code>HtmlText.Escape()</code> to escape reserved HTML characters in a string</li>
<li><code>HtmlText.ToPlain()</code> to convert HTML string to plain text <em>(removing tags)</em></li>
<li><code>HtmlText.PlainLength()</code> to get the number of characters of plain text from HTML</li>
<li><code>HtmlText.Truncate()</code> to truncate HTML string to a number of plain-text characters <em>(while preserving the formatting)</em></li>
<li><code>Markdown.Escape()</code> to escape reserved Markdown characters in a string</li>
<li><code>bot.SendHtml()</code> to <a href="#sendhtml-helper-method">send HTML-formatted messages</a>, with support for sending photos/videos and keyboards from one string</li>
<li><code>bot.EditHtml()</code> to edit message and media group <a href="#sendhtml-helper-method">via an HTML string</a></li>
<li><code>bot.EditHtmlInline()</code> same as above to edit an inline message (inline results)</li>
</ul>
<h2 id="easier-information"><a class="header" href="#easier-information">Easier information</a></h2>
<ul>
<li><code>chat.ToString()</code> &amp; <code>user.ToString()</code> to easily print/log information about the chat/user</li>
<li><code>ChatMember</code> has properties <code>IsAdmin</code> and <code>IsInChat</code> to simplify testing if the user is an admin or currently inside the chat</li>
<li><code>ChatMember</code> has property <code>ExpireDate</code> <em>(generic equivalent for <code>UntilDate</code> subclass properties)</em></li>
<li><code>ChatMemberRestricted</code> has a property <code>IsMuted</code> to quickly determine if the user cannot send any type of message</li>
</ul>
<h2 id="updates"><a class="header" href="#updates">Updates</a></h2>
<ul>
<li><code>bot.DropPendingUpdates()</code> to clear the pending updates queue</li>
<li><code>Update.AllTypes</code> is a constant array containing all <code>UpdateType</code>s, usable with <code>GetUpdates</code>/<code>SetWebhook</code></li>
<li><code>bot.OnMessage</code> / <code>bot.OnUpdate</code> events to easily subscribe to messages or updates
<em>(these automatically start a background task to poll for updates)</em></li>
</ul>
<h2 id="telegram-files"><a class="header" href="#telegram-files">Telegram files</a></h2>
<ul>
<li><code>bot.GetInfoAndDownloadFile</code> to get file information and download it in a single call</li>
<li><code>TelegramBotClient.GetFileIdType(fileId)</code> to determine the type of object stored behind a FileId <em>(photo, video, etc)</em></li>
</ul>
<h2 id="simplified-constructors-and-implicit-conversions"><a class="header" href="#simplified-constructors-and-implicit-conversions">Simplified constructors and implicit conversions</a></h2>
<p>We‚Äôve added easier ways to construct various instances from other types, especially when passing arguments to methods:</p>
<ul>
<li><code>ChatId</code> from a <code>Chat</code> or a <code>User</code> class, so you can pass these directly for the <code>chatId:</code> argument</li>
<li><code>ChatPermissions(bool)</code> and <code>ChatAdministratorRights(bool)</code> constructors to set all Can* fields to the specified value</li>
<li><code>ReactionType</code> from an emoji (string) or a customEmojiId (long)</li>
<li><code>ReplyParameters</code> from a messageId (int), or a <code>Message</code> class, so you can pass these directly for the <code>replyParameters:</code> argument</li>
<li><code>LinkPreviewOptions</code> from a <code>bool</code> where <code>true</code> means to disable the preview</li>
<li><code>LinkPreviewOptions</code> from a <code>string</code> URL to show preview for this link</li>
<li><code>LabeledPrice</code> from tuple <code>(string label, long amount)</code></li>
<li><code>BotCommand</code> from tuple <code>(string command, string description)</code></li>
<li><code>BotCommandScope</code> has several static methods to construct scopes</li>
<li><code>InputFile</code> from a <code>string</code> (fileId or URL), or a <code>Stream</code>, or a received media file, or <code>null</code></li>
</ul>
<p>Examples:</p>
<pre><code class="language-csharp">await bot.RestrictChatMember(chatId, userId, new ChatPermissions(true)); // unmute
await bot.SetMessageReaction(msg.Chat, msg.Id, ["üëç"]);
await bot.SendMessage(msg.Chat, "Visit t.me/tgbots_dotnet", replyParameters: msg, linkPreviewOptions: true);
await bot.SendInvoice(chatId, "Product", "Description", "ProductID", "XTR", [("Price", 500)]);
await Bot.SetMyCommands([("/start", "Start the bot"), ("/privacy", "Privacy policy")], BotCommandScope.AllPrivateChats());
await bot.SendPhoto(msg.Chat, "https://picsum.photos/310/200.jpg");
await bot.SendVideo(msg.Chat, msg.Video, "Sending your video back");
</code></pre>
<h2 id="reply-markup-1"><a class="header" href="#reply-markup-1">Reply Markup</a></h2>
<p>Keyboards can be easily constructed by passing directly the following type of objects for the <code>replyMarkup:</code> parameter:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Type</th><th>Meaning</th></tr>
</thead>
<tbody>
<tr><td><code>string</code></td><td>single keyboard text button</td></tr>
<tr><td><code>string[]</code> or <code>List&lt;string&gt;</code></td><td>keyboard text buttons on one row</td></tr>
<tr><td><code>string[][]</code> or <code>List&lt;List&lt;string&gt;&gt;</code></td><td>multiple keyboard text buttons</td></tr>
<tr><td><code>KeyboardButton</code></td><td>single keyboard button</td></tr>
<tr><td><code>KeyboardButton[]</code> or<br /><code>List&lt;KeyboardButton&gt;</code></td><td>multiple keyboard buttons on one row</td></tr>
<tr><td><code>KeyboardButton[][]</code> or<br /><code>List&lt;List&lt;KeyboardButton&gt;&gt;</code> or<br /><code>IEnumerable&lt;KeyboardButton&gt;[]</code></td><td>multiple keyboard buttons</td></tr>
<tr><td><code>InlineKeyboardButton</code></td><td>single inline button</td></tr>
<tr><td><code>InlineKeyboardButton[]</code> or<br /><code>List&lt;InlineKeyboardButton&gt;</code></td><td>inline buttons on 1 row</td></tr>
<tr><td><code>InlineKeyboardButton[][]</code> or<br /><code>List&lt;List&lt;InlineKeyboardButton&gt;&gt;</code> or<br /> <code>IEnumerable&lt;InlineKeyboardButton&gt;[]</code></td><td>multiple inline buttons</td></tr>
</tbody>
</table>
</div>
<p>Additionally, <code>InlineKeyboardButton</code> can be implicitly constructed from a tuple <code>(string text, string callbackOrUrl)</code> for Callback or Url buttons</p>
<pre><code class="language-csharp">await bot.SendMessage(msg.Chat, "Visit our website", replyMarkup: InlineKeyboardButton.WithUrl("Click here", "https://telegrambots.github.io/book/"));
await bot.SendMessage(botOwnerId, $"Annoying user: {msg.From}", replyMarkup: new InlineKeyboardButton[]
    { ("Ban him", $"BAN {msg.From.Id}"), ("Mute him", $"MUTE {msg.From.Id}") });
await bot.SendMessage(msg.Chat, "Keyboard buttons:", replyMarkup: new string[] { "MENU", "INFO", "LANGUAGE" });
</code></pre>
<h3 id="constructing-dynamically"><a class="header" href="#constructing-dynamically">Constructing dynamically</a></h3>
<p><code>ReplyKeyboardMarkup</code> &amp; <code>InlineKeyboardMarkup</code> have methods to help you construct keyboards dynamically:</p>
<pre><code class="language-csharp">var replyMarkup = new InlineKeyboardMarkup()
    .AddButton(InlineKeyboardButton.WithUrl("Link to Repository", "https://github.com/TelegramBots/Telegram.Bot"))
    .AddNewRow().AddButton("callback").AddButton("caption", "data")
    .AddNewRow("with", "three", "buttons")
    .AddNewRow().AddButtons("A", "B", InlineKeyboardButton.WithSwitchInlineQueryCurrentChat("switch"));
</code></pre>
<p>And you can use <code>new ReplyKeyboardMarkup(true)</code> to resize the reply keyboard.</p>
<h2 id="mini-app-and-login-widget-validation"><a class="header" href="#mini-app-and-login-widget-validation">Mini-App and Login widget validation</a></h2>
<ul>
<li><code>AuthHelpers.ParseValidateData</code> should be used to confirm the authenticity of data received along Telegram‚Äôs Mini-Apps or the Login Widget javascript requests</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="advanced-topics"><a class="header" href="#advanced-topics">Advanced topics</a></h1>
<ul>
<li><a href="#working-behind-a-proxy">Proxy</a></li>
<li><a href="#business-bot-features">Business Features</a></li>
<li><a href="#bot-payments-api--telegram-stars">Payments API</a></li>
<li><a href="#telegram-mini-apps">Mini Apps</a></li>
<li><a href="4/passport">Passport</a></li>
</ul>
<h2 id="telegram-login-widget"><a class="header" href="#telegram-login-widget">Telegram Login Widget</a></h2>
<p>You can use <code>InlineKeyboardButton.WithLoginUrl</code> to easily initiate a login connection to your website using the user‚Äôs Telegram account credentials.</p>
<pre><code class="language-csharp">replyMarkup: InlineKeyboardButton.WithLoginUrl("login",
                 new LoginUrl { Url = "https://yourdomain.com/url" })
</code></pre>
<p>You‚Äôll need to associate your website domain with your bot by sending <code>/setdomain</code> to <code>@BotFather</code>.</p>
<p>See official documentation about <a href="https://core.telegram.org/widgets/login">Telegram Login Widget</a> for more information.</p>
<p>Server-side, you can use our separate repository <a href="https://github.com/TelegramBots/Telegram.Bot.Extensions.LoginWidget"><code>Telegram.Bot.Extensions.LoginWidget</code></a>
to validate the user credentials, or to generate a Javascript to show the login widget directly on your website.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="working-behind-a-proxy"><a class="header" href="#working-behind-a-proxy">Working Behind a Proxy</a></h1>
<p><code>TelegramBotClient</code> allows you to use a proxy for Bot API connections. This guide covers using three different proxy solutions.</p>
<ul>
<li><a href="#http-proxy">HTTP Proxy</a></li>
<li><a href="#socks5-proxy">SOCKS5 Proxy</a></li>
<li><a href="#socks5-proxy-over-tor">SOCKS5 Proxy over Tor (Testing Only)</a></li>
</ul>
<p><img src="4/docs/tg-network.gif" alt="Telegram Network"></p>
<blockquote>
<p>If you are in a country, such as Iran, where HTTP and SOCKS proxy connections to Telegram servers are blocked, consider using a VPN, using Tor Network, or hosting your bot in other jurisdictions.</p>
</blockquote>
<h2 id="http-proxy"><a class="header" href="#http-proxy">HTTP Proxy</a></h2>
<p>You can configure <code>HttpClient</code> with <code>WebProxy</code> and pass it to the Bot client.</p>
<pre><code class="language-csharp">// using System.Net;
// using System.Net.Http;

WebProxy webProxy = new (Host: "https://example.org", Port: 8080)
{
    // Credentials if needed:
    Credentials = new NetworkCredential("USERNAME", "PASSWORD")
};
HttpClient httpClient = new (
    new HttpClientHandler { Proxy = webProxy, UseProxy = true, }
);

var bot = new TelegramBotClient("YOUR_API_TOKEN", httpClient);
</code></pre>
<h2 id="socks5-proxy"><a class="header" href="#socks5-proxy">SOCKS5 Proxy</a></h2>
<p>As of .NET 6, <code>SocketsHttpHandler</code> <a href="https://devblogs.microsoft.com/dotnet/dotnet-6-networking-improvements/#socks-proxy-support">is able to use Socks4, Socks4a and Socks5 proxies</a>!</p>
<pre><code class="language-csharp">// using System.Net;
// using System.Net.Http;

WebProxy proxy = new ("socks5://127.0.0.1:9050")
{
    Credentials = new NetworkCredential("USERNAME", "PASSWORD")
};
HttpClient httpClient = new (
    new SocketsHttpHandler { Proxy = proxy, UseProxy = true, }
);

var bot = new TelegramBotClient("YOUR_API_TOKEN", httpClient);
</code></pre>
<h2 id="socks5-proxy-over-tor"><a class="header" href="#socks5-proxy-over-tor">SOCKS5 Proxy over Tor</a></h2>
<p><strong>Warning: Use for Testing only!</strong></p>
<blockquote>
<p>Do not use this method in a production environment as it has high network latency and poor bandwidth.</p>
</blockquote>
<p>Using Tor, a developer can avoid network restrictions while debugging and testing the code
before a production release.</p>
<ol>
<li>
<p>Install <a href="https://www.torproject.org/">Tor Browser</a></p>
</li>
<li>
<p>Open the <code>torcc</code> file with a text editor (Found in <code>Tor Browser\Browser\TorBrowser\Data\Tor</code>)</p>
</li>
<li>
<p>Add the following lines: (configurations are described below)</p>
<pre><code class="language-text">EntryNodes {NL}
ExitNodes {NL}
StrictNodes 1
SocksPort 127.0.0.1:9050
</code></pre>
</li>
<li>
<p>Look at the <a href="#socks5-proxy">Socks5 proxy</a> example above.</p>
</li>
<li>
<p>Start the Tor Browser</p>
</li>
</ol>
<p>Usage:</p>
<pre><code class="language-csharp">// using System.Net;
// using System.Net.Http;

WebProxy proxy = new ("socks5://127.0.0.1:9050");

HttpClient httpClient = new (
    new SocketsHttpHandler { Proxy = proxy, UseProxy = true }
);

var bot = new TelegramBotClient("YOUR_API_TOKEN", httpClient);
</code></pre>
<blockquote>
<p>Note that Tor has to be active at all times for the bot to work.</p>
</blockquote>
<h3 id="configurations-in-torcc"><a class="header" href="#configurations-in-torcc">Configurations in <code>torcc</code></a></h3>
<pre><code class="language-text">EntryNodes {NL}
ExitNodes {NL}
StrictNodes 1
</code></pre>
<p>These three lines make sure you use nodes from the Netherlands as much as possible to reduce latency.</p>
<p><code>SocksPort 127.0.0.1:9050</code></p>
<p>This line tells tor to listen on port 9050 for any socks connections.
You can change the port to anything you want (9050 is just the default), only make sure to use the same port in your code.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="business-bot-features"><a class="header" href="#business-bot-features">Business Bot Features</a></h1>
<p><a href="https://core.telegram.org/bots/features#bots-for-business"><img src="https://img.shields.io/badge/Bot_API_Doc-Business_Mode_-blue.svg?style=flat-square" alt="Bot Business Mode"></a></p>
<p>Several <a href="https://telegram.org/blog/telegram-business">business features</a> have been added for premium users to Telegram.</p>
<p>In particular, premium users can now select a bot to act as a <a href="https://telegram.org/blog/telegram-business#chatbots-for-business"><strong>chatbot on their behalf</strong></a>,
in order to manage/reply to messages from other users <em>(typically, their business customers)</em>.</p>
<h2 id="botfather-configuration"><a class="header" href="#botfather-configuration">BotFather configuration</a></h2>
<p>First, the bot owner need to talk to <a href="https://t.me/BotFather">@BotFather</a> and go to the <strong>Bot Settings</strong> to enable <strong>Business Mode</strong></p>
<p>In the following sections, we will refer to the premium user using your chatbot as ‚Äú<em>the business owner</em>‚Äù.</p>
<video autoplay="" loop="" controls="" muted="" poster="https://telegram.org/file/400780400238/1/x875tPT245w.58064/1b426d3eda0a923c03" style="width: 100%; max-width: 600px;" title="" alt="Chatbots for Business">
  <source src="https://telegram.org/file/400780400792/3/Y8CWkKZOVHM.3771962.mp4/044a6d7645581d8bf6" type="video/mp4">
</video>
<h2 id="businessconnection-update"><a class="header" href="#businessconnection-update">BusinessConnection update</a></h2>
<p>Once your chatbot is configured, the business owner has to go to their account settings, under <strong>Telegram Business &gt; Chatbots</strong> and type your bot username.</p>
<p>At this point, your bot will receive an <code>update.BusinessConnection</code> which contains:</p>
<ul>
<li>a unique id <em>(you may want to store this)</em></li>
<li>details on the User (business owner)</li>
<li>IsEnabled <em>(false if the business connection got cancelled)</em></li>
<li>CanReply <em>(if the bot can act on behalf of that user in chats that were active in the last 24 hours)</em></li>
</ul>
<p>You can retrieve these info again later using <code>GetBusinessConnection(id)</code></p>
<h2 id="businessmessage-updates"><a class="header" href="#businessmessage-updates">BusinessMessage updates</a></h2>
<p>From now on, your bot will receive updates regarding private messages between users (customers) and the business owner:</p>
<ul>
<li><code>update.BusinessMessage</code>: a customer sent a new message to the business owner</li>
<li><code>update.EditedBusinessMessage</code>: a customer modified one of its message sent to the business owner</li>
<li><code>update.DeletedBusinessMessages</code>: a customer deleted some messages in private with the business owner</li>
</ul>
<p>In these messages/updates, the field <code>BusinessConnectionId</code> will tell you which BusinessConnection this applies to
<em>(useful for context if your chatbot is used by several business owners)</em></p>
<h2 id="acting-on-behalf-of-the-business-owner"><a class="header" href="#acting-on-behalf-of-the-business-owner">Acting on behalf of the business owner</a></h2>
<p>If the business owner enabled ‚Äú<strong>Reply to message</strong>‚Äù during the initial business connection,
your bot can reply or do some other actions on behalf of their user account.</p>
<p>To do so, you can call many Bot API methods with the optional <em>businessConnectionId:</em> parameter.</p>
<p>This way your bot can send/edit/pin messages, send chat actions (like <em>‚Äútyping‚Äù</em>), manage polls/live location, as if you were the business owner user.</p>
<p>Some notes about messages sent on behalf of the business owner:</p>
<ul>
<li>They will NOT be marked with your bot name from the customer point of view</li>
<li>They will be marked with your bot name in the business owner private chat (a banner also appears on top of the chat)</li>
<li>These features are limited to private chats initiated by customers talking to the business owner.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="bot-payments-api--telegram-stars"><a class="header" href="#bot-payments-api--telegram-stars">Bot Payments API &amp; Telegram Stars</a></h1>
<p><a href="https://core.telegram.org/bots/payments"><img src="https://img.shields.io/badge/Bot_Payments_API-Physical_Goods_-blue.svg?style=flat-square" alt="Bot Payments API"></a>
<a href="https://core.telegram.org/bots/payments"><img src="https://img.shields.io/badge/Bot_Payments_API-Digital_Goods-blue.svg?style=flat-square" alt="Bot Payments Stars"></a></p>
<p>Telegram offers a safe, simple and unified payment system for goods and services.</p>
<p>Due to Google/Apple policies, there is a distinction between:</p>
<ul>
<li><strong>Digital Goods &amp; Services</strong>, which can be paid using <a href="https://telegram.org/blog/telegram-stars">Telegram Stars</a> (XTR) only</li>
<li><strong>Physical Goods</strong>, which can be paid using regular currencies, and can request more details like a shipping address.</li>
</ul>
<p>Both process are similar, so we will demonstrate how to do a Telegram Stars payment (simpler) and give you some info about the difference for Physical Goods.</p>
<h2 id="important-notes-for-physical-goods"><a class="header" href="#important-notes-for-physical-goods">Important notes for physical goods</a></h2>
<p>Before starting, you need to talk to <a href="https://t.me/BotFather">@BotFather</a>, select one of the supported
<a href="https://core.telegram.org/bots/payments#supported-payment-providers">Payment providers</a>
(you need to open an account on the provider website), and complete the connection procedure
linking your bot with your provider account.</p>
<blockquote>
<p>It is recommended to start with the <a href="https://core.telegram.org/bots/payments#testing-payments-the-39stripe-test-mode-39-provider">Stripe TEST MODE</a>
provider so you can test your bot with fake card numbers before going live.</p>
</blockquote>
<p>Price amounts are expressed as integers with some digits at the end for the ‚Äúdecimal‚Äù part.<br>For example, in USD currency there are 2 digits for cents, so 12345 means $123.45 ; With Telegram Stars (XTR), there are no extra digits.<br>See <a href="https://core.telegram.org/bots/payments/currencies.json">‚Äúexp‚Äù in this table</a>, to determine the number of decimal digits for each currency.</p>
<h2 id="sending-an-invoice"><a class="header" href="#sending-an-invoice">Sending an invoice</a></h2>
<p><a href="https://core.telegram.org/bots/api#sendinvoice"><img src="https://img.shields.io/badge/Bot_API_method-sendInvoice-blue.svg?style=flat-square" alt="send invoice method"></a></p>
<p>When your bot is ready to issue a payment for the user to complete, it will send an invoice:</p>
<pre><code class="language-csharp">await bot.SendInvoice(
    chatId: chatId,                         // same as userId for private chat
    title: "Product Title",
    description: "Product Detailed Description",
    payload: "InternalProductID",           // not sent nor shown to user
    currency: "XTR",                        // 3-letters ISO 4217 currency
    prices: [("Price", 500)],               // only one price for XTR
    photoUrl: "https://cdn.pixabay.com/photo/2012/10/26/03/16/painting-63186_1280.jpg"
);
</code></pre>
<p>Alternatively, you can instead generate an URL for that payment with <a href="https://core.telegram.org/bots/api#createinvoicelink"><code>CreateInvoiceLink</code></a>,
or if your bot supports <a href="#inline-mode">Inline Mode</a>, you can <a href="https://core.telegram.org/bots/api#inputinvoicemessagecontent">send invoices as inline results</a> (‚Äúvia YourBot‚Äù).</p>
<p>With Physical Goods, you can specify <a href="https://core.telegram.org/bots/api#sendinvoice">more parameters</a> like:</p>
<ul>
<li>the <code>providerToken</code> obtained by BotFather (something like ‚Äú1234567:TEST:aBcDeFgHi‚Äù)</li>
<li>several price lines detailing the total price</li>
<li>some suggested tips</li>
<li>the need for extra information about the user, including a shipping address</li>
<li>if the price is <strong>flexible</strong> depending on the shipping address/method</li>
</ul>
<h2 id="handling-the-shippingquery-update"><a class="header" href="#handling-the-shippingquery-update">Handling the <code>ShippingQuery</code> Update</a></h2>
<p><a href="https://core.telegram.org/bots/api#shippingquery"><img src="https://img.shields.io/badge/Bot_API_update-ShippingQuery-blue.svg?style=flat-square" alt="Shipping Query Update"></a>
<a href="https://core.telegram.org/bots/api#answershippingquery"><img src="https://img.shields.io/badge/Bot_API_method-answerShippingQuery-blue.svg?style=flat-square" alt="Answer Shipping Query method"></a></p>
<p>This update is received only for Physical Goods, if you specified a <strong>flexible</strong> price.
Otherwise you can skip to the next section.</p>
<p><code>update.ShippingQuery</code> would contain information like the current shipping address for the user, and can be received again if the user changes the address.</p>
<p>You should check if the address is supported, and reply using <code>bot.AnswerShippingQuery</code> with an error message or a list of shipping options with associated additional price lines:</p>
<pre><code class="language-csharp">var shippingOptions = new List&lt;ShippingOption&gt;();
shippingOptions.Add(new() { Title = "DHL Express", Id = "dhl-express",
    Prices = [("Shipping", 1200)] });
shippingOptions.Add(new() { Title = "FedEx Fragile", Id = "fedex-fragile",
    Prices = [("Packaging", 500), ("Shipping", 1800)] });
await bot.AnswerShippingQuery(shippingQuery.Id, shippingOptions);
</code></pre>
<h2 id="handling-the-precheckoutquery-update"><a class="header" href="#handling-the-precheckoutquery-update">Handling the <code>PreCheckoutQuery</code> Update</a></h2>
<p><a href="https://core.telegram.org/bots/api#precheckoutquery"><img src="https://img.shields.io/badge/Bot_API_update-PreCheckoutQuery-blue.svg?style=flat-square" alt="Pre Checkout Query Update"></a>
<a href="https://core.telegram.org/bots/api#answerprecheckoutquery"><img src="https://img.shields.io/badge/Bot_API_method-answerPreCheckoutQuery-blue.svg?style=flat-square" alt="Answer Pre Checkout Query method"></a></p>
<p>This update is received when the user has entered their payment information and confirmed the final Pay button.</p>
<p><code>update.PreCheckoutQuery</code> contains all the requested information for the order, so you can validate that all is fine before actual payment</p>
<p>You must reply within 10 seconds with:</p>
<pre><code class="language-csharp">if (confirm)
    await bot.AnswerPreCheckoutQuery(preCheckoutQuery.Id); // success
else
    await bot.AnswerPreCheckoutQuery(preCheckoutQuery.Id, "Can't process your order: &lt;REASON&gt;");
</code></pre>
<h2 id="handling-the-successfulpayment-message"><a class="header" href="#handling-the-successfulpayment-message">Handling the <code>SuccessfulPayment</code> <u>Message</u></a></h2>
<p><a href="https://core.telegram.org/bots/api#successfulpayment"><img src="https://img.shields.io/badge/Bot_API_message-SuccessfulPayment-blue.svg?style=flat-square" alt="Successful Payment Message"></a></p>
<p>If you confirmed the order in the step above, Telegram requests the payment with the payment provider.</p>
<p>If the payment is successfully processed, you will receive a private Message of type <code>SuccessfulPayment</code> from the user, and you must then proceed with delivering the goods or services to the user.</p>
<p>The <code>message.SuccessfulPayment</code> structure contains all the same previous information, plus two payment identifiers from Telegram and from the Payment Provider.</p>
<p>You should store these ChargeId strings for traceability of the transaction in case of dispute, or refund <em>(possible with <a href="https://core.telegram.org/bots/api#refundstarpayment">RefundStarPayment</a>)</em>.</p>
<h2 id="full-example-code-for-telegram-stars-transaction"><a class="header" href="#full-example-code-for-telegram-stars-transaction">Full example code for Telegram Stars transaction</a></h2>
<pre><code class="language-csharp">using Telegram.Bot;
using Telegram.Bot.Types;

var bot = new TelegramBotClient("YOUR_BOT_TOKEN");
bot.OnUpdate += OnUpdate;
Console.ReadKey();

async Task OnUpdate(Update update)
{
   switch (update)
   {
      case { Message.Text: "/start" }:
         await bot.SendInvoice(update.Message.Chat,
            "Unlock feature X", "Will give you access to feature X of this bot", "unlock_X",
            "XTR", [("Price", 200)], photoUrl: "https://cdn-icons-png.flaticon.com/512/891/891386.png");
         break;
      case { PreCheckoutQuery: { } preCheckoutQuery }:
         if (preCheckoutQuery is { InvoicePayload: "unlock_X", Currency: "XTR", TotalAmount: 200 })
            await bot.AnswerPreCheckoutQuery(preCheckoutQuery.Id); // success
         else
            await bot.AnswerPreCheckoutQuery(preCheckoutQuery.Id, "Invalid order");
         break;
      case { Message.SuccessfulPayment: { } successfulPayment }:
         System.IO.File.AppendAllText("payments.log", $"{DateTime.Now}: " +
            $"User {update.Message.From} paid for {successfulPayment.InvoicePayload}: " +
            $"{successfulPayment.TelegramPaymentChargeId} {successfulPayment.ProviderPaymentChargeId}\n");
         if (successfulPayment.InvoicePayload is "unlock_X")
            await bot.SendMessage(update.Message.Chat, "Thank you! Feature X is unlocked");
         break;
   };
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="telegram-mini-apps"><a class="header" href="#telegram-mini-apps">Telegram Mini Apps</a></h1>
<p><a href="https://core.telegram.org/bots/webapps"><img src="https://img.shields.io/badge/Bot_API_Doc-Mini_Apps-blue.svg?style=flat-square" alt="Mini App bot API"></a>
<a href="https://github.com/TelegramBots/Telegram.Bot.Examples/tree/master/MiniApp"><img src="https://img.shields.io/badge/Examples-MiniApp-green?style=flat-square" alt="MiniApp example project"></a></p>
<p>If standard Telegram Bot features aren‚Äôt enough to fit your needs,
you may want to consider building a <a href="https://core.telegram.org/bots/webapps">Mini App</a> instead.</p>
<p>This take the form of an integrated browser window showing directly web pages from your bot WebApp,
so you have more control with HTML/JS to display the interface you like.</p>
 <video autoplay="" loop="" controls="" muted="" poster="https://telegram.org/file/464001434/100bf/eWprjdgzEbE.100386/644bbea83084f44c8f" style="width: 100%; max-width: 600px;" title="" alt="Bot Revolution">
  <source src="https://telegram.org/file/464001679/11aa9/KQx_BlPVXRo.4922145.mp4/c65433c8ac11a347a8" type="video/mp4">
 </video>
<p>Check our <a href="https://github.com/TelegramBots/Telegram.Bot.Examples/tree/master/MiniApp">full example project</a> based on Razor pages, and including a clone of the above <a href="https://t.me/DurgerKingBot">@DurgerKingBot</a> and more demo to test features.</p>
<h2 id="starting-mini-apps"><a class="header" href="#starting-mini-apps">Starting Mini-Apps</a></h2>
<p>Mini Apps can be launched from various ways:</p>
<ul>
<li><a href="#custom-reply-keyboards">Keyboard Buttons</a>: <code>KeyboardButton.WithWebApp</code></li>
<li><a href="#inline-keyboards">Inline Buttons</a>: <code>InlineKeyboardButton.WithWebApp</code></li>
<li>Open App button: configured via @BotFather &gt; Bot Settings &gt; Configure Mini App</li>
<li>Chat menu buton (left of user textbox): configured via <code>SetChatMenuButton</code></li>
<li>Inline-mode results with a ‚ÄúSwitch to Mini App‚Äù button: <code>AnswerInlineQuery</code> with parameter <code>InlineQueryResultsButton.WebApp</code></li>
<li>Direct link like https://t.me/botusername/appname?startapp=command</li>
</ul>
<h2 id="integration"><a class="header" href="#integration">Integration</a></h2>
<p>Your web pages must include this script in the <code>&lt;head&gt;</code> part:</p>
<pre><code class="language-html">&lt;script src="https://telegram.org/js/telegram-web-app.js"&gt;&lt;/script&gt;
</code></pre>
<p>Your Javascript can then access a <a href="https://core.telegram.org/bots/webapps#initializing-mini-apps">Telegram.WebApp</a> object supporting many <a href="https://core.telegram.org/bots/webapps#initializing-mini-apps">properties and methods</a>, as well as <a href="https://core.telegram.org/bots/webapps#events-available-for-mini-apps">event handlers</a>.</p>
<p>In particular, you may want to use your Telegram.Bot backend to validate the authenticity of <code>Telegram.WebApp.initData</code>.</p>
<p>This can be done using our <code>AuthHelpers.ParseValidateData</code> method and the bot token, to make sure the requests come from Telegram and obtain information about Telegram user and context.</p>
<h2 id="for-more-details"><a class="header" href="#for-more-details">For more details</a></h2>
<p>To read more about Mini Apps, see <a href="https://core.telegram.org/bots/webapps">https://core.telegram.org/bots/webapps</a></p>
<p>Visit our example project: <a href="https://github.com/TelegramBots/Telegram.Bot.Examples/tree/master/MiniApp">https://github.com/TelegramBots/Telegram.Bot.Examples/tree/master/MiniApp</a></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="telegram-passport"><a class="header" href="#telegram-passport">Telegram Passport</a></h1>
<p><a href="https://core.telegram.org/passport"><img src="https://img.shields.io/badge/Telegram-Passport_Manual-blue.svg?style=flat-square" alt="Passport Documentation"></a>
<a href="https://core.telegram.org/passport/example"><img src="https://img.shields.io/badge/Telegram-Test_Passport-violet.svg?style=flat-square" alt="Passport Test page"></a>
<a href="https://github.com/TelegramBots/Telegram.Bot.Extensions.Passport/tree/TestMergeInTB/src/Quickstart"><img src="https://img.shields.io/badge/Examples-Passport_Quickstart-green.svg?style=flat-square" alt="Passport Quickstart example"></a></p>
<p><a href="https://telegram.org/blog/passport">Telegram Passport</a> is a unified authorization method for services that require personal identification.
As a bot developer, you can use it to receive confidential user data in an end-to-end encrypted fashion.<br>There are several Know Your Customer (KYC) solutions that have already added support for Telegram Passport.</p>
<p>This guide is targeted at bot developers and presents our library support for Telegram Passport.
Click the badges above for more documentation.</p>
<h1 id="quickstart-1"><a class="header" href="#quickstart-1">Quickstart</a></h1>
<p>This guide teaches the basics of working with Telegram Passport.
See the complete version of the code at <a href="https://github.com/TelegramBots/Telegram.Bot.Extensions.Passport/tree/TestMergeInTB/src/Quickstart">Quickstart project</a>.
Code snippets on this page are in the context of that project.</p>
<h2 id="encryption-keys"><a class="header" href="#encryption-keys">Encryption Keys</a></h2>
<p>You don‚Äôt really need to generate any RSA key. Use our sample keys for this demo.
Send the public key to <a href="https://t.me/BotFather">@BotFather</a> using <code>/setpublickey</code> command:</p>
<p><img src="4/docs/shot-passport_botfather.jpg" alt="Setting public key"></p>
<p>Copy this public key and send it to BotFather.</p>
<pre><code class="language-text">-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA0VElWoQA2SK1csG2/sY/
wlssO1bjXRx+t+JlIgS6jLPCefyCAcZBv7ElcSPJQIPEXNwN2XdnTc2wEIjZ8bTg
BlBqXppj471bJeX8Mi2uAxAqOUDuvGuqth+mq7DMqol3MNH5P9FO6li7nZxI1FX3
9u2r/4H4PXRiWx13gsVQRL6Clq2jcXFHc9CvNaCQEJX95jgQFAybal216EwlnnVV
giT/TNsfFjW41XJZsHUny9k+dAfyPzqAk54cgrvjgAHJayDWjapq90Fm/+e/DVQ6
BHGkV0POQMkkBrvvhAIQu222j+03frm9b2yZrhX/qS01lyjW4VaQytGV0wlewV6B
FwIDAQAB
-----END PUBLIC KEY-----
</code></pre>
<p>Now Telegram client app can encrypt the data for your bot using this key.</p>
<h2 id="request-information"><a class="header" href="#request-information">Request Information</a></h2>
<p>Bot waits for a text message from user. Once it receives a text message, it generates an authorization request link
and sends that to the user.</p>
<h3 id="authorization-request"><a class="header" href="#authorization-request">Authorization Request</a></h3>
<p><a href="https://core.telegram.org/passport#request-parameters"><img src="https://img.shields.io/badge/Passport_API_type-Request_Parameters-blue.svg?style=flat-square" alt="Request Parameters type"></a></p>
<p>A passport authorization request means that the bot should ask the user to open a <code>tg://resolve</code> URI in the browser
with specific parameters in its query string.
You can alternatively have a button in an HTML page on your website for that.</p>
<p>Type <code>AuthorizationRequestParameters</code> helps you in creating such an URI.</p>
<pre><code class="language-c#">AuthorizationRequestParameters authReq = new AuthorizationRequestParameters(
    botId: 123456, // bot user ID
    publicKey: "...", // public key in PEM format. same as the key above.
    nonce: "unique nonce for this request",
    scope: new PassportScope { // a PassportScope object
        Data = [
            new PassportScopeElementOne(EncryptedPassportElementType.Address),
            new PassportScopeElementOne(EncryptedPassportElementType.PhoneNumber)
        ]
    });
</code></pre>
<p>In <code>SendAuthorizationRequestAsync</code> method, we ask for <code>address</code> and <code>phone_number</code> scopes.
Then, we generate the query string and ask user to open the link.</p>
<p>You might be wondering what is the magic in here?</p>
<p>Our webpage <a href="https://telegrambots.github.io/Telegram.Bot.Extensions.Passport/redirect.html">https://telegrambots.github.io/Telegram.Bot.Extensions.Passport/redirect.html</a><br>redirects the user to <code>tg://resolve</code> URI, appending whatever query string was passed to it.</p>
<blockquote>
<p>If a user is using an Android device, the URI will start with <code>tg:</code> instead of the default <code>tg://</code>.</p>
</blockquote>
<p><img src="4/docs/shot-passport_link1.jpg" alt="Passport link 1">
<img src="4/docs/shot-passport_link2.jpg" alt="Passport link 2"></p>
<h3 id="passport-data"><a class="header" href="#passport-data">Passport Data</a></h3>
<p>You, the user, should now be redirected to the Telegram Passport screen in your Telegram client app.
Enter your password and log in.</p>
<blockquote>
<p>Note that the app will ask you to register if this is the first time you are using Telegram Passport.</p>
</blockquote>
<p><img src="4/docs/shot-passport_login.jpg" alt="Passport login"></p>
<p>Fill in the <em>address</em> and <em>phone number</em> data. Click on the <em>Authorize</em> button at the end.</p>
<p><img src="4/docs/shot-passport_adress_phone1.jpg" alt="Passport info 1">
<img src="4/docs/shot-passport_adress.jpg" alt="address info">
<img src="4/docs/shot-passport_phone.jpg" alt="phone info">
<img src="4/docs/shot-passport_adress_phone2.jpg" alt="Passport info 2"></p>
<p>At this point, your Telegram client app encrypts the actual Telegram Passport data (e.g. address) using the
AES algorithm, and then encrypts the info required for decryption using your bot‚Äôs public RSA key.
Finally, it sends the result of both encryptions to Telegram servers.</p>
<h3 id="data-decryption"><a class="header" href="#data-decryption">Data Decryption</a></h3>
<p><a href="https://core.telegram.org/bots/api#passportdata"><img src="https://img.shields.io/badge/Bot_API_type-Passport_Data-blue.svg?style=flat-square" alt="Passport Data type"></a></p>
<p>Your bot now receives a new message update with the encrypted Passport data. The user is also notified in the chat:</p>
<p><img src="4/docs/shot-passport_update.jpg" alt="Passport update"></p>
<p>Let‚Äôs decrypt that gibberish to get the information. That‚Äôs what <code>DecryptPassportDataAsync</code> method does.</p>
<h4 id="step-1-credentials"><a class="header" href="#step-1-credentials">Step 1: Credentials</a></h4>
<p><a href="https://core.telegram.org/bots/api#encryptedcredentials"><img src="https://img.shields.io/badge/Bot_API_type-EncryptedCredentials-blue.svg?style=flat-square" alt="EncryptedCredentials type"></a>
<a href="https://core.telegram.org/passport#credentials"><img src="https://img.shields.io/badge/Passport_API_type-Credentials-blue.svg?style=flat-square" alt="Credentials type"></a></p>
<p>You can‚Äôt just access the encrypted data in the <code>message.PassportData.Data</code> array.
Required parameters for their decryption are in the <code>message.PassportData.Credentials</code> object.
But that credentials object is encrypted using bot‚Äôs public key!</p>
<p>We first take the bot‚Äôs <em>private key</em> this time and decrypt the credentials.</p>
<blockquote>
<p>Note: We are loading the RSA key from PEM format thanks to the method <code>RSA.ImportFromPem</code> (.NET 5+).</p>
</blockquote>
<pre><code class="language-c#">var decrypter = new Decrypter();
var credentials = decrypter.DecryptCredentials(message.PassportData.Credentials, GetRsaPrivateKey());
</code></pre>
<h4 id="step-2-nonce"><a class="header" href="#step-2-nonce">Step 2: Nonce</a></h4>
<p><a href="https://core.telegram.org/passport#credentials"><img src="https://img.shields.io/badge/Passport_API_type-Credentials-blue.svg?style=flat-square" alt="Credentials type"></a>
<a href="https://core.telegram.org/passport#request-parameters"><img src="https://img.shields.io/badge/Passport_API_type-Request_Parameters-blue.svg?style=flat-square" alt="Request Parameters type"></a></p>
<p>There is a <code>nonce</code> property on the credentials (now decrypted) object.
In order to prevent certain attacks, ensure its value is exactly the same as the nonce you set in the authorization request.
Read more about <a href="https://en.wikipedia.org/wiki/Cryptographic_nonce">nonce on Wikipedia</a>.</p>
<h4 id="step-3-residential-address"><a class="header" href="#step-3-residential-address">Step 3: Residential Address</a></h4>
<p><a href="https://core.telegram.org/bots/api#encryptedpassportelement"><img src="https://img.shields.io/badge/Bot_API_type-EncryptedPassportElement-blue.svg?style=flat-square" alt="EncryptedPassportElement type"></a>
<a href="https://core.telegram.org/passport#residentialaddress"><img src="https://img.shields.io/badge/Passport_API_type-ResidentialAddress-blue.svg?style=flat-square" alt="ResidentialAddress type"></a></p>
<p><a href="https://core.telegram.org/passport#securedata"><img src="https://img.shields.io/badge/Passport_API_type-SecureData-blue.svg?style=flat-square" alt="SecureData type"></a>
<a href="https://core.telegram.org/passport#securevalue"><img src="https://img.shields.io/badge/Passport_API_type-SecureValue-blue.svg?style=flat-square" alt="SecureValue type"></a>
<a href="https://core.telegram.org/passport#datacredentials"><img src="https://img.shields.io/badge/Passport_API_type-DataCredentials-blue.svg?style=flat-square" alt="DataCredentials type"></a></p>
<p>It‚Äôs finally time to see the user‚Äôs address.
We are looking for an encrypted element with type of <em>address</em> in <code>message.PassportData.Data</code> array.
Also, decryption parameters for that are in <code>Credentials.SecureData.Address.Data</code>.
Here is how the decryption magic happens:</p>
<pre><code class="language-c#">var addressElement = message.PassportData.Data.Single(el =&gt; el.Type == PassportEnums.Scope.Address);
var address = decrypter.DecryptData&lt;ResidentialAddress&gt;(addressElement.Data, credentials.SecureData.Address.Data);
</code></pre>
<p><code>DecryptData</code> method does 3 tasks here:</p>
<ol>
<li>Decrypts the data into a JSON-serialized string</li>
<li>Verifies that the data hashes match</li>
<li>Converts from JSON to a .NET object</li>
</ol>
<h4 id="step-4-phone-number"><a class="header" href="#step-4-phone-number">Step 4: Phone Number</a></h4>
<p><a href="https://core.telegram.org/bots/api#encryptedpassportelement"><img src="https://img.shields.io/badge/Bot_API_type-EncryptedPassportElement-blue.svg?style=flat-square" alt="EncryptedPassportElement type"></a></p>
<p>Values for phone number and email address are not end-to-end encrypted in Telegram Passport and
Telegram stores these values after being verified.</p>
<p>There is no need for decryption at this point.
Just find the element with the type of <em>phone_number</em> in the <code>message.PassportData.Data</code> array.</p>
<h3 id="information-demo"><a class="header" href="#information-demo">Information Demo</a></h3>
<p>At the end, bot sends some of the information received to the user for demo purposes.</p>
<p><img src="4/docs/shot-passport_quickstart.jpg" alt="info demo"></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="passport-files-and-documents"><a class="header" href="#passport-files-and-documents">Passport Files and Documents</a></h1>
<p><a href="https://github.com/TelegramBots/Telegram.Bot.Extensions.Passport/blob/master/test/IntegrationTests/Single%20Scope%20Requests/Driver%20License%20Tests.cs"><img src="https://img.shields.io/badge/Examples-Driver_License_Scope-green.svg?style=flat-square" alt="driver‚Äôs license scope tests"></a></p>
<p>We use the driver‚Äôs license scope here to show decryption of <em>ID document data</em> and <em>passport files</em> for
front side scan, reverse side scan, selfie photo, and translation scan.
That should cover most of the <a href="https://core.telegram.org/passport#fields">field types in Telegram Passport</a>.</p>
<p>Sections below are referring to the test methods in <a href="https://github.com/TelegramBots/Telegram.Bot.Extensions.Passport/blob/master/test/IntegrationTests/Single%20Scope%20Requests/Driver%20License%20Tests.cs">Driver‚Äôs License Scope Tests</a> collection.
Here are the steps:</p>
<ol>
<li><a href="#authorization-request-1">Authorization Request</a></li>
<li><a href="#drivers-license-info">Driver‚Äôs License Info</a></li>
<li><a href="#passport-message">Passport Message</a></li>
<li><a href="#credentials">Credentials</a></li>
<li><a href="#id-document-data">ID Document Data</a></li>
<li><a href="#passport-file">Passport File</a>
<ul>
<li><a href="#front-side-file">Front Side File</a></li>
<li><a href="#reverse-side-file">Reverse Side File</a></li>
<li><a href="#selfie-file">Selfie File</a></li>
<li><a href="#translation-file">Translation File</a></li>
</ul>
</li>
</ol>
<h2 id="authorization-request-1"><a class="header" href="#authorization-request-1">Authorization Request</a></h2>
<p><a href="https://core.telegram.org/passport#passportscope"><img src="https://img.shields.io/badge/Passport_API_type-PassportScope-blue.svg?style=flat-square" alt="PassportScope type"></a>
<a href="https://core.telegram.org/passport#passportscopeelementone"><img src="https://img.shields.io/badge/Passport_API_type-PassportScopeElementOne-blue.svg?style=flat-square" alt="PassportScopeElementOne type"></a></p>
<p><a href="https://github.com/TelegramBots/Telegram.Bot.Extensions.Passport/blob/master/test/IntegrationTests/Single%20Scope%20Requests/Driver%20License%20Tests.cs"><img src="https://img.shields.io/badge/Test_Method-Generate_Auth_Link-green.svg?style=flat-square" alt="method Should_Generate_Auth_Link"></a></p>
<p>We start by generating an authorization URI.
Since a driver‚Äôs license is considered as a proof of identity, we ask for optional data <em>selfie with document</em> and
<em>translation document scan</em> as well.</p>
<p><img src="4/docs/shot-passport_driver_license_link.jpg" alt="driver‚Äôs license passport link"></p>
<h2 id="drivers-license-info"><a class="header" href="#drivers-license-info">Driver‚Äôs License Info</a></h2>
<p>As a user, provide information for the required fields: front side, reverse side, and document number.
Also, test methods here expect a selfie photo and a file for translation scan.</p>
<p><img src="4/docs/shot-passport_driver_license1.jpg" alt="driver‚Äôs license passport 1">
<img src="4/docs/shot-passport_driver_license2.jpg" alt="driver‚Äôs license passport 2">
<img src="4/docs/shot-passport_driver_license3.jpg" alt="driver‚Äôs license passport 3"></p>
<p>Click the <em>Authorize</em> button at the end.</p>
<h2 id="passport-message"><a class="header" href="#passport-message">Passport Message</a></h2>
<p><a href="https://core.telegram.org/bots/api#passportdata"><img src="https://img.shields.io/badge/Bot_API_type-Passport_Data-blue.svg?style=flat-square" alt="Passport Data type"></a></p>
<p><a href="https://github.com/TelegramBots/Telegram.Bot.Extensions.Passport/blob/master/test/IntegrationTests/Single%20Scope%20Requests/Driver%20License%20Tests.cs"><img src="https://img.shields.io/badge/Test_Method-Validate_Passport_Update-green.svg?style=flat-square" alt="method Should_validate_passport_update"></a></p>
<p>This test method checks for a Passport message with a driver‚Äôs license element on it.</p>
<h2 id="credentials"><a class="header" href="#credentials">Credentials</a></h2>
<p><a href="https://core.telegram.org/bots/api#encryptedcredentials"><img src="https://img.shields.io/badge/Bot_API_type-EncryptedCredentials-blue.svg?style=flat-square" alt="EncryptedCredentials type"></a>
<a href="https://core.telegram.org/passport#credentials"><img src="https://img.shields.io/badge/Passport_API_type-Credentials-blue.svg?style=flat-square" alt="Credentials type"></a></p>
<p><a href="https://github.com/TelegramBots/Telegram.Bot.Extensions.Passport/blob/master/test/IntegrationTests/Single%20Scope%20Requests/Driver%20License%20Tests.cs"><img src="https://img.shields.io/badge/Test_Method-Decrypt_Credentials-green.svg?style=flat-square" alt="method Should_decrypt_credentials"></a></p>
<p>We decrypt credentials using the RSA private key and verify that the same nonce is used.</p>
<pre><code class="language-c#">RSA key = EncryptionKey.ReadAsRsa();
var decrypter = new Decrypter();
var credentials = decrypter.DecryptCredentials(passportData.Credentials, key);
bool isSameNonce = credentials.Nonce == "Test nonce for driver's license";
</code></pre>
<h2 id="id-document-data"><a class="header" href="#id-document-data">ID Document Data</a></h2>
<p><a href="https://core.telegram.org/passport#iddocumentdata"><img src="https://img.shields.io/badge/Passport_API_type-IdDocumentData-blue.svg?style=flat-square" alt="IdDocumentData type"></a></p>
<p><a href="https://github.com/TelegramBots/Telegram.Bot.Extensions.Passport/blob/master/test/IntegrationTests/Single%20Scope%20Requests/Driver%20License%20Tests.cs"><img src="https://img.shields.io/badge/Test_Method-decrypt_Document_Data-green.svg?style=flat-square" alt="method Should_decrypt_document_data"></a></p>
<p>In our test case, there is only 1 item in the <code>message.PassportData.Data</code> array and that‚Äôs the encrypted element for
the driver‚Äôs license scope.
We can get information such as document number and expiry date for the license from that element:</p>
<pre><code class="language-c#">IdDocumentData licenseDoc = decrypter.DecryptData&lt;IdDocumentData&gt;(
    encryptedData: element.Data,
    dataCredentials: credentials.SecureData.DriverLicense.Data
);
</code></pre>
<h2 id="passport-file"><a class="header" href="#passport-file">Passport File</a></h2>
<p><a href="https://core.telegram.org/bots/api#passportfile"><img src="https://img.shields.io/badge/Bot_API_type-PassportFile-blue.svg?style=flat-square" alt="PassportFile type"></a>
<a href="https://core.telegram.org/passport#filecredentials"><img src="https://img.shields.io/badge/Passport_API_type-FileCredentials-blue.svg?style=flat-square" alt="FileCredentials type"></a></p>
<p>Passport file is an encrypted JPEG file on Telegram servers.
You need to download the passport file and decrypt it using its accompanying <em>file credentials</em> to see
the actual JPEG file content.
In this section we try to demonstrate different use cases that you might have for such files.</p>
<p>No matter the method used, the underlying decryption logic is the same.
It really comes down to your decision on working with <em>streams</em> vs. <em>byte arrays</em>.
<code>Decrypter</code> gives you both options.</p>
<h3 id="front-side-file"><a class="header" href="#front-side-file">Front Side File</a></h3>
<p><a href="https://github.com/TelegramBots/Telegram.Bot.Extensions.Passport/blob/master/test/IntegrationTests/Single%20Scope%20Requests/Driver%20License%20Tests.cs"><img src="https://img.shields.io/badge/Test_Method-decrypt_Front_Side_File-green.svg?style=flat-square" alt="method Should_decrypt_front_side_file"></a></p>
<p>A pretty handy extension method is used here to stream writing the front side file to disk.
Method <code>DownloadAndDecryptPassportFileAsync</code> does a few things:</p>
<ol>
<li>Makes an HTTP request to fetch the encrypted file‚Äôs info using its <em>passport file_id</em></li>
<li>Makes an HTTP request to download the encrypted file using its <em>file_path</em></li>
<li>Decrypts the encrypted file</li>
<li>Writes the actual content to the destination stream</li>
</ol>
<pre><code class="language-c#">TGFile encryptedFileInfo;
using (System.IO.Stream stream = System.IO.File.OpenWrite("/path/to/front-side.jpg"))
{
    encryptedFileInfo = await bot.DownloadAndDecryptPassportFileAsync(
        element.FrontSide, // PassportFile object for front side
        credentials.SecureData.DriverLicense.FrontSide, // front side FileCredentials
        stream // destination stream for writing the JPEG content to
    );
}
</code></pre>
<blockquote class="blockquote-tag blockquote-tag-warning">
<p class="blockquote-tag-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>Warning</p>
<p>This method is convenient to use but gives you the least amount of control over the operations.</p>
</blockquote>
<h3 id="reverse-side-file"><a class="header" href="#reverse-side-file">Reverse Side File</a></h3>
<p><a href="https://github.com/TelegramBots/Telegram.Bot.Extensions.Passport/blob/master/test/IntegrationTests/Single%20Scope%20Requests/Driver%20License%20Tests.cs"><img src="https://img.shields.io/badge/Test_Method-decrypt_Reverse_Side_File-green.svg?style=flat-square" alt="method Should_decrypt_reverse_side_file"></a></p>
<p>Previous method call is divided into two operations here for reverse side of the license.
Streams are used here as well.</p>
<pre><code class="language-c#">File encryptedFileInfo;
using (System.IO.Stream
    encryptedContent = new System.IO.MemoryStream(element.ReverseSide.FileSize),
    decryptedFile = System.IO.File.OpenWrite("/path/to/reverse-side.jpg")
) {
    // fetch the encrypted file info and download it to memory
    encryptedFileInfo = await bot.GetInfoAndDownloadFile(
        element.ReverseSide.FileId, // file_id of passport file for reverse side
        encryptedContent // stream to copy the encrypted file into
    );
    // ensure memory stream is at the beginning before reading from it
    encryptedContent.Position = 0;

    // decrypt the file and write it to disk
    await decrypter.DecryptFileAsync(
        encryptedContent,
        credentials.SecureData.DriverLicense.ReverseSide, // reverse side FileCredentials
        decryptedFile // destination stream for writing the JPEG content to
    );
}
</code></pre>
<h3 id="selfie-file"><a class="header" href="#selfie-file">Selfie File</a></h3>
<p><a href="https://github.com/TelegramBots/Telegram.Bot.Extensions.Passport/blob/master/test/IntegrationTests/Single%20Scope%20Requests/Driver%20License%20Tests.cs"><img src="https://img.shields.io/badge/Test_Method-decrypt_Selfie_File-green.svg?style=flat-square" alt="method Should_decrypt_selfie_file"></a></p>
<p>We deal with selfie photo as a byte array.
This is essentially the same operation as done above via streams.
We also post the selfie photo to a chat.</p>
<pre><code class="language-c#">// fetch the info of the passport file(selfie) residing on Telegram servers
TGFile encryptedFileInfo = await bot.GetFile(element.Selfie.FileId);

// download the encrypted file and get its bytes
byte[] encryptedContent;
using (System.IO.MemoryStream
    stream = new System.IO.MemoryStream(encryptedFileInfo.FileSize)
)
{
    await bot.DownloadFile(encryptedFileInfo, stream);
    encryptedContent = stream.ToArray();
}

// decrypt the content and get bytes of the actual selfie photo
byte[] selfieContent = decrypter.DecryptFile(
    encryptedContent,
    credentials.SecureData.DriverLicense.Selfie
);

// send the photo to a chat
using (System.IO.Stream stream = new System.IO.MemoryStream(selfieContent)) {
    await bot.SendPhoto(
        123456,
        stream,
        "selfie with driver's license"
    );
}
</code></pre>
<h3 id="translation-file"><a class="header" href="#translation-file">Translation File</a></h3>
<p><a href="https://github.com/TelegramBots/Telegram.Bot.Extensions.Passport/blob/master/test/IntegrationTests/Single%20Scope%20Requests/Driver%20License%20Tests.cs"><img src="https://img.shields.io/badge/Test_Method-decrypt_Translation_File-green.svg?style=flat-square" alt="method Should_decrypt_translation_file"></a></p>
<p>A bot can request certified English translations of a document.
Translations are also encrypted passport files so their decryption is no different from others passport files.</p>
<p>Assuming that the user sends one translation scan only for the license, we receive the translation passport file object in
<code>message.PassportData.Data[0].Translation[0]</code> and its accompanying file credentials object in
<code>credentials.SecureData.DriverLicense.Translation[0]</code>.</p>
<p>File gets written to disk as a byte array.</p>
<pre><code class="language-c#">PassportFile passportFile = element.Translation[0];
FileCredentials fileCreds = credentials.SecureData.DriverLicense.Translation[0];

// fetch passport file info
TGFile encryptedFileInfo = await bot.GetFile(passportFile.FileId);

// download encrypted file and get its bytes
byte[] encryptedContent;
using (System.IO.MemoryStream
    stream = new System.IO.MemoryStream(encryptedFileInfo.FileSize)
)
{
    await bot.DownloadFile(encryptedFileInfo, stream);
    encryptedContent = stream.ToArray();
}

// decrypt the content and get bytes of the actual selfie photo
byte[] content = decrypter.DecryptFile(
    encryptedContent,
    fileCreds
);

// write the file to disk
await System.IO.File.WriteAllBytesAsync("/path/to/translation.jpg", content);
</code></pre>
<!-- ----------- -->
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="handling-passport-errors"><a class="header" href="#handling-passport-errors">Handling Passport errors</a></h1>
<h2 id="handling-data-errors"><a class="header" href="#handling-data-errors">Handling Data Errors</a></h2>
<p><a href="https://core.telegram.org/bots/api#setpassportdataerrors"><img src="https://img.shields.io/badge/Bot_API_method-setPassportDataErrors-blue.svg?style=flat-square" alt="setPassportDataErrors method"></a></p>
<p>If the passport data you received contains errors, the bot can use the <a href="https://core.telegram.org/bots/api#setpassportdataerrors">SetPassportDataErrors</a> method to inform the user and request information again. The user will not be able to resend the data, until all errors are fixed.</p>
<p>Here is an example call using decrypted <a href="#credentials">credentials</a>:</p>
<pre><code class="language-csharp">//using Telegram.Bot.Types.Passport;

PassportElementError[] errors =
{
    new PassportElementErrorDataField
    {
        Type = EncryptedPassportElementType.Passport,
        FieldName = "document_no",
        DataHash = credentials.SecureData.Passport.Data.DataHash,
        Message = "Invalid passport number"
    },
    new PassportElementErrorFrontSide
    {
        Type = EncryptedPassportElementType.Passport,
        FileHash = credentials.SecureData.Passport.FrontSide.FileHash,
        Message = "Document scan is redacted"
    },
    new PassportElementErrorSelfie
    {
        Type = EncryptedPassportElementType.Passport,
        FileHash = credentials.SecureData.Passport.Selfie.FileHash,
        Message = "Take a selfie without glasses"
    },
    new PassportElementErrorTranslationFile
    {
        Type = EncryptedPassportElementType.Passport,
        FileHash = credentials.SecureData.Passport.Translation[0].FileHash,
        Message = "Document photo is blury"
    },
};

await bot.SetPassportDataErrors(passportMessage.From.Id, errors);
</code></pre>
<h2 id="decryption-error-passportdatadecryptionexception"><a class="header" href="#decryption-error-passportdatadecryptionexception">Decryption error (<code>PassportDataDecryptionException</code>)</a></h2>
<p>Methods on <code>Decrypter</code> might throw <code>PassportDataDecryptionException</code> exception if an error happens during decryption.
The exception message tells you what went wrong but there is not much you can do to resolve it.
Maybe let your user know the issue and ask for Passport data again.</p>
<p>It is important to pass each piece of encrypted data, e.g. Id Document, Passport File, etc., with the right
accompanying credentials to decryption methods.</p>
<p>Spot the <em>problem in this code</em> decrypting driver‚Äôs license files:</p>
<pre><code class="language-c#">byte[] selfieContent = decrypter.DecryptFile(
    encSelfieContent, // byte array of encrypted selfie file
    credentials.SecureData.DriverLicense.FrontSide // WRONG! use selfie file credentials
);
// throws PassportDataDecryptionException: "Data hash mismatch at position 123."
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="frequently-asked-questions"><a class="header" href="#frequently-asked-questions">Frequently Asked Questions</a></h1>
<p>I recommend you read all of these as you will learn many interesting things. Or you can use Ctrl-F to search for a specific topic.</p>
<ul>
<li><a href="#1-can-you-give-me-documentationexamples-links">1. Can you give me documentation/examples links?</a></li>
<li><a href="#2-my-update-handler-fails-or-stops-executing-at-some-point">2. My update handler fails or stops executing at some point</a></li>
<li><a href="#3-apparently-my-update-handler-gets-a_-nullreferenceexception">3. Apparently my update handler gets a_ <code>NullReferenceException</code></a></li>
<li><a href="#4-how-to-add-buttons-under-a-message">4. How to add buttons under a message?</a></li>
<li><a href="#5-how-to-handle-a-click-on-such-inline-buttons">5. How to handle a click on such inline buttons?</a></li>
<li><a href="#6-how-to-show-a-popup-text-to-the-user">6. How to show a popup text to the user?</a></li>
<li><a href="#7-how-to-fill-the-input-textbox-of-the-user-with-some-text">7. How to fill the input textbox of the user with some text?</a></li>
<li><a href="#8-how-to-fetch-previous-messages">8. How to fetch previous messages?</a></li>
<li><a href="#9-how-to-fetch-a-list-of-all-users-in-chat">9. How to fetch a list of all users in chat?</a></li>
<li><a href="#10-how-to-send-a-private-message-to-some-random-user">10. How to send a private message to some random user?</a></li>
<li><a href="#11-how-to-detect-if-a-user-blocked-my-bot">11. How to detect if a user blocked my bot?</a></li>
<li><a href="#12-how-to-set-a-caption-and-replymarkup-to-a-media-group-album">12. How to set a caption and ReplyMarkup to a media group (album)?</a></li>
<li><a href="#13-how-to-write-a-bot-that-make-questionsanswers-with-users">13. How to write a bot that make questions/answers with users?</a></li>
<li><a href="#14-how-to-make-font-effects-in-message">14. How to make font effects in message?</a></li>
<li><a href="#15-where-can-i-host-my-bot-online-for-cheapfree">15. Where can I host my bot online for cheap/free?</a></li>
<li><a href="#16-is-there-some-limitationmaximum-about-feature-x">16. Is there some limitation/maximum about feature X?</a></li>
<li><a href="#17-how-to-populate-the-bot-menu-button--commands-list">17. How to populate the bot Menu button / commands list?</a></li>
<li><a href="#18-how-to-receive-chatmember-updates">18. How to receive <code>ChatMember</code> updates?</a></li>
<li><a href="#19-how-to-get-rid-of-past-updates-when-i-restart-my-bot">19. How to get rid of past updates when I restart my bot?</a></li>
<li><a href="#20-difficulties-to-upload--send-a-filemedia">20. Difficulties to upload &amp; send a file/media?</a></li>
<li><a href="#21-how-to-fetch-all-medias-from-an-albummedia-group-">21. How to fetch all medias from an album/media group ?</a></li>
<li><a href="#22-how-to-send-a-custom-emoji">22. How to send a custom emoji‚ùì</a></li>
<li><a href="#23-how-to-change-buttontext-color-or-background">23. How to change button/text color or background?</a></li>
<li><a href="#24-can-i-use-several-appsinstance-to-manage-my-bot">24. Can I use several apps/instance to manage my bot?</a></li>
<li><a href="#25-how-do-i-get-the-user-id-from-a-username">25. How do I get the user id from a username?</a></li>
<li><a href="#26-how-to-receive-messages-from-channels">26. How to receive messages from channels?</a></li>
<li><a href="#27-how-to-send-the-same-media-multiple-times">27. How to send the same media multiple times</a></li>
<li><a href="#this-faq-doesnt-have-my-question-on-it">This FAQ doesn‚Äôt have my question on it</a></li>
</ul>
<h3 id="1-can-you-give-me-documentationexamples-links"><a class="header" href="#1-can-you-give-me-documentationexamples-links"><em>1. Can you give me documentation/examples links?</em></a></h3>
<ul>
<li>Here is the <a href="https://telegrambots.github.io/book/">main documentation website</a>.</li>
<li>You can find <a href="https://github.com/TelegramBots/Telegram.Bot.Examples">more bot example projects</a> here</li>
<li>Search the <a href="https://core.telegram.org/bots/api">official API documentation</a> and <a href="https://core.telegram.org/bots/faq">official bots FAQ</a>.</li>
<li>check tooltips in your IDE, or navigate with F12 on API methods and read/expand comments.</li>
</ul>
<blockquote>
<p>If you‚Äôre C# beginner, you should learn about <a href="https://learn.microsoft.com/en-us/dotnet/csharp/asynchronous-programming/">async programming</a>.</p>
</blockquote>
<h3 id="2-my-update-handler-fails-or-stops-executing-at-some-point"><a class="header" href="#2-my-update-handler-fails-or-stops-executing-at-some-point"><em>2. My update handler fails or stops executing at some point</em></a></h3>
<p>You likely have an exception somewhere. You should place a <code>try..catch</code> around your whole update handler.<br>Also, you should learn to <ins>use a debugger</ins> and go step-by-step through your code to understand where and why an exception is raised. See next question.</p>
<h3 id="3-apparently-my-update-handler-gets-a-nullreferenceexception"><a class="header" href="#3-apparently-my-update-handler-gets-a-nullreferenceexception"><em>3. Apparently my update handler gets a</em> <code>NullReferenceException</code></a></h3>
<p>Not all updates are about an incoming Message, so <code>update.Message</code> could be null. (see also <code>update.Type</code>)<br>Not all messages are text messages, <code>message.Text</code> could be null (see also <code>message.Type</code>). etc‚Ä¶<br>So please <ins>use a debugger</ins> to check the content of your variables or structure fields and make sure your code can handle all cases.</p>
<h3 id="4-how-to-add-buttons-under-a-message"><a class="header" href="#4-how-to-add-buttons-under-a-message"><em>4. How to add buttons under a message?</em></a></h3>
<p>Pass an <a href="#inline-keyboards">InlineKeyboardMarkup</a> into the <code>replyMarkup</code> parameter when sending the message. You will likely need to create a <code>List&lt;List&lt;InlineKeyboardButton&gt;&gt;</code> for rows&amp;columns<br><em>See also next question.</em></p>
<h3 id="5-how-to-handle-a-click-on-such-inline-buttons"><a class="header" href="#5-how-to-handle-a-click-on-such-inline-buttons"><em>5. How to handle a click on such inline buttons?</em></a></h3>
<p>For buttons with callback data, your update handler should handle <code>update.CallbackQuery</code>.
<em>(Remember that not all updates are about <code>update.Message</code>. See question #3)</em></p>
<p>Your code should answer to the query within 10 seconds, using <code>AnswerCallbackQuery</code> <em>(or else the button gets momentarily disabled)</em></p>
<h3 id="6-how-to-show-a-popup-text-to-the-user"><a class="header" href="#6-how-to-show-a-popup-text-to-the-user"><em>6. How to show a popup text to the user?</em></a></h3>
<p>It is only possible with inline callback button <em>(see above questions)</em>.<br>Use <code>AnswerCallbackQuery</code> with some text, and pass parameter <code>showAlert: true</code> to display the text as an alert box instead of a short popup.</p>
<h3 id="7-how-to-fill-the-input-textbox-of-the-user-with-some-text"><a class="header" href="#7-how-to-fill-the-input-textbox-of-the-user-with-some-text"><em>7. How to fill the input textbox of the user with some text?</em></a></h3>
<p>There is not a simple direct method for this, but here is what you can try:</p>
<ul>
<li>With a <a href="https://core.telegram.org/api/links#public-username-links">Public username link</a>: <code>t.me/username?text=Hello+World</code><br><em>(works only if target is a user/bot and not the current chat)</em></li>
<li>With a <a href="https://core.telegram.org/api/links#share-links">Share link</a>: <code>tg://msg_url?url=https://example.com&amp;text=Hello+World</code><br><em>(user must select a target first)</em></li>
<li>With a <a href="https://core.telegram.org/api/links#bot-links">Bot deep link</a>: <code>t.me/botusername?start=param</code><br><em>(param is limited to base64 characters, bot will receive <code>/start param</code>)</em></li>
<li>With a <a href="#custom-reply-keyboards">ReplyKeyboardMarkup</a>: buttons under the textbox to send pre-made texts</li>
<li>With an <a href="#inline-mode">Inline Mode bot</a> and <code>SwitchInlineQuery</code> inline buttons, you can make the user pre-type the name of your bot followed by some query</li>
</ul>
<h3 id="8-how-to-fetch-previous-messages"><a class="header" href="#8-how-to-fetch-previous-messages"><em>8. How to fetch previous messages?</em></a></h3>
<p>You can‚Äôt with Bot API but it‚Äôs possible with <a href="https://www.nuget.org/packages/WTelegramBot#readme-body-tab">WTelegramBot</a>.<br>Normally, bots only get messages at the moment they are posted. You could archive them all in a database for later retrieval.</p>
<h3 id="9-how-to-fetch-a-list-of-all-users-in-chat"><a class="header" href="#9-how-to-fetch-a-list-of-all-users-in-chat"><em>9. How to fetch a list of all users in chat?</em></a></h3>
<p>You can‚Äôt with Bot API but it‚Äôs possible with <a href="https://www.nuget.org/packages/WTelegramBot#readme-body-tab">WTelegramBot</a>.<br>Normally, bots can only get the list of admins (<code>GetChatAdministrators</code>) or detail about one specific member (<code>GetChatMember</code>)<br>Alternatively, you can keep track of users by observing new messages in a chat and saving user info into a database.</p>
<h3 id="10-how-to-send-a-private-message-to-some-random-user"><a class="header" href="#10-how-to-send-a-private-message-to-some-random-user"><em>10. How to send a private message to some random user?</em></a></h3>
<p>You can‚Äôt. Bots can only send private messages to users that have already initiated a private chat with your bot.</p>
<h3 id="11-how-to-detect-if-a-user-blocked-my-bot"><a class="header" href="#11-how-to-detect-if-a-user-blocked-my-bot"><em>11. How to detect if a user blocked my bot?</em></a></h3>
<p>You would have received an <code>update.MyChatMember</code> with <code>NewChatMember.Status == ChatMemberStatus.Kicked</code><br>If you didn‚Äôt record that info, you can try to <code>SendChatAction</code> and see if it raises an exception.</p>
<h3 id="12-how-to-set-a-caption-and-replymarkup-to-a-media-group-album"><a class="header" href="#12-how-to-set-a-caption-and-replymarkup-to-a-media-group-album"><em>12. How to set a caption and ReplyMarkup to a media group (album)?</em></a></h3>
<p>Set the <code>media.Caption</code> (and <code>media.ParseMode</code>) on the first or last media</p>
<p>Media groups can‚Äôt have Reply Markup unfortunately.</p>
<h3 id="13-how-to-write-a-bot-that-make-questionsanswers-with-users"><a class="header" href="#13-how-to-write-a-bot-that-make-questionsanswers-with-users"><em>13. How to write a bot that make questions/answers with users?</em></a></h3>
<p>Either you can code a complex state machine workflow, saving where each user is currently in the discussion tree.<br>Or you can just use <a href="https://github.com/wiz0u/YourEasyBot">YourEasyBot</a> which makes sequential bots very simple to write‚Ä¶ <em>(or one of the <a href="https://github.com/TelegramBots/Telegram.Bot/wiki">other frameworks</a> available for Telegram.Bot)</em></p>
<h3 id="14-how-to-make-font-effects-in-message"><a class="header" href="#14-how-to-make-font-effects-in-message"><em>14. How to make font effects in message?</em></a></h3>
<p>Pass a <code>ParseMode.Html</code> <em>(or <code>ParseMode.MarkDownV2</code>)</em> to argument <code>parseMode</code>. See <a href="https://core.telegram.org/bots/api#formatting-options">formatting options</a>.<br>‚ö†Ô∏è I <ins><strong>highly recommend</strong></ins> you choose HTML formatting because MarkDownV2 has A LOT of annoyingly reserved characters and you will regret it later.</p>
<h3 id="15-where-can-i-host-my-bot-online-for-cheapfree"><a class="header" href="#15-where-can-i-host-my-bot-online-for-cheapfree"><em>15. Where can I host my bot online for cheap/free?</em></a></h3>
<p>I would recommend you make an ASP.NET webhook bot and host it on some WebApp hosting service.<br>For example, <a href="https://azure.microsoft.com/products/app-service/web">Azure WebApp Service</a> has a <a href="https://azure.microsoft.com/pricing/details/app-service/windows/">F1 Free plan</a> including 1 GB disk, 1 GB ram, 60 minutes of daily cumulated active CPU usage <em>(more than enough for most bots without heavy use)</em>. And publishing to Azure is very easy from VS.<br>A credit-card is necessary but you shouldn‚Äôt get charged if you stay within quotas.<br>Other cloud providers might also offer similar services.</p>
<h3 id="16-is-there-some-limitationmaximum-about-feature-x"><a class="header" href="#16-is-there-some-limitationmaximum-about-feature-x"><em>16. Is there some limitation/maximum about feature X?</em></a></h3>
<p>See <a href="https://limits.tginfo.me">https://limits.tginfo.me</a> for a list of limitations.</p>
<h3 id="17-how-to-populate-the-bot-menu-button--commands-list"><a class="header" href="#17-how-to-populate-the-bot-menu-button--commands-list"><em>17. How to populate the bot Menu button / commands list?</em></a></h3>
<p>You can either do this via <a href="https://t.me/BotFather">@BotFather</a> <em>(static entries)</em>, or you can use <code>SetMyCommands</code> for more advanced settings<br>‚ö†Ô∏è This menu can only be filled with bot commands, starting with a <code>/</code> and containing only latin characters <code>a-z_0-9</code></p>
<h3 id="18-how-to-receive-chatmember-updates"><a class="header" href="#18-how-to-receive-chatmember-updates"><em>18. How to receive <code>ChatMember</code> updates?</em></a></h3>
<p>You should specify all update types <strong>including ChatMember</strong> in <code>AllowedUpdates</code> array on <code>StartReceiving</code>:<code>ReceiverOptions</code> or <code>SetWebhook</code><br><a href="#detecting-new-group-members-and-changed-member-status">More details here</a></p>
<h3 id="19-how-to-get-rid-of-past-updates-when-i-restart-my-bot"><a class="header" href="#19-how-to-get-rid-of-past-updates-when-i-restart-my-bot"><em>19. How to get rid of past updates when I restart my bot?</em></a></h3>
<p>Pass true into <code>StartReceiving</code>:<code>ReceiverOptions</code>:<code>DropPendingUpdates</code> or <code>SetWebhook</code>:<code>dropPendingUpdates</code>
Alternatively, you can call <code>await bot.DropPendingUpdates()</code> before polling or using <a href="#by-setting-botonupdate-andor-botonmessage"><code>bot.OnUpdate</code></a>.</p>
<h3 id="20-difficulties-to-upload--send-a-filemedia"><a class="header" href="#20-difficulties-to-upload--send-a-filemedia"><em>20. Difficulties to upload &amp; send a file/media?</em></a></h3>
<ul>
<li>Make sure you <code>await</code> until the end of the send method before closing the file (a ‚Äú<code>using</code>‚Äù clause would close the file on leaving the current { scope }</li>
<li>If you just filled a <code>MemoryStream</code>, make sure to rewind it to the beginning with <code>ms.Position = 0;</code> before sending</li>
<li>If you send a media group, make sure you specify different filenames on <code>InputFile.FromStream</code></li>
</ul>
<h3 id="21-how-to-fetch-all-medias-from-an-albummedia-group-"><a class="header" href="#21-how-to-fetch-all-medias-from-an-albummedia-group-"><em>21. How to fetch all medias from an album/media group ?</em></a></h3>
<p>When receiving a media group, you need to collect the series of separate messages in a chat having the same <code>MediaGroupId</code> property.<br>There is no way to know how many medias/messages the album is composed of.
<a href="#receiving-a-media-group-album">Read more here</a></p>
<h3 id="22-how-to-send-a-custom-emoji"><a class="header" href="#22-how-to-send-a-custom-emoji"><em>22. How to send a custom emoji‚ùì</em></a></h3>
<p>There are 3 solutions for a bot to send custom emojis:</p>
<ol>
<li>If the bot owner has Telegram Premium, the bot can send custom emojis in private and in groups</li>
<li>To send custom emojis anywhere, you need to buy a username on <a href="https://fragment.com/">Fragment</a>, and assign it to your bot <em>(via an <a href="https://fragment.com/about#assigning-collectible-usernames-to-telegram">additional upgrade fee</a> of 1K TON, <a href="https://www.google.com/search?q=1000+TON+to+USD">~$2,000</a>)</em></li>
<li>To send custom emojis in a specific group, you can also have premium members boost your group to level 4. You can then assign a custom emoji pack to your group that your members AND bots can use freely in group messages.</li>
</ol>
<p>To write custom emojis in your bot message, use <a href="https://core.telegram.org/bots/api#html-style">specific HTML</a> or <a href="https://core.telegram.org/bots/api#markdownv2-style">Markdown</a> syntax <em>(or entity)</em>.</p>
<h3 id="23-how-to-change-buttontext-color-or-background"><a class="header" href="#23-how-to-change-buttontext-color-or-background"><em>23. How to change button/text color or background?</em></a></h3>
<p>It‚Äôs not possible to change the colors of text. Only links and code monospace may appear differently depending on the client.<br>You can however use one of 3 colors for buttons by changing the Style property during construction: <code>new InlineKeyboardButton("Green button", "dataOrUrl") { Style = KeyboardButtonStyle.Success }</code></p>
<h3 id="24-can-i-use-several-appsinstance-to-manage-my-bot"><a class="header" href="#24-can-i-use-several-appsinstance-to-manage-my-bot"><em>24. Can I use several apps/instance to manage my bot?</em></a></h3>
<p>You can call API methods (like sending messages) from several instances in parallel<br><strong>BUT</strong> only one instance can call method GetUpdates (or else you will receive <em>Telegram API Error 409: Conflict: terminated by other getUpdates request</em>)</p>
<p>To process the updates in parallel, read <a href="3/updates#sequential-vs-parallel-updates">this section of our documentation</a>.</p>
<h3 id="25-how-do-i-get-the-user-id-from-a-username"><a class="header" href="#25-how-do-i-get-the-user-id-from-a-username"><em>25. How do I get the user id from a username?</em></a></h3>
<p>You can‚Äôt with Bot API but it‚Äôs possible with <a href="https://www.nuget.org/packages/WTelegramBot#readme-body-tab">WTelegramBot</a>.<br>Alternatively, you could store in database the mapping of <code>UserId</code>&lt;-&gt;<code>Username</code>.<br>Remember that not every user has a username, and it can be changed.<br>Also, your bot still won‚Äôt be able to contact a user first.</p>
<h3 id="26-how-to-receive-messages-from-channels"><a class="header" href="#26-how-to-receive-messages-from-channels"><em>26. How to receive messages from channels?</em></a></h3>
<p>Your bot has to be added as administrator of the channel.
You will then receive the messages as <code>update.ChannelPost</code> or <code>update.EditedChannelPost</code>.</p>
<h3 id="27-how-to-send-the-same-media-multiple-times"><a class="header" href="#27-how-to-send-the-same-media-multiple-times"><em>27. How to send the same media multiple times</em></a></h3>
<p>The first time, you will send the media with a stream (upload). Next times, you will use its <strong>FileId</strong>:</p>
<pre><code class="language-csharp">var msg = await bot.SendVideo(chatId, stream, ....);
var fileId = msg.Video.FileId

// next times:
await bot.SendVideo(chatId2, fileId, ...);
</code></pre>
<p>For photos, use <code>msg.Photo[^1].FileId</code></p>
<h3 id="this-faq-doesnt-have-my-question-on-it"><a class="header" href="#this-faq-doesnt-have-my-question-on-it">This FAQ doesn‚Äôt have my question on it</a></h3>
<p>Feel free to <a href="https://t.me/joinchat/B35YY0QbLfd034CFnvCtCA">join our Telegram group</a> and ask your question there</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="migration-guides-to-newer-versions-of-the-library"><a class="header" href="#migration-guides-to-newer-versions-of-the-library">Migration guides to newer versions of the library</a></h1>
<ul>
<li><a href="#migration-guide-for-version-22x">Migrate to v22.*</a></li>
<li><a href="#migration-guide-for-version-21x">Migrate to v21.*</a></li>
<li><a href="#migration-guide-for-version-190">Migrate to v19.*</a></li>
<li><a href="#migration-guide-for-version-180">Migrate to v18.*</a></li>
<li><a href="#migration-guide-for-version-170">Migrate to v17.*</a></li>
<li><a href="#migration-guide-for-version-14x">Migrate to v14.*</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="migration-guide-for-version-22x"><a class="header" href="#migration-guide-for-version-22x">Migration guide for version 22.x</a></h1>
<p>If you‚Äôre migrating from version 19.x, you might want to read our <a href="#migration-guide-for-version-21x">migration doc for v21</a> first.
There were lots of interesting changes in versions v21.x.</p>
<p>We are back on <a href="https://www.nuget.org/packages/Telegram.Bot/#versions-body-tab">Nuget.org</a>!<br><em>And our old nuget feed nuget.voids.site is no more, so please remove this line from your nuget.config file, or from your IDE settings (Package sources)</em></p>
<h2 id="-breaking-changes"><a class="header" href="#-breaking-changes">‚ö†Ô∏è Breaking changes</a></h2>
<p>We removed the <code>Async</code> suffix from our API method names, and renamed <code>SendTextMessageAsync</code> to <code>SendMessage</code>.<br>This was done to match <a href="https://core.telegram.org/bots/api#available-methods">official API documentation</a> and because all our TelegramBotClient methods are asynchronous <em>(no real need to differenciate between async or non-async methods)</em></p>
<p>We also reordered a few optional parameters to move away the lesser used arguments later down the argument list (typically: <code>message_thread_id</code>/<code>entities</code>)
and move the more useful arguments up closer to the beginning (typically: <code>replyParameters</code>/<code>replyMarkup</code>)<br>This should make your life simpler as you won‚Äôt need to resort to <a href="https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/named-and-optional-arguments#named-arguments">named arguments</a> for the most commonly used method parameters.</p>
<p>Finally, we renamed property <code>Message.MessageId</code> as just <code>Message.Id</code>. <em>(but MessageId will remain supported)</em></p>
<blockquote class="blockquote-tag blockquote-tag-note">
<p class="blockquote-tag-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p>
<p><strong>All the previous names are still supported at the moment</strong>, so your code should just run fine with version 22.0, except you will get warnings about ‚ÄúObsolete‚Äù code while compiling.</p>
</blockquote>
<h2 id="-how-to-adapt-your-code-for-these-changes"><a class="header" href="#-how-to-adapt-your-code-for-these-changes">üìù How to adapt your code for these changes</a></h2>
<p>In order to port your code easily and get rid of compiler warnings, I suggest you use these 4 <strong>Find and Replace</strong> operations in your IDE</p>
<p>So start by opening the Edit &gt; <strong>Find and Replace</strong> &gt; <strong>Replace in Files</strong> panel (Ctrl+Shift+H)<br>Untick the checkboxes: <strong>Match case</strong> and <strong>Match whole word</strong><br>Tick the checkbox: <strong>‚úì Use regular expressions</strong><br>Select the scope to look in: <strong>Current project</strong> or <strong>Entire solution</strong></p>
<p>(In the following, we suppose your TelegramBotClient variable is named <code>bot</code>, please modify the expressions if necessary)</p>
<ol>
<li>
<p>To remove explicit <strong>null</strong> arguments for messageThreadId/entities<br><em>Replace:</em> <code>(bot\.Send\w+Async\b.*,) null,</code><br>¬†¬†¬†¬†<em>With:</em> <code>$1</code><br>üñ±Ô∏èClick on <strong>Replace All</strong><br>üñ±Ô∏èClick on <strong>Replace All</strong> again</p>
</li>
<li>
<p>To rename <strong>SendTextMessageAsync</strong> with <strong>SendMessage</strong><br><em>Replace:</em> <code>\.SendTextMessageAsync\b</code><br>¬†¬†¬†¬†<em>With:</em> <code>.SendMessage</code><br>üñ±Ô∏èClick on <strong>Replace All</strong></p>
</li>
<li>
<p>To remove the <strong>Async</strong> suffixes:<br><em>Replace:</em> <code>(bot\.\w+)Async\b</code><br>¬†¬†¬†¬†<em>With:</em> <code>$1</code><br>üñ±Ô∏èClick on <strong>Replace All</strong></p>
</li>
<li>
<p>To rename the <strong>MessageId</strong> property:<br><em>Replace:</em> <code>(message)\.MessageId\b</code><br>¬†¬†¬†¬†<em>With:</em> <code>$1.Id</code><br>üñ±Ô∏èClick on <strong>Replace All</strong><br><em>(Depending on your variable naming convention, you might want to repeat that, replacing <code>(message)</code> with <code>(msg)</code> or something else)</em></p>
</li>
</ol>
<p>The remaining effort to make your code compile should now be much reduced.<br><em>(maybe a few more parameter reordering if you didn‚Äôt use named parameters)</em></p>
<p><strong>Addendum:</strong> we also renamed method <code>MakeRequest</code>Async to <code>SendRequest</code>
<em>(if you use this <a href="#request-structures">non-recommended</a> method)</em></p>
<h2 id="whats-new-in-version-220"><a class="header" href="#whats-new-in-version-220">What‚Äôs new in version 22.0</a></h2>
<ul>
<li>Support for <a href="https://core.telegram.org/bots/api#october-31-2024">Bot API 7.11</a></li>
<li>Implicit conversions for single-field structures<br>For example classes containing just one string (like BotDescription, WebAppInfo or CopyTextButton) can be handled just as a string</li>
<li>Implicit conversion from FileBase classes to InputFile<br>This means you can pass an object like a <code>Video</code> or <code>PhotoSize</code> directly as argument
to a Send method and it will use its FileId</li>
<li>Helper method <code>GetFileIdType</code><br>It can tell you which type of object/media is referenced by a FileId string</li>
<li>Huge rewrite of our serialization code to make it more performant and straightforward.</li>
<li>Updated System.Text.Json due to vulnerability <a href="https://github.com/advisories/GHSA-8g4q-xg66-9fp4">CVE-2024-43485</a></li>
</ul>
<h2 id="whats-new-in-version-221"><a class="header" href="#whats-new-in-version-221">What‚Äôs new in version 22.1</a></h2>
<ul>
<li>Support for <a href="https://core.telegram.org/bots/api-changelog#november-17-2024">Bot API 8.0</a></li>
<li>new helper <code>message.MessageLink()</code> to get the <u>t.me</u> link to that message (Supergroup and Channel only)</li>
<li><code>ToHtml</code>/<code>ToMarkdown</code>: support for ExpandableBlockquote <em>(v22.1.1)</em></li>
<li>fix savePreparedInlineMessage request <em>(v22.1.2)</em></li>
<li><code>TransactionPartnerUser.Gift</code> type was corrected in Bot API <em>(v22.1.3)</em></li>
</ul>
<h2 id="whats-new-in-version-222"><a class="header" href="#whats-new-in-version-222">What‚Äôs new in version 22.2</a></h2>
<ul>
<li>Support for <a href="https://core.telegram.org/bots/api-changelog#december-4-2024">Bot API 8.1</a></li>
<li>Support for <a href="https://learn.microsoft.com/en-us/dotnet/core/deploying/native-aot">Native AOT</a> / <a href="https://learn.microsoft.com/en-us/aspnet/core/blazor/webassembly-build-tools-and-aot">Blazor</a> / <a href="https://learn.microsoft.com/en-us/dotnet/core/deploying/trimming/trim-self-contained">Trimming</a><br><em>(this is still experimental and we would enjoy your feedback if you try to use the library in such contexts)</em></li>
</ul>
<h2 id="whats-new-in-version-223"><a class="header" href="#whats-new-in-version-223">What‚Äôs new in version 22.3</a></h2>
<ul>
<li>Support for <a href="https://core.telegram.org/bots/api#january-1-2025">Bot API 8.2</a></li>
<li>Renamed class <code>Telegram.Bot.Types.File</code> as <code>TGFile</code><br><em>(the name <code>File</code> was annoyingly conflicting with the often-used <code>System.IO.File</code> class)</em></li>
<li>Added property <code>Token</code> to <code>TelegramBotClient</code><br><em>(you can use it to <code>ParseValidateData</code> MiniApp requests, authenticate WebHook updates, ‚Ä¶)</em></li>
</ul>
<h2 id="whats-new-in-version-224"><a class="header" href="#whats-new-in-version-224">What‚Äôs new in version 22.4</a></h2>
<ul>
<li>Support for <a href="https://core.telegram.org/bots/api#february-12-2025">Bot API 8.3</a></li>
<li>Added helpers <code>ChatMember.IsInChat</code> and <code>ChatMember.IsAdmin</code></li>
<li>Added constructor <code>ChatPermissions(bool)</code> to set all fields to <strong>true</strong> or <strong>false</strong></li>
<li>Fix a potential issue in <code>.ToHtml()</code> escaping <code>&amp;</code> in URLs</li>
<li>Renamed helper classes <code>Emoji</code> to <code>DiceEmoji</code> and <code>KnownReactionTypeEmoji</code> to <code>ReactionEmoji</code></li>
<li>Changed <code>IReplyMarkup</code> to abstract class <code>ReplyMarkup</code> so you can directly pass <a href="#reply-markup">text, button or arrays of buttons</a> for the <code>replyMarkup:</code> parameter</li>
<li><code>BotCommand</code> can also now be implicitly constructed from a <code>(string command, string description)</code> tuple or new explicit constructor <em>(v22.4.3)</em><br>Example: <code>await Bot.SetMyCommands([("/start", "Start the bot"), ("/privacy", "Privacy policy")]);</code></li>
<li>Added helper <code>DownloadFile(TGFile file, ...)</code> <em>(v22.4.4)</em></li>
</ul>
<h2 id="whats-new-in-version-225"><a class="header" href="#whats-new-in-version-225">What‚Äôs new in version 22.5</a></h2>
<ul>
<li>Support for <a href="https://core.telegram.org/bots/api#april-11-2025">Bot API 9.0</a></li>
<li>Removed the <code>*Async</code>-suffixed versions of the methods that were marked [Obsolete] since v22.0.<br>‚Üí Follow the steps at the top of this page to adapt your existing code if you haven‚Äôt already.</li>
<li><code>Services.ConfigureTelegramBot*</code> is <strong>no longer necessary</strong> to make your Webhook bot compatible with Telegram updates!<br>‚Üí We‚Äôve made the library structures compatible with the default JsonCamelCaseNamingPolicy used by ASP.NET Core projects.<br>In some rare cases <em>(like <a href="https://learn.microsoft.com/en-us/dotnet/core/deploying/native-aot">Native AOT</a> / <a href="https://learn.microsoft.com/en-us/aspnet/core/blazor/webassembly-build-tools-and-aot">Blazor</a> / <a href="https://learn.microsoft.com/en-us/dotnet/core/deploying/trimming/trim-self-contained">Trimming</a>)</em>, this call might still be necessary.</li>
<li>Removed dependency on ASP.NET Core (Microsoft.AspNetCore.App) from the main library, by moving the <code>ConfigureTelegramBotMvc()</code> method to a separate package <a href="https://github.com/TelegramBots/Telegram.Bot.AspNetCore">Telegram.Bot.AspNetCore</a><br>‚Üí That dependency caused some issues for users deploying to Docker / Android / WebAssembly<br>‚Üí As explained above, you shouldn‚Äôt need this method anymore in most cases, but if you do, you can add the <a href="https://www.nuget.org/packages/Telegram.Bot.AspNetCore">nuget package Telegram.Bot.AspNetCore</a> to your project</li>
<li>Merged the Telegram.Bot.Extensions.Passport package into the main library<br>‚Üí It was old and unmaintained, but now its methods and structures supporting <a href="https://core.telegram.org/passport#personaldetails">Telegram Passport</a> are up-to-date and available directly in Telegram.Bot</li>
<li>New <code>HtmlText</code> helpers method: <code>ToPlain</code>, <code>PlainLength</code> and <code>Truncate</code> to get
the plain text only from HTML text <em>(remove the &lt;tags&gt;)</em>, the number of plain text characters, or truncate the HTML to a number of plain text characters <em>(useful to comply with the 4096/1024 message limit)</em></li>
<li>Added constructor <code>ChatAdministratorRights(bool)</code> to set all fields to <strong>true</strong> or <strong>false</strong> (except IsAnonymous)</li>
<li>Added helper property <code>message.IsServiceMessage</code> to detect service messages vs content messages</li>
<li>Added helper property <code>ChatMemberRestricted.IsMuted</code> to detect if restriction is muting the user <em>(v22.5.1)</em></li>
</ul>
<p>Builds &amp; Releases:</p>
<ul>
<li>Dropped Azure DevOps builds in favor of GitHub Actions<br>‚Üí Our <a href="https://dev.azure.com/tgbots/Telegram.Bot/_artifacts/feed/release">alternative nuget feed</a> will no longer be updated since we are <a href="https://www.nuget.org/packages/Telegram.Bot/#versions-body-tab">back on Nuget.org</a></li>
<li>‚ÄúPrerelease‚Äù versions are now pushed to Nuget.org as the library is developed, for people who want to test upcoming features early<br>‚Üí You can provide feedback on these versions and help us detect problems before the next stable release</li>
<li>Now including <strong>Release Notes</strong> as part of Nuget packages<br>‚Üí You can see them on <a href="https://www.nuget.org/packages/Telegram.Bot/#releasenotes-body-tab">nuget.org package page</a>, or in your IDE‚Äôs Package Manager, on the Package Detail pane where you select a version.</li>
</ul>
<p>2 small breaking changes:</p>
<ul>
<li>Merged <code>AnswerShippingQuery</code> method overloads. You‚Äôll need to add <code>errorMessage:</code> in your code to pass that argument and indicate failure.</li>
<li>The <code>Poll.Type</code> is now an enum <code>PollType</code> instead of <code>string</code></li>
</ul>
<h2 id="whats-new-in-version-226"><a class="header" href="#whats-new-in-version-226">What‚Äôs new in version 22.6</a></h2>
<ul>
<li>Support for <a href="https://core.telegram.org/bots/api#july-3-2025">Bot API 9.1</a></li>
<li><code>ReplyParameters(Message)</code> supports null</li>
<li>Fix <code>MessageLink()</code> for non-topics group</li>
<li><code>TransferGift</code>: fix type for newOwnerChatId</li>
<li>Sealed some internal types for performance</li>
<li>faster <code>IsServiceMessage</code></li>
</ul>
<h2 id="whats-new-in-version-2262"><a class="header" href="#whats-new-in-version-2262">What‚Äôs new in version 22.6.2</a></h2>
<ul>
<li>Support for <a href="https://core.telegram.org/bots/api-changelog#august-15-2025">Bot API 9.2</a></li>
<li>Added <code>ChatMember.ExpireDate</code> helper (= generic <code>UntilDate</code>)</li>
<li>implicit <code>InputFile(string)</code> <code>InputFileId(string)</code> now allows <code>null</code> string (and return null)</li>
</ul>
<h2 id="whats-new-in-version-227"><a class="header" href="#whats-new-in-version-227">What‚Äôs new in version 22.7</a></h2>
<ul>
<li><strong>New all-in-one helper method <code>SendHtml</code></strong> (which supports <code>&lt;img&gt; &lt;video&gt; &lt;file&gt; &lt;preview&gt; &lt;keyboard&gt;</code> tags)<br>üëâ see <a href="#sendhtml-helper-method">SendHtml documentation</a> for more details</li>
<li>Changed type <code>int</code> -&gt; <code>long</code> for fields <code>TopicId</code>, <code>StarCount</code>, <code>Amount</code></li>
<li>Changed <code>messageThreadId</code> arg position on <code>SendPaidMedia</code></li>
</ul>
<h2 id="whats-new-in-version-2273"><a class="header" href="#whats-new-in-version-2273">What‚Äôs new in version 22.7.3</a></h2>
<ul>
<li>Implicit <code>LinkPreviewOptions</code> from an URL string</li>
<li>Implicit conversion from <code>List&lt;&gt;</code> and <code>List&lt;List&lt;&gt;&gt;</code> to reply markup</li>
<li>Fix <strong>SendHtml</strong> with <code>switch_inline="query"</code> buttons</li>
<li>Fix <strong>EditMessageText/Caption</strong> optional arg order (similar to Send methods)</li>
<li>Clarify polling methods descriptions.</li>
<li>Removed IUpdateReceiver/DefaultUpdateReceiver classes (loop code moved directly into Polling)</li>
<li>Obsoleted AsyncEnumerableReceivers</li>
</ul>
<h2 id="whats-new-in-version-2274"><a class="header" href="#whats-new-in-version-2274">What‚Äôs new in version 22.7.4</a></h2>
<ul>
<li>Added <code>ReplyMarkup.RemoveKeyboard</code>/<code>ForceReply</code></li>
<li>Implicit <code>ReplyMarkup</code> conversion for (text, callback/url) tuple(s)</li>
</ul>
<h2 id="whats-new-in-version-2276"><a class="header" href="#whats-new-in-version-2276">What‚Äôs new in version 22.7.6</a></h2>
<ul>
<li><code>SendHtml</code> now returns <code>Message[]</code></li>
<li>Support <code>&amp;amp;</code> <code>&amp;lt;</code> <code>&amp;gt;</code> <code>&amp;quot;</code> in SendHtml and HtmlText.Escape</li>
<li>Also generating <code>&amp;quot;</code> in msg.ToHtml()</li>
<li>Fix ChatId operator <code>==</code> : <strong>true</strong> if both chatId are null, <strong>true</strong> for different casing username (@‚Äçchannel == @‚ÄçCHANNEL)</li>
<li>Override ToString for <code>InputFile*</code> classes : FileId, Url, ‚Äústream://..‚Äù</li>
<li>Added ApiResponse to JsonBotSerializerContext (trimmed apps)</li>
</ul>
<h2 id="whats-new-in-version-228"><a class="header" href="#whats-new-in-version-228">What‚Äôs new in version 22.8</a></h2>
<ul>
<li>Support for <a href="https://core.telegram.org/bots/api#december-31-2025">Bot API 9.3</a></li>
<li>Helper methods <code>EditHtml</code>/<code>EditHtmlInline</code> to edit message and media group via an HTML string</li>
<li><code>HtmlText.Truncate</code> helpers ignores invalid &amp; sequences</li>
<li>Removed AsyncEnumerableReceivers classes</li>
</ul>
<h2 id="whats-new-in-version-229"><a class="header" href="#whats-new-in-version-229">What‚Äôs new in version 22.9</a></h2>
<ul>
<li>Support for <a href="https://core.telegram.org/bots/api-changelog#february-9-2026">Bot API 9.4</a></li>
<li>Implicit construction of <code>ChatId</code> from <code>User</code></li>
<li>fix type (int -&gt; long) for <code>Rating</code> &amp; <code>Amount</code> fields</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="migration-guide-for-version-21x"><a class="header" href="#migration-guide-for-version-21x">Migration guide for version 21.x</a></h1>
<p>Important notes:</p>
<ul>
<li>Don‚Äôt bother about version 20, migrate directly to version 21.*</li>
<li>You won‚Äôt find this version on Nuget: It was available <a href="https://dev.azure.com/tgbots/Telegram.Bot/_artifacts/feed/release/NuGet/Telegram.Bot">on our own nuget package feed</a>.</li>
<li>Version 21.10 supports <a href="https://core.telegram.org/bots/api#august-14-2024">Bot API 7.9</a> <em>(including <a href="#bot-payments-api--telegram-stars">Telegram Stars payments</a>)</em></li>
<li>Library is now based on System.Text.Json and doesn‚Äôt depend on NewtonsoftJson anymore. <em>(<a href="#webhooks-with-systemtextjson">See below</a>)</em></li>
</ul>
<h2 id="renamed-parameter-replytomessageid--replyparameters"><a class="header" href="#renamed-parameter-replytomessageid--replyparameters">Renamed parameter <em>replyToMessageId:</em> ‚Üí <em>replyParameters:</em></a></h2>
<p>That parameter was renamed and you can still pass a <strong>messageId</strong> for simple replies.</p>
<p>Or you can pass a <a href="https://core.telegram.org/bots/api#replyparameters">ReplyParameters</a> structure for more advanced reply configuration.</p>
<h2 id="renamed-parameter-disablewebpagepreview--linkpreviewoptions"><a class="header" href="#renamed-parameter-disablewebpagepreview--linkpreviewoptions">Renamed parameter <em>disableWebPagePreview:</em> ‚Üí <em>linkPreviewOptions:</em></a></h2>
<p>That parameter was renamed and you can still pass <code>true</code> to disable web preview.</p>
<p>Or you can pass a <a href="https://core.telegram.org/bots/api#linkpreviewoptions">LinkPreviewOptions</a> structure for more precise preview configuration.</p>
<h2 id="changed-bool--bool"><a class="header" href="#changed-bool--bool">Changed <code>bool?</code> ‚Üí <code>bool</code></a></h2>
<p>Many boolean parameters or fields are now simply of type <code>bool</code>.</p>
<p>In most cases, it shouldn‚Äôt impact your existing code, or rather simplify it. Previously <code>null</code> values are now just <code>false</code>.</p>
<h2 id="changed-parsemode--parsemode"><a class="header" href="#changed-parsemode--parsemode">Changed <code>ParseMode?</code> ‚Üí <code>ParseMode</code></a></h2>
<p>When you don‚Äôt need to specify a ParseMode, just pass <code>default</code> or <code>ParseMode.None</code>.</p>
<h2 id="better-backward-compatibility-and-simplification-of-code"><a class="header" href="#better-backward-compatibility-and-simplification-of-code">Better backward-compatibility and simplification of code</a></h2>
<p>We added/restored features &amp; implicit conversions that make your code simpler:</p>
<ul>
<li><code>InputFile</code>: just pass a <code>string</code>/<code>Stream</code> for file_id/url/stream content <em>(as was possible in previous versions of Telegram.Bot)</em></li>
<li><code>InputMedia*</code>: just pass an <code>InputFile</code> when you don‚Äôt need to associate caption or such</li>
<li><code>MessageId</code>: auto-converts to/from <code>int</code> (and also from <code>Message</code>)</li>
<li><code>ReactionType</code>: just pass a <code>string</code> when you want to send an emoji</li>
<li><code>ReactionType</code>: just pass a <code>long</code> when you want to send a custom emoji (id)</li>
<li>Some other obvious implicit conversion operators for structures containing a single property</li>
<li>No more enforcing <code>init;</code> properties, so you can adjust the content of fields as you wish or modify a structure returned by the API <em>(before passing it back to the API if you want)</em></li>
<li>No more JSON ‚Äúrequired properties‚Äù during deserialization, so your old saved JSON files won‚Äôt break if a field is added/renamed.</li>
<li>Restored some <code>MessageType</code> enum values that were removed (renamed) recently (easier compatibility)</li>
</ul>
<h2 id="maybeinaccessiblemessage"><a class="header" href="#maybeinaccessiblemessage">MaybeInaccessibleMessage</a></h2>
<p>This class hierarchy was introduced in Bot API 7.0 and broke existing code and added unnecessary complexity.</p>
<p>This was removed in our library v21 and you will just receive directly a Message <em>(as before)</em>.</p>
<p>To identify an ‚Äúinaccessible message‚Äù, you can just check <code>message.Type == MessageType.Unknown</code> or <code>message.Date == default</code>.</p>
<h2 id="chat-and-chatfullinfo"><a class="header" href="#chat-and-chatfullinfo">Chat and ChatFullInfo</a></h2>
<p>In previous versions, the big <code>Chat</code> structure contained many fields that were filled only after a call to GetChatAsync.</p>
<p>This structure is now split into <code>Chat</code> and <code>ChatFullInfo</code> structures.</p>
<p>The new <code>Chat</code> structure contains only common fields that are always filled.
The new <code>ChatFullInfo</code> structure inherits from <code>Chat</code> and is returned only by GetChatAsync method, with all the extra fields.</p>
<h2 id="request-structures"><a class="header" href="#request-structures">Request structures</a></h2>
<p>Request structures <em>(types ending with <code>Request</code>)</em> are NOT the recommended way to use the library in your projects.</p>
<p>They are to be considered as low-level raw access to Bot API structures for advanced programmers, and might change/break at any time in the future.</p>
<p>If you have existing code using them, you can use the <code>MakeRequestAsync</code> method to send those requests.
<em>(Other methods based on those requests will be removed soon)</em></p>
<h2 id="payments-with-telegram-stars"><a class="header" href="#payments-with-telegram-stars">Payments with <a href="https://t.me/BotNews/90">Telegram Stars</a></a></h2>
<p>To make a <a href="#bot-payments-api--telegram-stars">payment in Telegram Stars</a> with SendInvoiceAsync, set the following parameters:</p>
<ul>
<li><code>providerToken:</code> <code>null</code> or <code>""</code></li>
<li><code>currency:</code> <code>"XTR"</code></li>
<li><code>prices:</code> with a single price</li>
<li>no tip amounts</li>
</ul>
<h2 id="webhooks-with-systemtextjson"><a class="header" href="#webhooks-with-systemtextjson">Webhooks with System.Text.Json</a></h2>
<p>The library now uses <code>System.Text.Json</code> instead of <code>NewtonsoftJson</code>.</p>
<p>To make it work in your ASP.NET projects, you should now:</p>
<ul>
<li>Remove package <strong>Microsoft.AspNetCore.Mvc.NewtonsoftJson</strong> from your project dependencies</li>
<li>Follow our <a href="#webhooks">Webhook page</a> to configure your web app correctly</li>
</ul>
<p><em>Note: When deploying a .NET 6+ build via Docker, this introduced a dependency on ASP.NET Core.
See <a href="https://github.com/TelegramBots/Telegram.Bot/issues/1432">this issue</a> for methods to update your Dockerfile</em></p>
<h2 id="inputpolloption-in-sendpollasync"><a class="header" href="#inputpolloption-in-sendpollasync">InputPollOption in SendPollAsync</a></h2>
<p>SendPollAsync now expect an array of InputPollOption instead of string.</p>
<p>But we added an implicit conversion from string to InputPollOption, so the change is minimal:</p>
<pre><code class="language-csharp">// before:
await bot.SendPollAsync(chatId, "question", new[] { "answer1", "answer2" });
// after:
await bot.SendPollAsync(chatId, "question", new InputPollOption[] { "answer1", "answer2" });
</code></pre>
<h2 id="global-cancellation-token-v212"><a class="header" href="#global-cancellation-token-v212">Global cancellation token (v21.2)</a></h2>
<p>You can now specify a global <code>CancellationToken</code> directly in TelegramBotClient constructor.</p>
<p>This way, you won‚Äôt need to pass a cancellationToken to every method call after that
(if you just need one single cancellation token for stopping your bot)</p>
<h2 id="polling-system-now-catch-exceptions-in-your-handleupdate-code-v213"><a class="header" href="#polling-system-now-catch-exceptions-in-your-handleupdate-code-v213">Polling system now catch exceptions in your HandleUpdate code (v21.3)</a></h2>
<blockquote class="blockquote-tag blockquote-tag-warning">
<p class="blockquote-tag-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>Warning</p>
<p>That‚Äôs a change of behaviour, but most of you will probably welcome this change</p>
</blockquote>
<p>If you forgot to wrap your HandleUpdateAsync code in a big <code>try..catch</code>, and your code happen to throw an exception,
this would previously stop the polling completely.</p>
<p>Now the Polling system will catch your exceptions, pass them to your HandleErrorAsync method
<strong>and continue the polling</strong>.</p>
<blockquote>
<p>In previous versions of the library:</p>
<ul>
<li>ReceiveAsync would throw out the exception (therefore stopping the polling)</li>
<li>StartReceiving would pass the exception to HandlePollingErrorAsync and silently stop the polling</li>
</ul>
<p>If you still want the previous behaviour, have your HandleErrorAsync start like this:</p>
<pre><code class="language-csharp">Task HandleErrorAsync(ITelegramBotClient bot, Exception ex, HandleErrorSource source, CancellationToken ct)
{
   if (source is HandleErrorSource.HandleUpdateError) throw ex;
   ...
</code></pre>
</blockquote>
<h2 id="new-helpersextensions-to-simplify-your-code-v215"><a class="header" href="#new-helpersextensions-to-simplify-your-code-v215">New helpers/extensions to simplify your code (v21.5)</a></h2>
<ul>
<li>When replying to a message, you can now simply pass a <code>Message</code> for <em>replyParameters:</em> rather than a <code>Message.MessageId</code></li>
<li><code>Update.AllTypes</code> is a constant array containing all <code>UpdateType</code>s. You can pass it for the <em>allowedUpdates:</em> parameter (<code>GetUpdatesAsync</code>/<code>SetWebhookAsync</code>)</li>
<li>Message has now 2 extensions methods: <code>.ToHtml()</code> and <code>.ToMarkdown()</code> to convert the message text/caption and their entities into a simple Html or Markdown string.</li>
<li>You can also use methods <code>Markdown.Escape()</code> and <code>HtmlText.Escape()</code> to sanitize reserved characters from strings</li>
<li>Reply/Inline Keyboard Markup now have construction methods to simplify building keyboards dynamically:</li>
</ul>
<pre><code class="language-csharp">var replyMarkup = new InlineKeyboardMarkup()
    .AddButton(InlineKeyboardButton.WithUrl("Link to Repository", "https://github.com/TelegramBots/Telegram.Bot"))
    .AddNewRow().AddButton("callback").AddButton("caption", "data")
    .AddNewRow("with", "three", "buttons")
    .AddNewRow().AddButtons("A", "B", InlineKeyboardButton.WithSwitchInlineQueryCurrentChat("switch"));
</code></pre>
<ul>
<li>Same for ReplyKeyboardMarkup (and you can use <code>new ReplyKeyboardMarkup(true)</code> to resize keyboard)</li>
</ul>
<p>As <a href="#request-structures">previously announced</a>, the Request-typed methods are gone.
But you can still send Request structures via the <code>MakeRequestAsync</code> method.</p>
<h2 id="simplified-polling-with-events-v217"><a class="header" href="#simplified-polling-with-events-v217">Simplified polling with events (v21.7)</a></h2>
<p>Instead of <code>StartReceiving</code>/<code>ReceiveAsync</code> system, you can now simply set 2 or 3 events on the botClient:</p>
<ul>
<li><code>bot.OnMessage += ...</code> to receive Message updates</li>
<li><code>bot.OnUpdate += ...</code> to receive other updates <em>(or <ins>all</ins> updates if you don‚Äôt set <code>OnMessage</code>)</em></li>
<li><code>bot.OnError += ...</code> to handle errors/exceptions during polling or your handlers</li>
</ul>
<p>Note: Second argument to <code>OnMessage</code> event specifies which kind of update it was (<em>edited</em>, <em>channel</em> or <em>business</em> message?)</p>
<p>When you assign those events, polling starts automatically, you don‚Äôt have anything to do.<br>Polling will stop when you remove (<code>-=</code>) your events, or when you cancel the <a href="#global-cancellation-token-v212">global cancellation token</a></p>
<p>You can also use <code>await bot.DropPendingUpdatesAsync()</code> before setting those events to ignore past updates.<br>The <a href="https://github.com/TelegramBots/Telegram.Bot.Examples/tree/master/Console">Console example project</a> has been updated to demonstrate these events.</p>
<h2 id="automatic-retrying-api-calls-in-case-of-too-many-requests-v219"><a class="header" href="#automatic-retrying-api-calls-in-case-of-too-many-requests-v219">Automatic retrying API calls in case of ‚ÄúToo Many Requests‚Äù (v21.9)</a></h2>
<p>If Telegram servers fail on your API call with this error and ask you to to retry in less than 60 seconds, TelegramBotClient will now automatically wait for the requested delay and retry sending the same request up to 3 times.</p>
<p>This is configurable using Options on the constructor:</p>
<pre><code class="language-csharp">using var cts = new CancellationTokenSource();
var options = new TelegramBotClientOptions(token) { RetryThreshold = 120, RetryCount = 2 };
var bot = new TelegramBotClient(options, cancellationToken: cts.Token);
</code></pre>
<p>*Ô∏è‚É£ This is a change of behavior compared to previous versions, but probably a welcome one.<br>To disable this system and keep the same behavior as previous versions, use <code>RetryThreshold = 0</code></p>
<blockquote>
<p>Notes for advanced users:</p>
<ul>
<li>If this happens while uploading files (InputFile streams), the streams will be reset to their start position in order to be sent again</li>
<li>If your streams are non-seekable <em>(no problem with MemoryStream/FileStream)</em>, the full HTTP request to Bot API will be buffered before the first sending <em>(so it can lead to a temporary use of memory if you‚Äôre sending big files)</em></li>
</ul>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="migration-guide-for-version-190"><a class="header" href="#migration-guide-for-version-190">Migration guide for version 19.0</a></h1>
<h2 id="topics-in-groups"><a class="header" href="#topics-in-groups">Topics in Groups</a></h2>
<p>New topics functionality allow bots interact with users in topic specified by <code>messageThreadId</code> parameter.</p>
<p>We try to keep our Bot API implementation as close to <a href="https://core.telegram.org/bots/api#forumtopicclosed">Telegram Bot API</a> as possible. This means, that the new <code>messageThreadId</code> now the first optional parameter for a variety of methods.</p>
<p>Consider to use named parameters to avoid confusion with changed parameter order.</p>
<pre><code class="language-diff">-Message message = await bot.SendTextMessageAsync(
-    _fixture.SupergroupChat.Id,
-    "Please click on *Notify* button.",
-    cancellationToken);
+Message message = await bot.SendTextMessageAsync(
+    chatId: _fixture.SupergroupChat.Id,
+    text: "Please click on *Notify* button.",
+    messageThreadId: threadId,
+    cancellationToken: cancellationToken);
</code></pre>
<h2 id="new-inputfile-hierarchy"><a class="header" href="#new-inputfile-hierarchy">New InputFile Hierarchy</a></h2>
<p>Old <code>InputMedia*</code> class hierarchy poorly reflected actual file-related APIs.</p>
<p>We removed old hierarchy of <code>InputFile</code> related classes such as <code>InputOnlineFile</code>, <code>InputTelegramFile</code>, <code>InputFileStream</code>, etc., and also removed all implicit casts to them. From now on you should explicitly specify one of file types: <code>InputFileStream</code> for <code>Stream</code> content, <code>InputFileUrl</code> for URL and <code>InputFileId</code> if you want to use existing <code>file_id</code>. For convenience the base <code>InputType</code> class has factory methods to create the correct types:</p>
<ul>
<li><code>InputFile.FromStream(Stream stream, string? fileName = default)</code> for streams</li>
<li><code>InputFile.FromString(string urlOrFileId)</code> for URLs or file ids</li>
<li><code>InputFile.FromUri(Uri url)</code> - for URLs as strings</li>
<li><code>InputFile.FromUri(string url)</code> - for URLs as <code>URI</code>s</li>
<li><code>InputFile.FromFileId(string fileId)</code> - for file ids</li>
</ul>
<p>The migration scheme looks like that:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Previous method</th><th>New method</th></tr>
</thead>
<tbody>
<tr><td><code>new InputTelegramType(string)</code></td><td><code>InputFile.FromId(string)</code>, <code>InputFile.FromString(string)</code></td></tr>
<tr><td><code>new InputTelegramType(Stream, string?)</code></td><td><code>InputFile.FromStream(Stream, string?)</code></td></tr>
<tr><td><code>new InputFileStream(Stream)</code></td><td><code>InputFile.FromStream(Stream)</code></td></tr>
<tr><td><code>new InputOnlineFile(string)</code></td><td><code>InputFile.FromId(string)</code>, <code>InputFile.FromString(string)</code>, <code>InputFile.FromString(string)</code>, <code>InputFile.FromUrl(string)</code>, <code>InputFile.FromUrl(Uri)</code></td></tr>
<tr><td><code>new InputOnlineFile(Stream, string?)</code></td><td><code>InputFile.FromStream(Stream, string?)</code></td></tr>
<tr><td>raw <code>Stream</code></td><td><code>InputFile.FromStream(Stream)</code></td></tr>
<tr><td>raw <code>string</code></td><td><code>InputFile.FromString(string)</code></td></tr>
<tr><td>raw <code>URI</code></td><td><code>InputFile.FromUrl(URI)</code></td></tr>
</tbody>
</table>
</div>
<h2 id="chatid-implicit-conversion"><a class="header" href="#chatid-implicit-conversion">ChatId implicit conversion</a></h2>
<p>Implicit conversion from <code>ChatId</code> to <code>string</code> was removed due to complaints and problems it caused. The migration path is to explicitly call <code>ChatId.ToString()</code> method.</p>
<h2 id="stickers"><a class="header" href="#stickers">Stickers</a></h2>
<ul>
<li>All methods and types with animated, static and video sticker distinction were removed and replaced with a single set of sticker related methods per new Bot API updates: <code>AddAnimatedStickerToSetAsync</code>, <code>AddStaticStickerToSetAsync</code>, <code>AddVideoStickerToSetAsync</code>, etc. Remove the words <code>Static</code>, <code>Animated</code> and <code>Video</code> from sticker related methods in your code</li>
<li>Associated emojies and masks were moved to a separate type <code>InputSticker</code>, use them there instead, consult the official Bot API docs for a more detailed information</li>
</ul>
<h2 id="net-core-31-removed-as-a-separate-target-framework"><a class="header" href="#net-core-31-removed-as-a-separate-target-framework">.NET Core 3.1 removed as a separate target framework</a></h2>
<p>Since .NET Core 3.1 LTS status is not officialy supported anymore we changed the target to <code>netstandard2.0</code> and <code>net6.0</code> instead. If you‚Äôre using .NET Core 3.1 or .NET 5 runtimes you need to use the build for <code>netstandard2.0</code> instead. If you relied on <code>IAsyncEnumerable</code> implementation of poller you need to move to .NET 6 instead.</p>
<h2 id="other-changes"><a class="header" href="#other-changes">Other changes</a></h2>
<ul>
<li><code>Message.Type</code> returns <code>MessageType.Animation</code> when the message contains an <code>Animation</code>, use <code>MessageType.Animation</code> instead of <code>MessageType.Document</code> to check if the message contains an animation</li>
<li>Property <code>CanSendMediaMessages</code> was removed from the types <code>ChatMemberRestricted</code> and <code>ChatPermissions</code> and replaced with more granular permissions, use them instead</li>
<li>Removed method <code>GetChatMembersCountAsync</code>, use <code>GetChatMemberCountAsync</code></li>
<li>Removed method <code>KickChatMemberAsync</code>, use <code>BanChatMemberAsync</code></li>
<li>Properties and types <code>VoiceChatEnded</code>, <code>VoiceChatParticipantsInvited</code>,
<code>VoiceChatScheduled</code>, <code>VoiceChatStarted</code> removed, use methods and types which start with <code>Video*</code> instead</li>
<li>All propties with the word <code>Thumb</code> in them were renamed to contain the word <code>Thumbnail</code> per new Bot API updates</li>
<li>A new type <code>InlineQueryResultsButton</code> is used instead of <code>SwitchPmText</code> and <code>SwitchPmParameter</code> properties, consult the official Bot API docs</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="migration-guide-for-version-180"><a class="header" href="#migration-guide-for-version-180">Migration guide for version 18.0</a></h1>
<p>Most breaking changes in v18 come from new Bot API changes, such as:</p>
<ol>
<li>In <a href="https://core.telegram.org/bots/api#april-16-2022">Bot API 6.0</a> <code>voice_chat*</code> related message properties were
deprecated in favour of <code>video_chat*</code> with the same semantics and shape.</li>
<li>With introduction of video stickers in <a href="https://core.telegram.org/bots/api#january-31-2022">Bot API 5.7</a> we needed a way
to separate methods for different sticker types. So static .WEBP <code>*StickerSet*</code> methods and requests were given a <code>Static</code> prefix.</li>
<li>Removed <code>untilDate</code> parameter from <code>TelegramBotClientExtensions.BanChatSenderChatAsync</code> method and <code>UntilDate</code> property from <code>BanChatSenderChatRequest</code> class.</li>
<li>As of the next update some users will be able to upload up to 4GB files, so we changed <code>FileBase.FileSize</code> type to <code>long?</code>.</li>
<li>A new way of configuring the client.</li>
<li><code>ApiRequestEventArgs</code> contains full request data.</li>
</ol>
<p>Complete list of changes is available in <a href="https://github.com/TelegramBots/Telegram.Bot/blob/master/CHANGELOG.md">CHANGELOG</a></p>
<h2 id="1-removal-of-voicechat-properties-in-message-object"><a class="header" href="#1-removal-of-voicechat-properties-in-message-object">1. Removal of <code>VoiceChat*</code> properties in <code>Message</code> object</a></h2>
<p>Telegram renamed <code>voice_chat_*</code> properties in the <code>Message</code> class and with <code>video_chat_*</code> onces so we replaced
corresponding <code>MessageType</code> enum members with the new ones.</p>
<p>Following properties in <code>Message</code> class and corresponding enum members in <code>MessageType</code> enum were changed:</p>
<pre><code class="language-diff">-VoiceChatScheduled
-VoiceChatStarted
-VoiceChatEnded
-VoiceChatParticipantsInvited
+VideoChatScheduled
+VideoChatStarted
+VideoChatEnded
+VideoChatParticipantsInvited
</code></pre>
<p>Also property <code>CanManageVoiceChats</code> in <code>ChatMemberAdministrator</code> and <code>PromoteChatMemberRequest</code> classes was renamed to
<code>CanManageVideoChats</code>.</p>
<h2 id="2-renaming-static-sticker-methods-and-classes"><a class="header" href="#2-renaming-static-sticker-methods-and-classes">2. Renaming static sticker methods and classes</a></h2>
<p>With introduction of video stickers in <a href="https://core.telegram.org/bots/api#january-31-2022">Bot API 5.7</a> we needed a way
to separate methods for different sticker types. We already used <code>Animated</code> and <code>Video</code> suffix for methods related to animated
and video stickers so we decided to do the same for the static stickers:</p>
<ul>
<li>Classes <code>CreateNewStickerSetRequest</code> and <code>AddStickerToSetRequest</code> were renamed to <code>CreateNewStaticStickerSetRequest</code>
and <code>AddStaticStickerToSetRequest</code>.</li>
<li>Methods <code>CreateNewStickerSetAsync</code> and <code>AddStickerToSetAsync</code> where renamed to
<code>CreateStaticNewStickerSetAsync</code> and <code>AddStaticStickerToSetAsync</code>.</li>
</ul>
<h2 id="3-removal-of-untildate-parameter-from-banchatsenderchatasync-method-and-untildate-property-from-banchatsenderchatrequest-class"><a class="header" href="#3-removal-of-untildate-parameter-from-banchatsenderchatasync-method-and-untildate-property-from-banchatsenderchatrequest-class">3. Removal of <code>untilDate</code> parameter from <code>BanChatSenderChatAsync</code> method and <code>UntilDate</code> property from <code>BanChatSenderChatRequest</code> class</a></h2>
<p>The <code>untilDate</code> parameter from <code>TelegramBotClientExtensions.BanChatSenderChatAsync</code> method and <code>UntilDate</code> property from <code>BanChatSenderChatRequest</code> class were removed from the Bot API.</p>
<h2 id="4-lifting-of-the-filesize-limit"><a class="header" href="#4-lifting-of-the-filesize-limit">4. Lifting of the FileSize limit</a></h2>
<p>As of the next update some users will be able to upload up to 4GB files, so we changed <code>FileBase.FileSize</code> type to <code>long?</code> to accommodate this change.</p>
<h2 id="5-a-new-way-of-client-configuration"><a class="header" href="#5-a-new-way-of-client-configuration">5. A new way of client configuration</a></h2>
<p>Starting with this release client configuration parameters should be passed through <code>TelegramBotClientOptions</code> class.
You need to create an instance of <code>TelegramBotClientOptions</code> and pass it to the client:</p>
<pre><code class="language-csharp">using Telegram.Bot;

var options = new TelegramBotClientOptions(
    token: "&lt;token&gt;"

    // pass an optional baseUrl if you want to use a custom bot server
    baseUrl: "https://custombotserverdomain.com",

    // pass an optional flag `true` if you want to use test environment
    useTestEnvironment = true
);

var client = new TelegramBotClient(options);
</code></pre>
<p>If you don‚Äôt know about test environment you can read more about it in the official
<a href="https://core.telegram.org/bots/webapps#using-bots-in-the-test-environment">documentation</a>.</p>
<p>If you don‚Äôt need extra configuration options you can still use the constructor that accepts a token and an instance of <code>HttpClient</code>:</p>
<pre><code class="language-csharp">var client = new TelegramBotClient("&lt;token&gt;");
</code></pre>
<h2 id="6-polling-functionality-in-the-core-library"><a class="header" href="#6-polling-functionality-in-the-core-library">6. Polling functionality in the core library</a></h2>
<p>The latest biggest change which is not a breaking one, but nevertheless worth a note: deprecation of
<code>Telegram.Bot.Extensions.Polling</code> package.</p>
<p>All the functionality from the package was merged into the core library under namespace <code>Telegram.Bot.Polling</code>.</p>
<p>Name of the method <code>HandleErrorAsync</code> in <code>IUpdateHandler</code> interface was quite confusing from the beginning since a lot
of people assumed they can handle all errors in it, but in reality it‚Äôs used only for handling errors during polling.
We decided to give it a more appropriate name: <code>HandlePollingErrorAsync</code>.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="migration-guide-for-version-170"><a class="header" href="#migration-guide-for-version-170">Migration guide for version 17.0</a></h1>
<p>There are several breaking changes in v17:</p>
<ul>
<li>New exceptions handling logic</li>
<li>Removal of update and message events</li>
<li>Removal of API methods from <code>ITelegramBotClient</code> interface and moving them into extension methods in the same namespace (that shouldn‚Äôt break anyone‚Äôs sources as long as they don‚Äôt employ reflection or make their own interface implementations)</li>
<li>Working with default enum values</li>
</ul>
<p>These are the most user facing breaking changes you should be aware of during migration.</p>
<p>Let‚Äôs dive deep on the migrations.</p>
<h2 id="new-exceptions-handling-logic"><a class="header" href="#new-exceptions-handling-logic">New exceptions handling logic</a></h2>
<p>v17 brings a new base type for exceptions: <code>RequestException</code>. <code>ApiRequestException</code>  inherits from <code>RequestException</code> and is thrown only when an actual error response with the correct body is received from the Bot API. In other situations <code>RequestException</code> will be thrown instead containing actual exception as <code>InnerException</code> if there is one, e.g. serialization or connection-related exceptions.</p>
<p>If you used <code>ApiRequestException</code> and <code>HttpRequestException</code> to handle most exception now you have to replace <code>HttpRequestException</code> with <code>RequestException</code> and look for the inner exception. All valid errors with JSON body from Telegram are now thrown as <code>ApiRequestException</code> including <code>429: Too Many Requests</code>.</p>
<p>Since <code>5XX</code> responses don‚Äôt usually include correct JSON body they are thrown as <code>RequestException</code> with <code>HttpRequestException</code> inside.</p>
<p>Look at the following example on how to handle different kinds of exceptions. You might not need to implement everything as you see, it‚Äôs there only for demonstration purposes.</p>
<pre><code class="language-csharp">try
{
    await bot.SendTextMessageAsync(chatId, "Hello");
}
catch (ApiRequestException exception)
{
    switch (exception.StatusCode)
    {
        case 400:
            // Handle incorrect requests exceptions
            break;
        case 401:
            // Handle incorrect bot token exception (revoked tokens)
            break;
        case 403:
            // Handle authorization exceptions (blocked users, unaccessible chats, etc)
            break;
        case 429:
            // Handle rate limiting exception
            break;
        default:
            // Handle other errors with valid json body: it includes status code and description of the error
            break;
    }
}
catch (RequestException exception)
{
    if (exception.InnerException is HttpRequestException httpRequestException)
    {
        // Handle connection exceptions or 5XX exceptions from the Bot API
    }
    else if (exception.InnerException is JsonSerializationException serializationException)
    {
        // Handle serialization exception when a request or a response can't be serialized for some reason
    }
    else
    {
        // Handle all other exceptions
    }
}
catch (OperationCancelledException exception)
{
    // Handle cancellation exception, e.g. when CancellationToken is cancelled
}
</code></pre>
<h2 id="removal-of-events"><a class="header" href="#removal-of-events">Removal of events</a></h2>
<p>In v17 we removed events and introduced a new way of getting updates with <a href="https://github.com/TelegramBots/Telegram.Bot.Extensions.Polling">Telegram.Bot.Extensions.Polling</a> package. You can find an example in <a href="#your-first-chat-bot">First Chat Bot</a> article.</p>
<h2 id="removal-of-api-methods-from-itelegrambotclient-interface"><a class="header" href="#removal-of-api-methods-from-itelegrambotclient-interface">Removal of API methods from <code>ITelegramBotClient</code> interface</a></h2>
<p>This change shouldn‚Äôt affect most users, the methods are still there, but instead of being implementations of the interface they are now extension methods. It makes the interface leaner and easier to implement for custom clients and for decorators (e.g. rate limiters implemented as decorators). There isn‚Äôt really a migration path for those who used these for some reason.</p>
<h2 id="working-with-default-enum-values"><a class="header" href="#working-with-default-enum-values">Working with default enum values</a></h2>
<p>We changed how we work with enums. The most notable change is the default value: there is none, all our enums are now start with 1 (exception <code>UpdateType</code> and <code>MessageType</code> since they are not a part of the Bot API and we fully control these). <code>0</code> value is left unassigned for a purpose: if we encounter an unknown value in the response from the Bot API we assign <code>0</code> as its value.</p>
<p>Let‚Äôs imagine that Telegram adds new <code>MessageEntity</code> value. From now on all unknown values can be handled in the <code>default</code> case of <code>switch</code> statement.</p>
<pre><code class="language-csharp">MessageEntity entity = message.Entities.First();

switch (entity.Type)
{
    case MessageEntityType.Username:
        // ...
        break;
    case MessageEntityType.Command:
        // ...
        break;
    default:
        // All unknown values will go there
        break;
}
</code></pre>
<p>Also some default enums values were removed, e.g. <code>ParseMode.Default</code> since we started using nullable types for every optional value and <code>ParseMode.Default</code> lost it‚Äôs use. If a message doesn‚Äôt have any markup you‚Äôll receive <code>null</code> in places where <code>ParseMode</code> type was used or if you want to explicitly indicate an absence of markup pass <code>null</code> instead.</p>
<h2 id="other-breaking-changes"><a class="header" href="#other-breaking-changes">Other breaking changes</a></h2>
<h3 id="constructor-accepting-iwebproxy"><a class="header" href="#constructor-accepting-iwebproxy">Constructor accepting IWebProxy</a></h3>
<p>We removed constructor accepting <code>IWebProxy</code>. Now you have to configure HttpClient yourself to use proxy. You can find examples in <a href="#http-proxy">Working Behind a Proxy</a> article.</p>
<h3 id="inputmediatype"><a class="header" href="#inputmediatype">InputMediaType</a></h3>
<p>Property <code>Type</code> in <code>IInputMedia</code> was changed to an enum <code>InputMediaType</code> for easier discoverability. So if you relied string values like <code>photo</code>, <code>video</code>, <code>animation</code> and so on now you need to switch to using enums. As a result you‚Äôll get autocomplete in IDEs and more predictability of what types of input media there are.</p>
<h3 id="encryptedpassportelementtype"><a class="header" href="#encryptedpassportelementtype">EncryptedPassportElementType</a></h3>
<p>Property <code>Type</code> of <code>EncryptedPassportElement</code> was replace with an enum for the same reason with <code>EncryptedPassportElementType</code> enum.</p>
<h3 id="chatmember"><a class="header" href="#chatmember">ChatMember</a></h3>
<p>As part of Bot API 5.3 implementation <code>ChatMember</code> type was split into a hierarchy of types with a discriminator field <code>Status</code>. If you need to access some data from the derived class you should use pattern matching or type casting like this:</p>
<pre><code class="language-csharp">ChatMember member = ... //;

if (chatMember is ChatMemberKicked kickedMember)
{
    // now you can access properties of a kicked chat member
    if (kickedMember.Until is not null)
    {
        // do something with the value of Until
    }
}
</code></pre>
<h3 id="chatid"><a class="header" href="#chatid">ChatId</a></h3>
<p>Fields <code>Identifier</code> and <code>Username</code> are now get-only properties. It shouldn‚Äôt break most people‚Äôs code as it‚Äôs not a source breaking change. If you used reflection to find these fields you should to look for properties now.</p>
<h3 id="inlinequeryresultbase"><a class="header" href="#inlinequeryresultbase">InlineQueryResultBase</a></h3>
<p>Type <code>InlineQueryResultBase</code> is renamed to <code>InlineQueryResult</code> to match Bot API type hierarchy.</p>
<h3 id="nullability"><a class="header" href="#nullability">Nullability</a></h3>
<p>From now on all properties that are optional will use nullable types, e.g. <code>int?</code>, <code>string?</code>, because default values of such properties might be an actual values and isn‚Äôt distinguishable from a lack of value. From now if a property is <code>null</code> you can be sure that it‚Äôs value was not present in a response from the Bot API.</p>
<h3 id="replykeyboardmarkup"><a class="header" href="#replykeyboardmarkup">ReplyKeyboardMarkup</a></h3>
<p>Since <code>ResizeKeyboard</code> and <code>OneTimeKeyboard</code> are optional, we removed them from <code>ReplyKeyboardMarkup</code> constructor. You have to use <a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/how-to-initialize-objects-by-using-an-object-initializer">object initialization syntax</a> to configure these properties:</p>
<pre><code class="language-csharp">var replyKeyboardMarkup = new ReplyKeyboardMarkup(
    new KeyboardButton[][]
    {
        new KeyboardButton[] { "1.1", "1.2" },
        new KeyboardButton[] { "2.1", "2.2" },
    })
    {
        ResizeKeyboard = true
    };
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="migration-guide-for-version-14x"><a class="header" href="#migration-guide-for-version-14x">Migration guide for version 14.x</a></h1>
<h2 id="date-and-time"><a class="header" href="#date-and-time">Date and Time</a></h2>
<p>All <code>DateTime</code> values are now in UTC format. Here are some examples of usage:</p>
<pre><code class="language-csharp">// Use UTC time when making a request
await bot.KickChatMemberAsync(
    chatId: -9876,
    userId: 1234,
    untilDate: DateTime.UtcNow.AddDays(2)
);
</code></pre>
<pre><code class="language-csharp">// Convert to local time (not recommended though)
DateTime localTime = update.Message.Date.ToLocalTime();
</code></pre>
<h2 id="keyboard-buttons"><a class="header" href="#keyboard-buttons">Keyboard Buttons</a></h2>
<p>Many keyboard button types are removed from project. It is more convenient to use factory methods on <code>KeyboardButton</code> and <code>InlineKeyboardButton</code> classes.</p>
<p>Here are some examples:</p>
<pre><code class="language-csharp">// Message having an inline keyboard button with URL that redirects to a page
await bot.SendTextMessageAsync(
    chatId: -9876,
    text: "Check out the source code",
    replyMarkup: new InlineKeyboardMarkup(
        InlineKeyboardButton.WithUrl("Repository", "https://github.com/TelegramBots/Telegram.Bot")
    )
);
</code></pre>
<pre><code class="language-csharp">// Message to a private chat having a 2-row reply keyboard
await bot.SendTextMessageAsync(
    chatId: 1234,
    text: "Share your contact &amp; location",
    replyMarkup: new ReplyKeyboardMarkup(
        new [] { KeyboardButton.WithRequestContact("Share Contact") },
        new [] { KeyboardButton.WithRequestLocation("Share Location") },
    )
);
</code></pre>
<h2 id="getfileasync"><a class="header" href="#getfileasync"><code>GetFileAsync()</code></a></h2>
<p>Downloading a file from Telegram Bot API has 2 steps (<a href="https://core.telegram.org/bots/api#getfile">see docs here</a>):</p>
<ol>
<li>Get file info by calling <code>getFile</code></li>
<li>Download file from <code>https://api.telegram.org/file/bot&lt;token&gt;/&lt;file_path&gt;</code></li>
</ol>
<p><code>GetFileAsync()</code> is replaced by 3 methods. Method <code>GetInfoAndDownloadFileAsync()</code> looks very similar to old <code>GetFileAsync()</code>:</p>
<pre><code class="language-csharp">// Gets file info and saves it to "path/to/file.pdf"
using (var fileStream = System.IO.File.OpenWrite("path/to/file.pdf"))
{
    File fileInfo = await bot.GetInfoAndDownloadFileAsync(
        fileId: "BsdfgLg4Khdlsn-bldBD",
        destination: fileStream
    );
}
</code></pre>
<blockquote>
<p>Note that calling the method <code>GetInfoAndDownloadFileAsync()</code> results in 2 HTTP requests (steps 1 and 2 above) being sent to the Bot API.</p>
</blockquote>
<p>There are two more methods that assist you with downloading files:</p>
<pre><code class="language-csharp">// New version of GetFileAsync() only gets the file info (step 1)
File fileInfo = await bot.GetFileAsync("BsdfgLg4Khdlsn-bldBD");

// Download file from server (step 2)
using (var fileStream = System.IO.File.OpenWrite("path/to/file.pdf")) {
    await bot.DownloadFileAsync(
        filePath: fileInfo.FilePath,
        destination: fileStream
    );
}
</code></pre>
<h2 id="getupdatesasync-setwebhookasync"><a class="header" href="#getupdatesasync-setwebhookasync"><code>GetUpdatesAsync()</code>, <code>SetWebhookAsync()</code></a></h2>
<p>Value <code>All</code> is removed from enum <code>Telegram.Bot.Types.Enums.UpdateType</code>. In order to get all kind of updates, pass an empty list such as <code>Array.Empty&lt;UpdateType&gt;()</code> for <code>allowedUpdates</code> argument.</p>
<h2 id="setwebhookasync"><a class="header" href="#setwebhookasync"><code>SetWebhookAsync()</code></a></h2>
<p>Parameter <code>url</code> is required. If you intend to remove the webhook, it is recommended to use <code>DeleteWebhookAsync()</code> instead. However, you could achieve the same result by passing <code>string.Empty</code> value to <code>url</code> argument.</p>
<h2 id="answerinlinequeryasync-and-inlinequeryresult"><a class="header" href="#answerinlinequeryasync-and-inlinequeryresult"><code>AnswerInlineQueryAsync()</code> and <code>InlineQueryResult</code></a></h2>
<p>Classes <code>InlineQueryResultNew</code> and <code>InlineQueryResultCache</code> are removed. <code>InlineQueryResult</code> has become the only shared base type for all inline query result classes.</p>
<p>Many shared and redundant properties are removed. This might require significant changes to your <code>.cs</code> files if your bot is in <em>inline mode</em>. Fortunately, all input query results now have constructors with only the required properties as their parameters. This is the preferred way to instantiate input query result instances e.g.:</p>
<p>Instead of:</p>
<pre><code class="language-csharp">// bad way. easy to get exceptions
var documentResult = new InlineQueryResultDocument
{
    Id = "some-id",
    Url = "https://example.com/document.pdf",
    Title = "Some title",
    MimeType = "application/pdf"
};
</code></pre>
<p>You should use:</p>
<pre><code class="language-csharp">// good way
var documentResult = new InlineQueryResultDocument(
    id: "some-id",
    documentUrl: "https://example.com/document.pdf",
    title: "Some title",
    mimeType: "application/pdf"
);
</code></pre>
<h2 id="sendmediagroupasync"><a class="header" href="#sendmediagroupasync"><code>SendMediaGroupAsync()</code></a></h2>
<p><code>InputMediaType</code> is renamed to <code>InputMedia</code>.</p>
<blockquote>
<p><em>ToDo</em></p>
</blockquote>
<h2 id="inline-message-overloads"><a class="header" href="#inline-message-overloads">Inline Message Overloads</a></h2>
<p>Many inline message methods have been replaced with their overloads.</p>
<ul>
<li><code>EditInlineMessageTextAsync</code>‚Äì&gt; <code>EditMessageTextAsync</code></li>
</ul>
<blockquote>
<p><em>ToDo</em></p>
</blockquote>
<h2 id="filetosend"><a class="header" href="#filetosend"><code>FileToSend</code></a></h2>
<p>New classes have replaced <code>FileToSend</code> struct.</p>
<ul>
<li><code>InputFileStream</code>:</li>
<li><code>InputTelegramFile</code>:</li>
<li><code>InputOnlineFile</code>:</li>
</ul>
<p>In many cases, you can use implicit casting to pass parameters.</p>
<pre><code class="language-csharp">Stream stream = System.IO.File.OpenRead("photo.png");
var message = await bot.SendPhotoAsync("chat id", stream);

string fileId = "file_id on Telegram servers";
var message = await bot.SendPhotoAsync("chat id", fileId);
</code></pre>
<blockquote>
<p><em>ToDo</em>. implicit casts</p>
</blockquote>
<h2 id="updatetype-and-messagetype"><a class="header" href="#updatetype-and-messagetype"><code>UpdateType</code> and <code>MessageType</code></a></h2>
<p>Values in these two enums are renamed e.g. <code>UpdateType.MessageUpdate</code> is now <code>UpdateType.Message</code>.</p>
<p><code>MessageType.Service</code> is removed. Now each type of message has its own <code>MessageType</code> value e.g. when a chat member leaves a group, corresponding update contains a message type of <code>MessageType.ChatMemberLeft</code> value.</p>
<h2 id="videonote"><a class="header" href="#videonote"><code>VideoNote</code></a></h2>
<p>Properties <code>Width</code> and <code>Height</code> are removed. Vide notes are squared and <code>Length</code> property represents both width and height.</p>
<h2 id="constructor-parameters-instead-of-public-setters"><a class="header" href="#constructor-parameters-instead-of-public-setters">Constructor Parameters Instead of Public Setters</a></h2>
<p>Many types now have the required parameters in their constructors. To avoid running into problems or getting exceptions, we recommend providing all required values in the constructor e.g.:</p>
<pre><code class="language-c#">//bad way:
var markup = new InlineKeyboardMarkup
    {
        Keyboard = buttonsArray,
        ResizeKeyboard = true
    };

// better:
var markup = new InlineKeyboardMarkup(buttonsArray)
    {
        ResizeKeyboard = true
    };
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr-ef4e11c1.min.js"></script>
        <script src="mark-09e88c2c.min.js"></script>
        <script src="searcher-c2a407aa.js"></script>

        <script src="clipboard-1626706a.min.js"></script>
        <script src="highlight-abc7f01d.js"></script>
        <script src="book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>


    </div>
    </body>
</html>
